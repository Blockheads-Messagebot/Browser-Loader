{"version":3,"file":"bundle.js","sources":["node_modules/@bhmb/bot/es/extension.js","node_modules/@bhmb/bot/es/player.js","node_modules/@bhmb/bot/es/events.js","node_modules/@bhmb/bot/es/chatWatcher.js","node_modules/@bhmb/bot/es/updateLists.js","node_modules/@bhmb/bot/es/world.js","node_modules/@bhmb/bot/es/storage.js","node_modules/@bhmb/bot/es/index.js","src/bot.ts","node_modules/tslib/tslib.es6.js","node_modules/blockheads-cloud-api/build_es.js","node_modules/kind-of/index.js","node_modules/shallow-clone/index.js","node_modules/isobject/index.js","node_modules/is-plain-object/index.js","node_modules/clone-deep/index.js","src/storage.ts","node_modules/@bhmb/messages/index.js","node_modules/@bhmb/ui/index.js","node_modules/@bhmb/console/index.js","node_modules/save-as/lib/index.js","src/extensions.ts","src/settings.ts","src/index.ts"],"sourcesContent":["export class MessageBotExtension {\r\n    /**\r\n     * Creates a new extension.\r\n     * @param id the extension id\r\n     * @param bot the bot that this extension is loaded from\r\n     */\r\n    constructor(id, bot) {\r\n        this.bot = bot;\r\n        /**\r\n         * Any exports that other extensions may call.\r\n         */\r\n        this.exports = {};\r\n        this.storage = bot.storage.prefix(id);\r\n        this.world = bot.world;\r\n    }\r\n    /**\r\n     * Removes the extension, listeners and ui should be removed here. Stored settings should not be removed.\r\n     */\r\n    remove() { }\r\n    /**\r\n     * Removes the extension. All listeners should be removed here.\r\n     */\r\n    uninstall() {\r\n        this.remove();\r\n        this.storage.clear();\r\n    }\r\n}\r\n//# sourceMappingURL=extension.js.map","function equalCaseInsensitive(a, b) {\r\n    return a.localeCompare(b, undefined, { sensitivity: 'base' }) === 0;\r\n}\r\nfunction arrayContainsAny(haystack, ...needles) {\r\n    return haystack.some(item => needles.some(needle => equalCaseInsensitive(item, needle)));\r\n}\r\n/**\r\n * Player class which is returned by the [[World.getPlayer]] method. Should not be created by any other method.\r\n */\r\nexport class Player {\r\n    /**\r\n     * Creates a new instance of the Player class.\r\n     *\r\n     * @param name The name of the player.\r\n     * @param info The player info stored between bot launches.\r\n     */\r\n    constructor(name, info, lists) {\r\n        this._name = name;\r\n        this._info = info;\r\n        this._lists = lists;\r\n    }\r\n    /**\r\n     * Gets the player's name.\r\n     */\r\n    get name() {\r\n        return this._name;\r\n    }\r\n    /**\r\n     * Gets the most recently used IP of the player.\r\n     */\r\n    get ip() {\r\n        return this._info.ip;\r\n    }\r\n    /**\r\n     * Gets the all IPs used by the player on the world.\r\n     */\r\n    get ips() {\r\n        return [...this._info.ips];\r\n    }\r\n    /**\r\n     * Gets the number of times the player has joined the server.\r\n     */\r\n    get joins() {\r\n        return this._info.joins;\r\n    }\r\n    /**\r\n     * Checks if the player has joined the server.\r\n     */\r\n    get hasJoined() {\r\n        return this.joins > 0;\r\n    }\r\n    /**\r\n     * Returns true if the player is the owner of the server or is the server.\r\n     */\r\n    get isOwner() {\r\n        return !!this._info.owner || this._name == 'SERVER';\r\n    }\r\n    /**\r\n     * Checks if the player is an admin or the owner.\r\n     */\r\n    get isAdmin() {\r\n        // A player is admin if their name or their latest IP is listed on the adminlist, or they are the owner.\r\n        return this.isOwner || arrayContainsAny(this._lists.adminlist, this._name, this._info.ip);\r\n    }\r\n    /**\r\n     * Checks if the player is a mod without admin permissions.\r\n     */\r\n    get isMod() {\r\n        // A player is mod if their name or their latest IP is on the modlist\r\n        return !this.isAdmin && arrayContainsAny(this._lists.modlist, this._name, this._info.ip);\r\n    }\r\n    /**\r\n     * Checks if the player is an admin or a mod.\r\n     */\r\n    get isStaff() {\r\n        return this.isAdmin || this.isMod;\r\n    }\r\n    /**\r\n     * Checks if the player is whitelisted. Is true if the player can join the server while it is whitelisted.\r\n     */\r\n    get isWhitelisted() {\r\n        // A player is whitelisted if they are staff or if their name or latest ip is on the whitelist.\r\n        return this.isStaff || arrayContainsAny(this._lists.whitelist, this._name, this._info.ip);\r\n    }\r\n    /**\r\n     * Checks if the player is banned.\r\n     */\r\n    get isBanned() {\r\n        return !this.isStaff && this._lists.blacklist\r\n            .some(entry => {\r\n            // We don't know the current player's device ID so can't check for that on the blacklist\r\n            // If the player's name is on the blacklist, they are banned.\r\n            // If an IP the player has used is banned, they are *probably* banned, so guess that they are.\r\n            // Remove device ID from blacklist entry, if there is one\r\n            if (entry.includes(' \\\\'))\r\n                entry = entry.substr(0, entry.indexOf(' \\\\'));\r\n            if (equalCaseInsensitive(this._name, entry))\r\n                return true;\r\n            if (this._info.ips.includes(entry))\r\n                return true;\r\n            return false;\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=player.js.map","/**\r\n * An event which can be subscribed to and dispatched\r\n */\r\nexport class SimpleEvent {\r\n    constructor() {\r\n        this.subscribers = [];\r\n    }\r\n    /**\r\n     * Subscribe to the event.\r\n     * @param listener The listener which will be called when the event is dispatched.\r\n     */\r\n    sub(listener) {\r\n        this.subscribers.push({ listener, once: false });\r\n    }\r\n    /**\r\n     * Unsubscribe from the event.\r\n     * @param listener The listener to remove.\r\n     */\r\n    unsub(listener) {\r\n        let index = this.subscribers.findIndex(sub => listener == sub.listener);\r\n        if (index != -1) {\r\n            this.subscribers.splice(index, 1);\r\n        }\r\n    }\r\n    /**\r\n     * Subscribes to the event only once.\r\n     * @param listener The listener which will be called when the event is dispatched.\r\n     */\r\n    one(listener) {\r\n        this.subscribers.push({ listener, once: true });\r\n    }\r\n    /**\r\n     * Dispatches an event, calling all listeners.\r\n     * @param arg the argument to call listeners with.\r\n     */\r\n    dispatch(arg) {\r\n        this.subscribers.forEach(({ listener, once }) => {\r\n            if (once)\r\n                this.unsub(listener);\r\n            try {\r\n                listener(arg);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * A helper to avoid exposing undesirable events.\r\n     */\r\n    asEvent() {\r\n        let that = this;\r\n        return {\r\n            sub(listener) {\r\n                return that.sub(listener);\r\n            },\r\n            one(listener) {\r\n                return that.one(listener);\r\n            },\r\n            unsub(listener) {\r\n                return that.unsub(listener);\r\n            },\r\n        };\r\n    }\r\n}\r\n//# sourceMappingURL=events.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { SimpleEvent } from './events';\r\n/**\r\n * Internal class used by the [[World]] class to watch chat.\r\n * @hidden\r\n */\r\nexport class ChatWatcher {\r\n    /**\r\n     * Creates a new ChatWatcher\r\n     * @param api the api to be used to communicate with chat\r\n     * @param online a shared array with the host world class that this class keeps up to date.\r\n     */\r\n    constructor(api, online) {\r\n        this.api = api;\r\n        this.online = online;\r\n        this._onMessage = new SimpleEvent();\r\n        this._onJoin = new SimpleEvent();\r\n        this._onLeave = new SimpleEvent();\r\n        this._onOther = new SimpleEvent();\r\n        this.timeoutId = null;\r\n        /**\r\n         * Parses a chat message, firing the appropriate events if required.\r\n         */\r\n        this.parse = (message) => {\r\n            let parseError = () => {\r\n                this._onOther.dispatch(message);\r\n            };\r\n            if (/^[^a-z]+ - Player Connected /.test(message)) {\r\n                try {\r\n                    let [, name, ip] = message.match(/Connected ([^a-z]{3,}) \\| ([\\d.]+) \\| .{32}$/);\r\n                    if (!this.online.includes(name)) {\r\n                        this.online.includes(name) || this.online.push(name);\r\n                        this._onJoin.dispatch({ name, ip });\r\n                        return;\r\n                    }\r\n                }\r\n                catch (_) { }\r\n                return parseError();\r\n            }\r\n            if (/^[^a-z]+ - Player Disconnected /.test(message)) {\r\n                try {\r\n                    let [, name] = message.match(/Disconnected ([^a-z]{3,})$/);\r\n                    if (this.online.includes(name)) {\r\n                        this.online.splice(this.online.indexOf(name), 1);\r\n                        this._onLeave.dispatch(name);\r\n                        return;\r\n                    }\r\n                }\r\n                catch (_) { }\r\n                return parseError();\r\n            }\r\n            if (message.slice(0, 18).includes(': ')) {\r\n                let name = this.getUser(message);\r\n                if (name) {\r\n                    message = message.substr(name.length + 2);\r\n                    if (name == 'SERVER' && message.startsWith('/')) {\r\n                        return parseError();\r\n                    }\r\n                    this._onMessage.dispatch({ name, message });\r\n                    return;\r\n                }\r\n            }\r\n            return parseError();\r\n        };\r\n        /**\r\n         * Continually checks chat for new messages\r\n         * @param lastId the ID to pass to the API to get only most recent messages.\r\n         */\r\n        this.checkChat = (lastId) => __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                let { log, nextId } = yield this.api.getMessages(lastId);\r\n                if (this.timeoutId == null)\r\n                    return;\r\n                log.forEach(this.parse);\r\n                this.timeoutId = setTimeout(this.checkChat, 5000, nextId);\r\n            }\r\n            catch (_) {\r\n                // Network error, wait 30 seconds before retrying\r\n                this.timeoutId = setTimeout(this.checkChat, 30000, 0);\r\n                return;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Event which fires when a player joins the server.\r\n     */\r\n    get onJoin() {\r\n        return this._onJoin.asEvent();\r\n    }\r\n    /**\r\n     * Event which fires when a player leaves the server.\r\n     */\r\n    get onLeave() {\r\n        return this._onLeave.asEvent();\r\n    }\r\n    /**\r\n     * Event which fires when a player sends a message in chat.\r\n     */\r\n    get onMessage() {\r\n        return this._onMessage.asEvent();\r\n    }\r\n    /**\r\n     * Event which fires when a chat message cannot be parsed as a message, join, or leave.\r\n     */\r\n    get onOther() {\r\n        return this._onOther.asEvent();\r\n    }\r\n    /**\r\n     * True if the watcher is currently running, otherwise false.\r\n     */\r\n    get running() {\r\n        return this.timeoutId != null;\r\n    }\r\n    /**\r\n     * Starts the listener. Calling multiple times will not result in multiple listeners being started.\r\n     */\r\n    start() {\r\n        if (this.timeoutId)\r\n            this.stop();\r\n        this.timeoutId = setTimeout(this.checkChat, 0, 0);\r\n    }\r\n    /**\r\n     * Stops the listener if it is running. If not running, does nothing.\r\n     */\r\n    stop() {\r\n        if (this.timeoutId)\r\n            clearTimeout(this.timeoutId);\r\n        this.timeoutId = null;\r\n    }\r\n    /**\r\n     * Parses a message to extract a player name.\r\n     * @param message the message to extract a name from.\r\n     */\r\n    getUser(message) {\r\n        for (let i = 18; i > 4; i--) {\r\n            let possibleName = message.substring(0, message.lastIndexOf(': ', i));\r\n            if (this.online.includes(possibleName) || possibleName == 'SERVER') {\r\n                return possibleName;\r\n            }\r\n        }\r\n        // Player is most likely offline\r\n        if (/[^a-z]{3,16}: /.test(message))\r\n            return message.substring(0, message.lastIndexOf(': ', 18));\r\n        // Invalid name\r\n        return '';\r\n    }\r\n}\r\n//# sourceMappingURL=chatWatcher.js.map","const addToList = (list, element) => !list.includes(element) && list.push(element);\r\nconst removeFromList = (list, element) => {\r\n    const index = list.indexOf(element);\r\n    if (index == -1)\r\n        return;\r\n    list.splice(index, 1);\r\n};\r\nconst removeFromLists = (lists, element) => lists.forEach(list => removeFromList(list, element));\r\nexport function updateLists(lists, player, message) {\r\n    if (!player.isAdmin)\r\n        return;\r\n    message = message.toLocaleUpperCase();\r\n    const target = message.replace(/^\\/\\w+? /, '');\r\n    if (message.startsWith('/ADMIN ')) {\r\n        addToList(lists.adminlist, target);\r\n        removeFromList(lists.blacklist, target);\r\n    }\r\n    else if (message.startsWith('/UNADMIN ')) {\r\n        removeFromList(lists.adminlist, target);\r\n    }\r\n    else if (message.startsWith('/MOD ')) {\r\n        addToList(lists.modlist, target);\r\n        removeFromList(lists.blacklist, target);\r\n    }\r\n    else if (message.startsWith('/UNMOD ')) {\r\n        removeFromList(lists.modlist, target);\r\n    }\r\n    else if (message.startsWith('/BAN ')) {\r\n        removeFromLists([lists.adminlist, lists.whitelist, lists.modlist], target);\r\n        addToList(lists.blacklist, target);\r\n    }\r\n    else if (message.startsWith('/UNBAN ')) {\r\n        removeFromList(lists.blacklist, target);\r\n    }\r\n    else if (message.startsWith('/WHITELIST ')) {\r\n        removeFromList(lists.blacklist, target);\r\n        addToList(lists.whitelist, target);\r\n    }\r\n    else if (message.startsWith('/UNWHITELIST ')) {\r\n        removeFromList(lists.whitelist, target);\r\n    }\r\n}\r\n//# sourceMappingURL=updateLists.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nimport { Player } from './player';\r\nimport { ChatWatcher } from './chatWatcher';\r\nimport { SimpleEvent } from './events';\r\nimport { updateLists } from './updateLists';\r\nconst cloneDate = (d) => new Date(d.getTime());\r\nconst delay = (time) => new Promise(r => setTimeout(r, time));\r\nconst PLAYERS_KEY = 'players';\r\nconst LAST_UPDATE_KEY = 'lastPlayersUpdate';\r\nexport class World {\r\n    constructor(api, storage) {\r\n        this._cache = {};\r\n        this._events = {\r\n            onJoin: new SimpleEvent(),\r\n            onLeave: new SimpleEvent(),\r\n            onMessage: new SimpleEvent(),\r\n        };\r\n        this._online = [];\r\n        this._lists = { adminlist: [], modlist: [], whitelist: [], blacklist: [] };\r\n        this._commands = new Map();\r\n        /**\r\n         * The first time joins were updated from chat\r\n         * It is assumed that all joins from this point onwards have been counted.\r\n         */\r\n        this._firstChatUpdate = Date.now();\r\n        /**\r\n         * Gets an overview of the server info\r\n         */\r\n        this.getOverview = (refresh = false) => __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._cache.overview || refresh) {\r\n                let overview = yield (this._cache.overview = this._api.getOverview());\r\n                // Add online players to the online list if they aren't already online\r\n                overview.online.forEach(name => this._online.includes(name) || this._online.push(name));\r\n                // Make sure the owner has the owner flag set to true\r\n                this._storage.with(PLAYERS_KEY, {}, players => {\r\n                    players[overview.owner] = players[overview.owner] || { ip: '', ips: [], joins: 0 };\r\n                    players[overview.owner].owner = true;\r\n                });\r\n            }\r\n            let overview = yield this._cache.overview;\r\n            return Object.assign({}, overview, { created: cloneDate(overview.created), last_activity: cloneDate(overview.last_activity), credit_until: cloneDate(overview.credit_until), online: this.online });\r\n        });\r\n        /**\r\n         * Returns the current world status, will always make a request to the server.\r\n         */\r\n        this.getStatus = () => this._api.getStatus();\r\n        /**\r\n         * Gets the server's lists\r\n         */\r\n        this.getLists = (refresh = false) => {\r\n            if (!this._cache.lists || refresh) {\r\n                this._cache.lists = this._api.getLists().then(lists => this._lists = lists);\r\n            }\r\n            return this._cache.lists\r\n                .then(lists => ({\r\n                adminlist: [...lists.adminlist],\r\n                modlist: [...lists.modlist],\r\n                whitelist: [...lists.whitelist],\r\n                blacklist: [...lists.blacklist]\r\n            }));\r\n        };\r\n        /**\r\n         * Sets the server's lists and reloads the world lists if required.\r\n         *\r\n         * @param lists WorldLists one or more list to update. If a list is not provided it will not be changed.\r\n         * @return a promise which will resolve when the lists have been updated, or throw if an error occurred.\r\n         */\r\n        this.setLists = (lists) => __awaiter(this, void 0, void 0, function* () {\r\n            let currentLists = yield this.getLists();\r\n            yield this._api.setLists(Object.assign({}, currentLists, lists));\r\n            yield this.getLists(true);\r\n        });\r\n        /**\r\n         * Gets the server logs\r\n         *\r\n         * @param refresh if true, will get the latest logs, otherwise will returned the cached version.\r\n         */\r\n        this.getLogs = (refresh = false) => __awaiter(this, void 0, void 0, function* () {\r\n            if (!this._cache.logs || refresh) {\r\n                const updatePlayers = !this._cache.logs;\r\n                this._cache.logs = this._api.getLogs();\r\n                if (updatePlayers)\r\n                    yield this._updatePlayers();\r\n            }\r\n            let lines = yield this._cache.logs;\r\n            return lines.slice().map(line => (Object.assign({}, line, { timestamp: cloneDate(line.timestamp) })));\r\n        });\r\n        /**\r\n         * Sends the specified message, returns a promise that will reject if the send fails and resolve otherwise.\r\n         *\r\n         * @param message the message to send\r\n         */\r\n        this.send = (message) => {\r\n            if (message.startsWith('/'))\r\n                this._events.onMessage.dispatch({ player: this.getPlayer('SERVER'), message });\r\n            return new Promise(resolve => {\r\n                this._messageQueue.push({\r\n                    message,\r\n                    callback: resolve\r\n                });\r\n                if (this._messageQueue.length === 1)\r\n                    this._executeMessageQueue();\r\n            });\r\n        };\r\n        /**\r\n         * Gets a specific player by name\r\n         */\r\n        this.getPlayer = (name) => {\r\n            name = name.toLocaleUpperCase();\r\n            let players = this._storage.get(PLAYERS_KEY, {});\r\n            return new Player(name, players[name] || { ip: '', ips: [], joins: 0 }, this._lists);\r\n        };\r\n        /**\r\n         * Adds a listener for a single command, can be used when a command can be statically matched.\r\n         *\r\n         * @param command the command that the listener should be called for, case insensitive\r\n         * @param listener the function which should be called whenever the command is used\r\n         * @example\r\n         * world.addCommand('marco', () => { ex.bot.send('Polo!'); });\r\n         */\r\n        this.addCommand = (command, listener) => {\r\n            command = command.toLocaleUpperCase();\r\n            if (this._commands.has(command)) {\r\n                throw new Error(`The command \"${command}\" has already been added.`);\r\n            }\r\n            this._commands.set(command, listener);\r\n        };\r\n        /**\r\n         * Removes a listener for a command, if it exists.\r\n         *\r\n         * @param command the command for which the listener should be removed.\r\n         */\r\n        this.removeCommand = (command) => {\r\n            this._commands.delete(command.toLocaleUpperCase());\r\n        };\r\n        /**\r\n         * Starts the world, if it is not already started. Will not reject.\r\n         */\r\n        this.start = () => this._api.start();\r\n        /**\r\n         * Stops the world if it is running. Will not throw.\r\n         */\r\n        this.stop = () => this._api.stop();\r\n        /**\r\n         * Sends a restart request, if the world is offline no actions will be taken.\r\n         */\r\n        this.restart = () => this._api.restart();\r\n        /**\r\n         * Starts the internal chat watcher\r\n         */\r\n        this.startWatchingChat = () => this._chatWatcher.start();\r\n        /**\r\n         * Stops the internal chat watcher.\r\n         */\r\n        this.stopWatchingChat = () => this._chatWatcher.stop();\r\n        this._api = api;\r\n        this._storage = storage;\r\n        this._lastLogUpdate = storage.get(LAST_UPDATE_KEY, 0);\r\n        this._messageQueue = [];\r\n        this._createWatcher();\r\n        this.getOverview(); // Sets the owner, gets initial online players\r\n        this.getLists(); // Loads the current server lists\r\n    }\r\n    /**\r\n     * Fires whenever a player joins the server\r\n     */\r\n    get onJoin() {\r\n        return this._events.onJoin.asEvent();\r\n    }\r\n    /**\r\n     * Fires whenever a player leaves the server.\r\n     */\r\n    get onLeave() {\r\n        return this._events.onLeave.asEvent();\r\n    }\r\n    /**\r\n     * Fires whenever a player or the server sends a message in chat.\r\n     * Includes messages starting with /\r\n     */\r\n    get onMessage() {\r\n        return this._events.onMessage.asEvent();\r\n    }\r\n    /**\r\n     * Fires whenever a message that cannot be parsed is encountered.\r\n     */\r\n    get onOther() {\r\n        // This class doesn't do anything with the onOther events, so just pass it through.\r\n        return this._chatWatcher.onOther;\r\n    }\r\n    /**\r\n     * Gets the currently online players\r\n     */\r\n    get online() {\r\n        return [...this._online];\r\n    }\r\n    /**\r\n     * Gets all players who have joined the server\r\n     */\r\n    get players() {\r\n        let players = this._storage.get(PLAYERS_KEY, {});\r\n        return Object.keys(players).map(this.getPlayer);\r\n    }\r\n    /**\r\n     * Internal init function\r\n     */\r\n    _createWatcher() {\r\n        let watcher = this._chatWatcher = new ChatWatcher(this._api, this._online);\r\n        watcher.onJoin.sub(arg => this._userJoin(arg));\r\n        watcher.onLeave.sub(name => this._events.onLeave.dispatch(this.getPlayer(name)));\r\n        watcher.onMessage.sub(({ name, message }) => {\r\n            const player = this.getPlayer(name);\r\n            this._events.onMessage.dispatch({ player, message });\r\n            updateLists(this._lists, player, message);\r\n        });\r\n        this.onMessage.sub(({ player, message }) => {\r\n            if (/^\\/[^ ]/.test(message)) {\r\n                const [, command, args] = message.match(/^\\/([^ ]+) ?(.*)$/);\r\n                const handler = this._commands.get(command.toLocaleUpperCase());\r\n                if (handler)\r\n                    handler(player, args);\r\n            }\r\n        });\r\n    }\r\n    _updatePlayers() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const lines = yield this.getLogs();\r\n            const { name } = yield this.getOverview();\r\n            for (const line of lines) {\r\n                if (line.timestamp.getTime() < this._lastLogUpdate)\r\n                    continue;\r\n                if (line.timestamp.getTime() > this._firstChatUpdate)\r\n                    continue;\r\n                if (!line.message.startsWith(`${name} - Player Connected`))\r\n                    continue;\r\n                const [, user, ip] = line.message.match(/Connected ([^a-z]{3,}) \\| ([\\d.]+) \\| .{32}$/);\r\n                this._recordJoin({ name: user, ip });\r\n            }\r\n        });\r\n    }\r\n    _recordJoin({ name, ip }) {\r\n        name = name.toLocaleUpperCase();\r\n        this._storage.with(PLAYERS_KEY, {}, players => {\r\n            const player = players[name] = players[name] || { ip, ips: [ip], joins: 0 };\r\n            player.joins++;\r\n            player.ip = ip;\r\n            if (!player.ips.includes(ip))\r\n                player.ips.push(ip);\r\n        });\r\n        // Prevent this join from being counted twice\r\n        this._storage.set(LAST_UPDATE_KEY, Date.now());\r\n    }\r\n    _userJoin({ name, ip }) {\r\n        this._recordJoin({ name, ip });\r\n        this._events.onJoin.dispatch(this.getPlayer(name));\r\n    }\r\n    /**\r\n     * Sends messages in the message queue one by one to prevent the api from concatenating 2 messages into 1.\r\n     */\r\n    _executeMessageQueue() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            while (this._messageQueue.length > 0) {\r\n                const { message, callback } = this._messageQueue[0];\r\n                try {\r\n                    yield this._api.send(message);\r\n                    yield delay(1000);\r\n                }\r\n                catch (_) { }\r\n                callback();\r\n                this._messageQueue.shift();\r\n            }\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=world.js.map","/**\r\n * The storage class used by the [[MessageBot]] class and all [[MessageBotExtension]] instances.\r\n */\r\nexport class Storage {\r\n    /**\r\n     * Utility method to use and automatically save a key\r\n     * @param key the key use when getting and setting the value\r\n     * @param fallback the fallback if the key doesn't exist\r\n     * @param callback the function to be called with the data, if the callback returns null or undefined, it is assumed that the value has been mutated and will be saved.\r\n     */\r\n    with(key, fallback, callback) {\r\n        let value = this.get(key, fallback);\r\n        let result = callback(value);\r\n        this.set(key, result == null ? value : result);\r\n    }\r\n}\r\n//# sourceMappingURL=storage.js.map","var __rest = (this && this.__rest) || function (s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n};\r\nimport { MessageBotExtension } from './extension';\r\nimport { World } from './world';\r\nimport { Player } from './player';\r\nimport { Storage } from './storage';\r\nimport { SimpleEvent } from './events';\r\nexport { MessageBotExtension, World, Player, Storage, SimpleEvent };\r\nlet registeredExtensions = new Map();\r\nlet extensionRegistered = new SimpleEvent();\r\nlet extensionDeregistered = new SimpleEvent();\r\nexport class MessageBot {\r\n    /**\r\n     *\r\n     * @param storage The storage instance to be used by the bot.\r\n     * @param info The world info that is used to create the API to interact with the world.\r\n     */\r\n    constructor(storage, info) {\r\n        this.storage = storage;\r\n        /**\r\n         * All loaded extension instances for this bot.\r\n         */\r\n        this._extensions = new Map();\r\n        if (!MessageBot.dependencies)\r\n            throw new Error('Dependencies must be set before creating this class.');\r\n        this.world = new World(new MessageBot.dependencies.Api(info), storage);\r\n    }\r\n    /**\r\n     * Registers an extension that can be loaded by instances of the bot.\r\n     * Note: If an extension has already been loaded from a previously registered initializer, it will not be overwritten.\r\n     * @param id the extension ID, will be normalized to lower case.\r\n     * @param initializer the function to be called to set up the extension.\r\n     */\r\n    static registerExtension(id, initializer) {\r\n        id = id.toLocaleLowerCase();\r\n        registeredExtensions.set(id, initializer);\r\n        extensionRegistered.dispatch(id);\r\n    }\r\n    /**\r\n     * Removes an extension initializer from the registry, can be used to prevent an extension from being loaded in multiple bots at once (generally a bad idea).\r\n     * @param id the id of the extension to deregister\r\n     */\r\n    static deregisterExtension(id) {\r\n        id = id.toLocaleLowerCase();\r\n        if (registeredExtensions.delete(id)) {\r\n            extensionDeregistered.dispatch(id);\r\n        }\r\n    }\r\n    /**\r\n     * An array of all registered extensions.\r\n     */\r\n    static get extensions() {\r\n        return [...registeredExtensions.keys()];\r\n    }\r\n    /**\r\n     * An array of currently loaded extension ids\r\n     */\r\n    get extensions() {\r\n        return [...this._extensions.keys()];\r\n    }\r\n    /**\r\n     * Shortcut for `MessageBot.dependencies.fetch`\r\n     */\r\n    get fetch() {\r\n        return MessageBot.dependencies.fetch;\r\n    }\r\n    /**\r\n     * Starts listening to chat.\r\n     */\r\n    start() {\r\n        this.world.startWatchingChat();\r\n    }\r\n    /**\r\n     * Gets the exports of an extension, returns undefined if the extension is not loaded.\r\n     * @param id the extension id to get exports from\r\n     */\r\n    getExports(id) {\r\n        let ex = this._extensions.get(id.toLocaleLowerCase());\r\n        if (ex)\r\n            return ex.exports;\r\n    }\r\n    /**\r\n     * Adds an extension to this bot. Calls the init function supplied when registering the extension.\r\n     * @param id the id of the registered extension to add.\r\n     */\r\n    addExtension(id) {\r\n        id = id.toLocaleLowerCase();\r\n        if (this._extensions.has(id))\r\n            throw new Error(`The ${id} extension has already been added.`);\r\n        let creator = registeredExtensions.get(id);\r\n        if (!creator)\r\n            throw new Error(`The ${id} extension has not been registered.`);\r\n        let ex = new MessageBotExtension(id, this);\r\n        this._extensions.set(id, ex);\r\n        creator.call(ex, ex, this.world);\r\n    }\r\n    /**\r\n     * Removes a currently loaded extension. Should not be used by published extensions unless\r\n     * the extension is an extension manager.\r\n     * @param id the id of the extension to remove\r\n     * @param uninstall whether or not the extension should be completely removed, or just unloaded.\r\n     */\r\n    removeExtension(id, uninstall) {\r\n        id = id.toLocaleLowerCase();\r\n        let ex = this._extensions.get(id);\r\n        if (!ex)\r\n            throw new Error(`The ${id} extension is not registered.`);\r\n        try {\r\n            if (uninstall) {\r\n                ex.uninstall();\r\n            }\r\n            else {\r\n                ex.remove();\r\n            }\r\n        }\r\n        finally {\r\n            this._extensions.delete(id);\r\n        }\r\n    }\r\n    /**\r\n     * Sends a message to the world for this bot, should usually be used in place of world.send.\r\n     *\r\n     * @param message the message to send\r\n     * @param params any variables to inject into the message. If `name` is provided, it will be available through {{NAME}}, {{Name}} and {{name}}\r\n     */\r\n    send(message, _a = {}) {\r\n        var params = __rest(_a, []);\r\n        // Common enough to be done here, set the name of the player up right.\r\n        if (params.name && params.name.length) {\r\n            let name = params.name.toLocaleLowerCase();\r\n            params = Object.assign({}, params, { name, Name: name[0].toLocaleUpperCase() + name.substr(1), NAME: name.toLocaleUpperCase() });\r\n        }\r\n        let safeKeyRegex = Object.keys(params)\r\n            .map(key => key.replace(/([.+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1'))\r\n            .join('}}|{{');\r\n        // Don't bother replacing if nothing to search for\r\n        if (safeKeyRegex.length) {\r\n            message = message.replace(new RegExp(`{{${safeKeyRegex}}}`, 'g'), (key) => {\r\n                return params[key.substring(2, key.length - 2)];\r\n            });\r\n        }\r\n        this.world.send(message).catch(() => { });\r\n    }\r\n}\r\n/**\r\n * An event that fires whenever an extension is registered or re-registered.\r\n */\r\nMessageBot.extensionRegistered = extensionRegistered.asEvent();\r\n/**\r\n * An event that fires when an extension is deregistered, if it has been registered. Will not fire when an extension is re-registered.\r\n */\r\nMessageBot.extensionDeregistered = extensionDeregistered.asEvent();\r\n//# sourceMappingURL=index.js.map","import { MessageBot as Bot } from '@bhmb/bot'\n\n// Custom bot class to support splitting messages\n\nexport class MessageBot extends Bot implements Bot {\n    send(message: string, { ...params }: {[key: string]: string} = {}): void {\n        let messages: string[]\n        // Split the message if splitting is enabled.\n        if (this.storage.get('splitMessages', false)) {\n            messages = message.split(this.storage.get('splitToken', '<split>'))\n        } else {\n            messages = [message]\n        }\n\n        for (const msg of messages) {\n            super.send(msg, params)\n        }\n    }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { createHash } from 'crypto';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\n/**\r\n * This module should not be used by consumers of this library.\r\n * @private\r\n */\r\n/**\r\n * Parses logs from the portal into a standard format. If you are consuming this library, you don't need to know anything about it.\r\n * @private\r\n */\r\nclass LogParser {\r\n    /**\r\n     * Creates a new instance of the LogParser class.\r\n     */\r\n    constructor() {\r\n        /**\r\n         * Parses the logs into a standard format.\r\n         *\r\n         * @param lines the raw log lines.\r\n         */\r\n        this.parse = (lines) => {\r\n            // Copy the lines array\r\n            lines = lines.slice(0);\r\n            // Assume first line is valid, if it isn't it will be dropped.\r\n            for (let i = lines.length - 1; i > 0; i--) {\r\n                const line = lines[i];\r\n                if (!this.isValidLine(line)) {\r\n                    lines[i - 1] += '\\n' + lines.splice(i, 1);\r\n                    continue;\r\n                }\r\n                this.addLine(line);\r\n            }\r\n            if (this.isValidLine(lines[0])) {\r\n                this.addLine(lines[0]);\r\n            }\r\n            const entries = this.entries.reverse();\r\n            this.entries = [];\r\n            return entries;\r\n        };\r\n        this.isValidLine = (line) => {\r\n            return /^\\d{4}-\\d\\d-\\d\\d \\d\\d:\\d\\d:\\d\\d\\.\\d{3} blockheads_server/.test(line);\r\n        };\r\n        this.addLine = (line) => {\r\n            const ts = line.substr(0, 24)\r\n                .replace(' ', 'T')\r\n                .replace(' ', 'Z');\r\n            this.entries.push({\r\n                raw: line,\r\n                timestamp: new Date(ts),\r\n                message: line.substr(line.indexOf(']') + 2)\r\n            });\r\n        };\r\n        this.entries = [];\r\n    }\r\n}\n\nfunction sha1(str) {\r\n    return createHash('sha1')\r\n        .update(str)\r\n        .digest('hex');\r\n}\r\nconst root = 'http://portal.theblockheads.net';\r\nlet request;\r\ntry {\r\n    request = fetch;\r\n}\r\ncatch (_) { }\r\n// Makes it possible to set the fetch function which the module uses. Necessary for terminal usage.\r\nfunction setFetch(fn) {\r\n    request = fn;\r\n}\r\nfunction unescapeHTML(html) {\r\n    const map = {\r\n        'lt': '<',\r\n        'gt': '>',\r\n        'amp': '&',\r\n        '#39': '\\'',\r\n        'quot': '\"',\r\n    };\r\n    return html.replace(/&(lt|gt|amp|#39|quot);/g, (_, first) => map[first]);\r\n}\r\nfunction makeRequest(url, options = {}) {\r\n    const headers = { 'X-Requested-With': 'XMLHttpRequest' };\r\n    if (options.method == 'POST') {\r\n        headers['Content-Type'] = 'application/x-www-form-urlencoded';\r\n    }\r\n    return request(`${root}${url}`, Object.assign({ mode: 'same-origin', credentials: 'same-origin', redirect: 'follow', headers }, options));\r\n}\r\nfunction requestJSON(url, options) {\r\n    return makeRequest(url, options).then(r => r.json());\r\n}\r\nfunction requestPage(url, options) {\r\n    return makeRequest(url, options).then(r => r.text());\r\n}\r\n/**\r\n* Function to try to log in, if the log in fails, the returned promise will reject, otherwise it will resolve.\r\n*\r\n* @param username the username to try to log in with\r\n* @param password the password to try to log in with\r\n*/\r\nfunction login(username, password) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        username = username.toLocaleUpperCase();\r\n        const info = yield requestJSON('/login', {\r\n            method: 'POST',\r\n            body: `username=${encodeURIComponent(username)}`,\r\n        });\r\n        if (info.status != 'ok')\r\n            throw new Error('Bad API response.');\r\n        let hashedPass = sha1(info.salt + password);\r\n        hashedPass = sha1(hashedPass + info.salt2);\r\n        const body = `seed=${info.seed}&password=${hashedPass}&username=${encodeURIComponent(username)}`;\r\n        const page = yield requestPage('/login', { body, method: 'POST' });\r\n        if (page.includes('Invalid username / password')) {\r\n            throw new Error('Invalid username or password.');\r\n        }\r\n    });\r\n}\r\n/**\r\n* Gets all worlds owned by the logged in user.\r\n*/\r\nfunction getWorlds() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        const page = yield requestPage('/worlds');\r\n        const lines = page.split('\\n');\r\n        const worlds = [];\r\n        lines.forEach(line => {\r\n            if (/\\t\\tupdateWorld/.test(line)) {\r\n                const name = line.match(/name: '([^']+?)'/);\r\n                const id = line.match(/id: (\\d+)/);\r\n                worlds.push({\r\n                    name: unescapeHTML(name[1]),\r\n                    id: id[1]\r\n                });\r\n            }\r\n        });\r\n        return worlds;\r\n    });\r\n}\r\n/** @inheritdoc */\r\nclass Api {\r\n    constructor(info) {\r\n        this.info = info;\r\n        this.parser = new LogParser();\r\n        /** @inheritdoc */\r\n        this.getLists = () => __awaiter(this, void 0, void 0, function* () {\r\n            const page = yield requestPage(`/worlds/lists/${this.info.id}`);\r\n            const getList = (name) => {\r\n                let names = [];\r\n                const list = page.match(new RegExp(`<textarea name=\"${name}\">([\\\\s\\\\S]*?)</textarea>`));\r\n                if (list) {\r\n                    names = unescapeHTML(list[1])\r\n                        .split(/\\r?\\n/);\r\n                }\r\n                // Remove duplicates / blank lines\r\n                return Array.from(new Set(names)).filter(Boolean);\r\n            };\r\n            return {\r\n                adminlist: getList('admins'),\r\n                modlist: getList('modlist'),\r\n                whitelist: getList('whitelist'),\r\n                blacklist: getList('blacklist'),\r\n            };\r\n        });\r\n        /** @inheritdoc */\r\n        this.setLists = (lists) => __awaiter(this, void 0, void 0, function* () {\r\n            const makeSafe = (list) => encodeURIComponent(list.join('\\n'));\r\n            let body = `admins=${makeSafe(lists.adminlist)}`;\r\n            body += `&modlist=${makeSafe(lists.modlist)}`;\r\n            body += `&whitelist=${makeSafe(lists.whitelist)}`;\r\n            body += `&blacklist=${makeSafe(lists.blacklist)}`;\r\n            yield requestJSON(`/worlds/lists/${this.info.id}`, {\r\n                method: 'POST',\r\n                body\r\n            });\r\n        });\r\n        /** @inheritdoc */\r\n        this.getOverview = () => __awaiter(this, void 0, void 0, function* () {\r\n            const page = yield requestPage(`/worlds/${this.info.id}`);\r\n            const firstMatch = (r, fallback = '') => {\r\n                const m = page.match(r);\r\n                return m ? m[1] : fallback;\r\n            };\r\n            const privacy = firstMatch(/^\\$\\('#privacy'\\).val\\('(.*?)'\\)/m, 'public');\r\n            let online = [];\r\n            const match = page.match(/^\\t<tr><td class=\"left\">(.*?)(?=<\\/td>)/gm);\r\n            if (match) {\r\n                online = online.concat(match.map(s => s.substr(22)));\r\n            }\r\n            // This is very messy, refactoring welcome.\r\n            return {\r\n                name: firstMatch(/^\\t<title>(.*?) Manager \\| Portal<\\/title>$/m),\r\n                owner: firstMatch(/^\\t\\t<td class=\"right\">Owner:<\\/td>\\r?\\n\\t\\t<td>(.*?)<\\/td>$/m),\r\n                created: new Date(firstMatch(/^\\t\\t<td>Created:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                last_activity: new Date(firstMatch(/^\\t\\t<td>Last Activity:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                credit_until: new Date(firstMatch(/^\\t\\t<td>Credit Until:<\\/td><td>(.*?)<\\/td>$/m) + ' GMT-0000'),\r\n                link: firstMatch(/^\\t<tr><td>Link:<\\/td><td><a href=\"(.*?)\">\\1<\\/a>/m),\r\n                pvp: !!firstMatch(/^\\$\\('#pvp'\\)\\./m),\r\n                privacy,\r\n                password: firstMatch(/^\\t\\t<td>Password:<\\/td><td>(Yes|No)<\\/td><\\/tr>$/m) == 'Yes',\r\n                size: firstMatch(/^\\t\\t<td>Size:<\\/td><td>(.*?)<\\/td>$/m),\r\n                whitelist: firstMatch(/<td>Whitelist:<\\/td><td>(Yes|No)<\\/td>/m) == 'Yes',\r\n                online,\r\n                status: firstMatch(/^updateWorld\\({id: \\d+, worldStatus: '(.*?)'/m)\r\n            };\r\n        });\r\n        /** @inheritdoc */\r\n        this.getLogs = () => {\r\n            return requestPage(`/worlds/logs/${this.info.id}`)\r\n                .then(log => log.split('\\n'))\r\n                .then(lines => this.parser.parse(lines));\r\n        };\r\n        /** @inheritdoc */\r\n        this.getMessages = (lastId = 0) => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=getchat&worldId=${this.info.id}&firstId=${lastId}`\r\n            })\r\n                .then(({ status, log, nextId }) => {\r\n                if (status != 'ok')\r\n                    return { log: [], nextId: 0 }; // Reset, world likely offline.\r\n                return { nextId, log };\r\n            }, () => ({ log: [], nextId: lastId })); //Network error, don't reset nextId\r\n        };\r\n        /** @inheritdoc */\r\n        this.getStatus = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=status&worldId=${this.info.id}`\r\n            }).then(response => response.worldStatus);\r\n        };\r\n        /** @inheritdoc */\r\n        this.send = (message) => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=send&worldId=${this.info.id}&message=${encodeURIComponent(message)}`\r\n            }).then(result => {\r\n                if (result.status == 'ok')\r\n                    return;\r\n                throw new Error(`Unable to send ${message}`);\r\n            });\r\n        };\r\n        /** @inheritdoc */\r\n        this.start = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=start&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n        /** @inheritdoc */\r\n        this.stop = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=stop&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n        /** @inheritdoc */\r\n        this.restart = () => {\r\n            return requestJSON('/api', {\r\n                method: 'POST',\r\n                body: `command=reboot&worldId=${this.info.id}`\r\n            })\r\n                .then(() => undefined, console.error);\r\n        };\r\n    }\r\n    /** @inheritdoc */\r\n    get name() {\r\n        return this.info.name;\r\n    }\r\n    /** @inheritdoc */\r\n    get id() {\r\n        return this.info.id;\r\n    }\r\n}\n\nexport { Api, getWorlds, login, setFetch };\n","var toString = Object.prototype.toString;\n\nmodule.exports = function kindOf(val) {\n  if (val === void 0) return 'undefined';\n  if (val === null) return 'null';\n\n  var type = typeof val;\n  if (type === 'boolean') return 'boolean';\n  if (type === 'string') return 'string';\n  if (type === 'number') return 'number';\n  if (type === 'symbol') return 'symbol';\n  if (type === 'function') {\n    return isGeneratorFn(val) ? 'generatorfunction' : 'function';\n  }\n\n  if (isArray(val)) return 'array';\n  if (isBuffer(val)) return 'buffer';\n  if (isArguments(val)) return 'arguments';\n  if (isDate(val)) return 'date';\n  if (isError(val)) return 'error';\n  if (isRegexp(val)) return 'regexp';\n\n  switch (ctorName(val)) {\n    case 'Symbol': return 'symbol';\n    case 'Promise': return 'promise';\n\n    // Set, Map, WeakSet, WeakMap\n    case 'WeakMap': return 'weakmap';\n    case 'WeakSet': return 'weakset';\n    case 'Map': return 'map';\n    case 'Set': return 'set';\n\n    // 8-bit typed arrays\n    case 'Int8Array': return 'int8array';\n    case 'Uint8Array': return 'uint8array';\n    case 'Uint8ClampedArray': return 'uint8clampedarray';\n\n    // 16-bit typed arrays\n    case 'Int16Array': return 'int16array';\n    case 'Uint16Array': return 'uint16array';\n\n    // 32-bit typed arrays\n    case 'Int32Array': return 'int32array';\n    case 'Uint32Array': return 'uint32array';\n    case 'Float32Array': return 'float32array';\n    case 'Float64Array': return 'float64array';\n  }\n\n  if (isGeneratorObj(val)) {\n    return 'generator';\n  }\n\n  // Non-plain objects\n  type = toString.call(val);\n  switch (type) {\n    case '[object Object]': return 'object';\n    // iterators\n    case '[object Map Iterator]': return 'mapiterator';\n    case '[object Set Iterator]': return 'setiterator';\n    case '[object String Iterator]': return 'stringiterator';\n    case '[object Array Iterator]': return 'arrayiterator';\n  }\n\n  // other\n  return type.slice(8, -1).toLowerCase().replace(/\\s/g, '');\n};\n\nfunction ctorName(val) {\n  return val.constructor ? val.constructor.name : null;\n}\n\nfunction isArray(val) {\n  if (Array.isArray) return Array.isArray(val);\n  return val instanceof Array;\n}\n\nfunction isError(val) {\n  return val instanceof Error || (typeof val.message === 'string' && val.constructor && typeof val.constructor.stackTraceLimit === 'number');\n}\n\nfunction isDate(val) {\n  if (val instanceof Date) return true;\n  return typeof val.toDateString === 'function'\n    && typeof val.getDate === 'function'\n    && typeof val.setDate === 'function';\n}\n\nfunction isRegexp(val) {\n  if (val instanceof RegExp) return true;\n  return typeof val.flags === 'string'\n    && typeof val.ignoreCase === 'boolean'\n    && typeof val.multiline === 'boolean'\n    && typeof val.global === 'boolean';\n}\n\nfunction isGeneratorFn(name, val) {\n  return ctorName(name) === 'GeneratorFunction';\n}\n\nfunction isGeneratorObj(val) {\n  return typeof val.throw === 'function'\n    && typeof val.return === 'function'\n    && typeof val.next === 'function';\n}\n\nfunction isArguments(val) {\n  try {\n    if (typeof val.length === 'number' && typeof val.callee === 'function') {\n      return true;\n    }\n  } catch (err) {\n    if (err.message.indexOf('callee') !== -1) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * If you need to support Safari 5-7 (8-10 yr-old browser),\n * take a look at https://github.com/feross/is-buffer\n */\n\nfunction isBuffer(val) {\n  if (val.constructor && typeof val.constructor.isBuffer === 'function') {\n    return val.constructor.isBuffer(val);\n  }\n  return false;\n}\n","/*!\n * shallow-clone <https://github.com/jonschlinkert/shallow-clone>\n *\n * Copyright (c) 2015-present, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nconst valueOf = Symbol.prototype.valueOf;\nconst typeOf = require('kind-of');\n\nfunction clone(val, deep) {\n  switch (typeOf(val)) {\n    case 'array':\n      return val.slice();\n    case 'object':\n      return Object.assign({}, val);\n    case 'date':\n      return new val.constructor(Number(val));\n    case 'map':\n      return new Map(val);\n    case 'set':\n      return new Set(val);\n    case 'buffer':\n      return cloneBuffer(val);\n    case 'symbol':\n      return cloneSymbol(val);\n    case 'arraybuffer':\n      return cloneArrayBuffer(val);\n    case 'float32array':\n    case 'float64array':\n    case 'int16array':\n    case 'int32array':\n    case 'int8array':\n    case 'uint16array':\n    case 'uint32array':\n    case 'uint8clampedarray':\n    case 'uint8array':\n      return cloneTypedArray(val);\n    case 'regexp':\n      return cloneRegExp(val);\n    case 'error':\n      return Object.create(val);\n    default: {\n      return val;\n    }\n  }\n}\n\nfunction cloneRegExp(val) {\n  const flags = val.flags !== void 0 ? val.flags : (/\\w+$/.exec(val) || void 0);\n  const re = new val.constructor(val.source, flags);\n  re.lastIndex = val.lastIndex;\n  return re;\n}\n\nfunction cloneArrayBuffer(val) {\n  const res = new val.constructor(val.byteLength);\n  new Uint8Array(res).set(new Uint8Array(val));\n  return res;\n}\n\nfunction cloneTypedArray(val, deep) {\n  return new val.constructor(val.buffer, val.byteOffset, val.length);\n}\n\nfunction cloneBuffer(val) {\n  const len = val.length;\n  const buf = Buffer.allocUnsafe ? Buffer.allocUnsafe(len) : Buffer.from(len);\n  val.copy(buf);\n  return buf;\n}\n\nfunction cloneSymbol(val) {\n  return valueOf ? Object(valueOf.call(val)) : {};\n}\n\n/**\n * Expose `clone`\n */\n\nmodule.exports = clone;\n","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n};\n","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2017, Jon Schlinkert.\n * Released under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n\n  if (isObjectObject(o) === false) return false;\n\n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n\n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n\n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n\n  // Most likely a plain Object\n  return true;\n};\n","'use strict';\n\n/**\n * Module dependenices\n */\n\nconst clone = require('shallow-clone');\nconst typeOf = require('kind-of');\nconst isPlainObject = require('is-plain-object');\n\nfunction cloneDeep(val, instanceClone) {\n  switch (typeOf(val)) {\n    case 'object':\n      return cloneObjectDeep(val, instanceClone);\n    case 'array':\n      return cloneArrayDeep(val, instanceClone);\n    default: {\n      return clone(val);\n    }\n  }\n}\n\nfunction cloneObjectDeep(val, instanceClone) {\n  if (typeof instanceClone === 'function') {\n    return instanceClone(val);\n  }\n  if (instanceClone || isPlainObject(val)) {\n    const res = new val.constructor();\n    for (let key in val) {\n      res[key] = cloneDeep(val[key], instanceClone);\n    }\n    return res;\n  }\n  return val;\n}\n\nfunction cloneArrayDeep(val, instanceClone) {\n  const res = new val.constructor(val.length);\n  for (let i = 0; i < val.length; i++) {\n    res[i] = cloneDeep(val[i], instanceClone);\n  }\n  return res;\n}\n\n/**\n * Expose `cloneDeep`\n */\n\nmodule.exports = cloneDeep;\n","import { Storage as AStorage } from '@bhmb/bot'\nimport cloneDeep from 'clone-deep'\n\n// A cache to avoid repeatedly parsing large JSON objects\n// when getting stuff from storage.\nconst storageCache = new Map<string, any>()\n\n// Keys which should be written back to localStorage when possible.\nconst writeback = new Set<string>()\n\nfunction writeStorage () {\n    if (writeback.size === 0) return\n\n    for (const key of writeback) {\n        localStorage.setItem(key, JSON.stringify(storageCache.get(key)))\n    }\n    writeback.clear()\n}\n\n// Write to localStorage every 10 seconds max\nsetInterval(writeStorage, 10 * 1000)\n// Prevent lost changes if the user reloads the page before 10 seconds have elapsed.\nwindow.addEventListener('unload', writeStorage)\n\nexport class Storage extends AStorage {\n    constructor(private head: string) {\n        super()\n        // For readability\n        this.head += '/'\n    }\n\n    get<T>(key: string, fallback: T): T {\n        const fullKey = this.head + key\n        // Get the cached value if there is one.\n        if (storageCache.has(fullKey)) {\n            return cloneDeep(storageCache.get(fullKey))\n        }\n\n        try {\n            // JSON.parse correctly handles null so it's fine to declare this as string.\n            const item = localStorage.getItem(fullKey) as string\n            const parsed = JSON.parse(item)\n            if (parsed != null) {\n                storageCache.set(fullKey, parsed)\n                return cloneDeep(parsed)\n            }\n            return fallback\n        } catch {\n            return fallback\n        }\n    }\n\n    set(key: string, value: any): void {\n        const fullKey = this.head + key\n        storageCache.set(fullKey, cloneDeep(value))\n\n\n\n\n        writeback.add(fullKey)\n    }\n\n    clear(prefix: string = ''): void {\n        this.keys(prefix)\n            .forEach(key => {\n                writeback.delete(this.head + key)\n                storageCache.delete(this.head + key)\n                localStorage.removeItem(this.head + key)\n            })\n    }\n\n    keys(prefix: string = ''): string[] {\n        return Object.keys(localStorage)\n            .filter(key => key.startsWith(this.head + prefix))\n            .map(key => key.substr(this.head.length))\n    }\n\n    prefix(prefix: string): AStorage {\n        return new Storage(this.head + prefix)\n    }\n}\n","import { MessageBot } from '@bhmb/bot';\n\nfunction checkJoins(player, message) {\r\n    return player.joins >= message.joins_low && player.joins <= message.joins_high;\r\n}\r\nfunction checkGroups(player, message) {\r\n    return isInGroup(player, message.group) && !isInGroup(player, message.not_group);\r\n}\r\nfunction isInGroup(player, group) {\r\n    switch (group) {\r\n        case 'all':\r\n            return true;\r\n        case 'staff':\r\n            return player.isStaff;\r\n        case 'mod':\r\n            return player.isMod;\r\n        case 'admin':\r\n            return player.isAdmin;\r\n        case 'owner':\r\n            return player.isOwner;\r\n        default:\r\n            return false;\r\n    }\r\n}\n\nconst cooldowns = new WeakMap();\r\nclass RemovableMessageHelper {\r\n    constructor(id, ex) {\r\n        this.id = id;\r\n        this.ex = ex;\r\n        if (!cooldowns.has(ex))\r\n            cooldowns.set(ex, { rejoin: [], trigger: [] });\r\n    }\r\n    get messages() {\r\n        return this.ex.storage.get(this.id, []);\r\n    }\r\n    onCooldown(player, type, key, fallback) {\r\n        const cd = cooldowns.get(this.ex)[type].find(cd => cd.name === player.name);\r\n        if (!cd)\r\n            return false;\r\n        return cd.time + this.ex.storage.get(key, fallback) * 1000 > Date.now();\r\n    }\r\n    addCooldown(player, type) {\r\n        const cd = cooldowns.get(this.ex)[type];\r\n        cd.unshift({ name: player.name, time: Date.now() });\r\n        cd.length = Math.min(32, cd.length);\r\n    }\r\n}\r\nclass JoinListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('joinArr', ex);\r\n        this.listener = (player) => {\r\n            if (this.onCooldown(player, 'rejoin', 'rejoinCooldown', 30))\r\n                return;\r\n            this.addCooldown(player, 'rejoin');\r\n            for (let msg of this.messages) {\r\n                if (checkJoins(player, msg) && checkGroups(player, msg)) {\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onJoin.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onJoin.unsub(this.listener);\r\n    }\r\n}\r\nclass LeaveListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('leaveArr', ex);\r\n        this.listener = (player) => {\r\n            if (this.onCooldown(player, 'rejoin', 'rejoinCooldown', 30))\r\n                return;\r\n            this.addCooldown(player, 'rejoin');\r\n            for (let msg of this.messages) {\r\n                if (checkJoins(player, msg) && checkGroups(player, msg)) {\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onLeave.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onLeave.unsub(this.listener);\r\n    }\r\n}\r\nclass TriggerListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('triggerArr', ex);\r\n        this.listener = ({ player, message }) => {\r\n            if (player.name == 'SERVER')\r\n                return;\r\n            if (this.onCooldown(player, 'trigger', 'triggerCooldown', 10))\r\n                return;\r\n            let responses = 0;\r\n            for (let msg of this.messages) {\r\n                let checks = [\r\n                    checkJoins(player, msg),\r\n                    checkGroups(player, msg),\r\n                    this.triggerMatches(message, msg.trigger)\r\n                ];\r\n                if (checks.every(Boolean) && ++responses <= this.ex.storage.get('maxResponses', 3)) {\r\n                    this.addCooldown(player, 'trigger');\r\n                    this.ex.bot.send(msg.message, { name: player.name });\r\n                }\r\n            }\r\n        };\r\n        this.ex.world.onMessage.sub(this.listener);\r\n    }\r\n    remove() {\r\n        this.ex.world.onMessage.unsub(this.listener);\r\n    }\r\n    triggerMatches(message, trigger) {\r\n        if (!this.ex.storage.get('disableWhitespaceTrimming', false)) {\r\n            trigger = trigger.trim();\r\n        }\r\n        if (this.ex.storage.get('regexTriggers', false)) {\r\n            try {\r\n                return new RegExp(trigger, 'i').test(message);\r\n            }\r\n            catch (_a) {\r\n                return false;\r\n            }\r\n        }\r\n        trigger = trigger.replace(/([.+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\").replace(/\\*/g, \".*\");\r\n        return new RegExp(trigger, 'i').test(message);\r\n    }\r\n}\r\nclass AnnouncementListener extends RemovableMessageHelper {\r\n    constructor(ex) {\r\n        super('announcementArr', ex);\r\n        this.index = 0;\r\n        this.run = () => {\r\n            if (this.index >= this.messages.length)\r\n                this.index = 0;\r\n            if (!this.ex.world.online.length) {\r\n                this.index = 0;\r\n            }\r\n            else {\r\n                const data = this.messages[this.index++];\r\n                if (data && data.message)\r\n                    this.ex.bot.send(data.message);\r\n            }\r\n            this.timeoutId = setTimeout(this.run, this.delay);\r\n        };\r\n        this.timeoutId = setTimeout(this.run, this.delay);\r\n    }\r\n    get delay() {\r\n        return this.ex.storage.get('announcementDelay', 10) * 60000;\r\n    }\r\n    remove() {\r\n        // This will also work with Timer, but Typescript doesn't know that.\r\n        clearTimeout(this.timeoutId);\r\n    }\r\n}\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\nvar atoa = function atoa (a, n) { return Array.prototype.slice.call(a, n); };\n\nvar si = typeof setImmediate === 'function', tick;\nif (si) {\n  tick = function (fn) { setImmediate(fn); };\n} else if (typeof process !== 'undefined' && process.nextTick) {\n  tick = process.nextTick;\n} else {\n  tick = function (fn) { setTimeout(fn, 0); };\n}\n\nvar ticky = tick;\n\nvar debounce = function debounce (fn, args, ctx) {\n  if (!fn) { return; }\n  ticky(function run () {\n    fn.apply(ctx || null, args || []);\n  });\n};\n\nvar emitter = function emitter (thing, options) {\n  var opts = options || {};\n  var evt = {};\n  if (thing === undefined) { thing = {}; }\n  thing.on = function (type, fn) {\n    if (!evt[type]) {\n      evt[type] = [fn];\n    } else {\n      evt[type].push(fn);\n    }\n    return thing;\n  };\n  thing.once = function (type, fn) {\n    fn._once = true; // thing.off(fn) still works!\n    thing.on(type, fn);\n    return thing;\n  };\n  thing.off = function (type, fn) {\n    var c = arguments.length;\n    if (c === 1) {\n      delete evt[type];\n    } else if (c === 0) {\n      evt = {};\n    } else {\n      var et = evt[type];\n      if (!et) { return thing; }\n      et.splice(et.indexOf(fn), 1);\n    }\n    return thing;\n  };\n  thing.emit = function () {\n    var args = atoa(arguments);\n    return thing.emitterSnapshot(args.shift()).apply(this, args);\n  };\n  thing.emitterSnapshot = function (type) {\n    var et = (evt[type] || []).slice(0);\n    return function () {\n      var args = atoa(arguments);\n      var ctx = this || thing;\n      if (type === 'error' && opts.throws !== false && !et.length) { throw args.length === 1 ? args[0] : args; }\n      et.forEach(function emitter (listen) {\n        if (opts.async) { debounce(listen, args, ctx); } else { listen.apply(ctx, args); }\n        if (listen._once) { thing.off(type, listen); }\n      });\n      return thing;\n    };\n  };\n  return thing;\n};\n\nvar NativeCustomEvent = commonjsGlobal.CustomEvent;\n\nfunction useNative () {\n  try {\n    var p = new NativeCustomEvent('cat', { detail: { foo: 'bar' } });\n    return  'cat' === p.type && 'bar' === p.detail.foo;\n  } catch (e) {\n  }\n  return false;\n}\n\n/**\n * Cross-browser `CustomEvent` constructor.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent.CustomEvent\n *\n * @public\n */\n\nvar customEvent = useNative() ? NativeCustomEvent :\n\n// IE >= 9\n'function' === typeof document.createEvent ? function CustomEvent (type, params) {\n  var e = document.createEvent('CustomEvent');\n  if (params) {\n    e.initCustomEvent(type, params.bubbles, params.cancelable, params.detail);\n  } else {\n    e.initCustomEvent(type, false, false, void 0);\n  }\n  return e;\n} :\n\n// IE <= 8\nfunction CustomEvent (type, params) {\n  var e = document.createEventObject();\n  e.type = type;\n  if (params) {\n    e.bubbles = Boolean(params.bubbles);\n    e.cancelable = Boolean(params.cancelable);\n    e.detail = params.detail;\n  } else {\n    e.bubbles = false;\n    e.cancelable = false;\n    e.detail = void 0;\n  }\n  return e;\n};\n\nvar eventmap = [];\nvar eventname = '';\nvar ron = /^on/;\n\nfor (eventname in commonjsGlobal) {\n  if (ron.test(eventname)) {\n    eventmap.push(eventname.slice(2));\n  }\n}\n\nvar eventmap_1 = eventmap;\n\nvar doc = commonjsGlobal.document;\nvar addEvent = addEventEasy;\nvar removeEvent = removeEventEasy;\nvar hardCache = [];\n\nif (!commonjsGlobal.addEventListener) {\n  addEvent = addEventHard;\n  removeEvent = removeEventHard;\n}\n\nvar crossvent = {\n  add: addEvent,\n  remove: removeEvent,\n  fabricate: fabricateEvent\n};\n\nfunction addEventEasy (el, type, fn, capturing) {\n  return el.addEventListener(type, fn, capturing);\n}\n\nfunction addEventHard (el, type, fn) {\n  return el.attachEvent('on' + type, wrap(el, type, fn));\n}\n\nfunction removeEventEasy (el, type, fn, capturing) {\n  return el.removeEventListener(type, fn, capturing);\n}\n\nfunction removeEventHard (el, type, fn) {\n  var listener = unwrap(el, type, fn);\n  if (listener) {\n    return el.detachEvent('on' + type, listener);\n  }\n}\n\nfunction fabricateEvent (el, type, model) {\n  var e = eventmap_1.indexOf(type) === -1 ? makeCustomEvent() : makeClassicEvent();\n  if (el.dispatchEvent) {\n    el.dispatchEvent(e);\n  } else {\n    el.fireEvent('on' + type, e);\n  }\n  function makeClassicEvent () {\n    var e;\n    if (doc.createEvent) {\n      e = doc.createEvent('Event');\n      e.initEvent(type, true, true);\n    } else if (doc.createEventObject) {\n      e = doc.createEventObject();\n    }\n    return e;\n  }\n  function makeCustomEvent () {\n    return new customEvent(type, { detail: model });\n  }\n}\n\nfunction wrapperFactory (el, type, fn) {\n  return function wrapper (originalEvent) {\n    var e = originalEvent || commonjsGlobal.event;\n    e.target = e.target || e.srcElement;\n    e.preventDefault = e.preventDefault || function preventDefault () { e.returnValue = false; };\n    e.stopPropagation = e.stopPropagation || function stopPropagation () { e.cancelBubble = true; };\n    e.which = e.which || e.keyCode;\n    fn.call(el, e);\n  };\n}\n\nfunction wrap (el, type, fn) {\n  var wrapper = unwrap(el, type, fn) || wrapperFactory(el, type, fn);\n  hardCache.push({\n    wrapper: wrapper,\n    element: el,\n    type: type,\n    fn: fn\n  });\n  return wrapper;\n}\n\nfunction unwrap (el, type, fn) {\n  var i = find(el, type, fn);\n  if (i) {\n    var wrapper = hardCache[i].wrapper;\n    hardCache.splice(i, 1); // free up a tad of memory\n    return wrapper;\n  }\n}\n\nfunction find (el, type, fn) {\n  var i, item;\n  for (i = 0; i < hardCache.length; i++) {\n    item = hardCache[i];\n    if (item.element === el && item.type === type && item.fn === fn) {\n      return i;\n    }\n  }\n}\n\nvar cache = {};\nvar start = '(?:^|\\\\s)';\nvar end = '(?:\\\\s|$)';\n\nfunction lookupClass (className) {\n  var cached = cache[className];\n  if (cached) {\n    cached.lastIndex = 0;\n  } else {\n    cache[className] = cached = new RegExp(start + className + end, 'g');\n  }\n  return cached;\n}\n\nfunction addClass (el, className) {\n  var current = el.className;\n  if (!current.length) {\n    el.className = className;\n  } else if (!lookupClass(className).test(current)) {\n    el.className += ' ' + className;\n  }\n}\n\nfunction rmClass (el, className) {\n  el.className = el.className.replace(lookupClass(className), ' ').trim();\n}\n\nvar classes = {\n  add: addClass,\n  rm: rmClass\n};\n\nvar doc$1 = document;\nvar documentElement = doc$1.documentElement;\n\nfunction dragula (initialContainers, options) {\n  var len = arguments.length;\n  if (len === 1 && Array.isArray(initialContainers) === false) {\n    options = initialContainers;\n    initialContainers = [];\n  }\n  var _mirror; // mirror image\n  var _source; // source container\n  var _item; // item being dragged\n  var _offsetX; // reference x\n  var _offsetY; // reference y\n  var _moveX; // reference move x\n  var _moveY; // reference move y\n  var _initialSibling; // reference sibling when grabbed\n  var _currentSibling; // reference sibling now\n  var _copy; // item used for copying\n  var _renderTimer; // timer for setTimeout renderMirrorImage\n  var _lastDropTarget = null; // last container item was over\n  var _grabbed; // holds mousedown context until first mousemove\n\n  var o = options || {};\n  if (o.moves === void 0) { o.moves = always; }\n  if (o.accepts === void 0) { o.accepts = always; }\n  if (o.invalid === void 0) { o.invalid = invalidTarget; }\n  if (o.containers === void 0) { o.containers = initialContainers || []; }\n  if (o.isContainer === void 0) { o.isContainer = never; }\n  if (o.copy === void 0) { o.copy = false; }\n  if (o.copySortSource === void 0) { o.copySortSource = false; }\n  if (o.revertOnSpill === void 0) { o.revertOnSpill = false; }\n  if (o.removeOnSpill === void 0) { o.removeOnSpill = false; }\n  if (o.direction === void 0) { o.direction = 'vertical'; }\n  if (o.ignoreInputTextSelection === void 0) { o.ignoreInputTextSelection = true; }\n  if (o.mirrorContainer === void 0) { o.mirrorContainer = doc$1.body; }\n\n  var drake = emitter({\n    containers: o.containers,\n    start: manualStart,\n    end: end,\n    cancel: cancel,\n    remove: remove,\n    destroy: destroy,\n    canMove: canMove,\n    dragging: false\n  });\n\n  if (o.removeOnSpill === true) {\n    drake.on('over', spillOver).on('out', spillOut);\n  }\n\n  events();\n\n  return drake;\n\n  function isContainer (el) {\n    return drake.containers.indexOf(el) !== -1 || o.isContainer(el);\n  }\n\n  function events (remove) {\n    var op = remove ? 'remove' : 'add';\n    touchy(documentElement, op, 'mousedown', grab);\n    touchy(documentElement, op, 'mouseup', release);\n  }\n\n  function eventualMovements (remove) {\n    var op = remove ? 'remove' : 'add';\n    touchy(documentElement, op, 'mousemove', startBecauseMouseMoved);\n  }\n\n  function movements (remove) {\n    var op = remove ? 'remove' : 'add';\n    crossvent[op](documentElement, 'selectstart', preventGrabbed); // IE8\n    crossvent[op](documentElement, 'click', preventGrabbed);\n  }\n\n  function destroy () {\n    events(true);\n    release({});\n  }\n\n  function preventGrabbed (e) {\n    if (_grabbed) {\n      e.preventDefault();\n    }\n  }\n\n  function grab (e) {\n    _moveX = e.clientX;\n    _moveY = e.clientY;\n\n    var ignore = whichMouseButton(e) !== 1 || e.metaKey || e.ctrlKey;\n    if (ignore) {\n      return; // we only care about honest-to-god left clicks and touch events\n    }\n    var item = e.target;\n    var context = canStart(item);\n    if (!context) {\n      return;\n    }\n    _grabbed = context;\n    eventualMovements();\n    if (e.type === 'mousedown') {\n      if (isInput(item)) { // see also: https://github.com/bevacqua/dragula/issues/208\n        item.focus(); // fixes https://github.com/bevacqua/dragula/issues/176\n      } else {\n        e.preventDefault(); // fixes https://github.com/bevacqua/dragula/issues/155\n      }\n    }\n  }\n\n  function startBecauseMouseMoved (e) {\n    if (!_grabbed) {\n      return;\n    }\n    if (whichMouseButton(e) === 0) {\n      release({});\n      return; // when text is selected on an input and then dragged, mouseup doesn't fire. this is our only hope\n    }\n    // truthy check fixes #239, equality fixes #207\n    if (e.clientX !== void 0 && e.clientX === _moveX && e.clientY !== void 0 && e.clientY === _moveY) {\n      return;\n    }\n    if (o.ignoreInputTextSelection) {\n      var clientX = getCoord('clientX', e);\n      var clientY = getCoord('clientY', e);\n      var elementBehindCursor = doc$1.elementFromPoint(clientX, clientY);\n      if (isInput(elementBehindCursor)) {\n        return;\n      }\n    }\n\n    var grabbed = _grabbed; // call to end() unsets _grabbed\n    eventualMovements(true);\n    movements();\n    end();\n    start(grabbed);\n\n    var offset = getOffset(_item);\n    _offsetX = getCoord('pageX', e) - offset.left;\n    _offsetY = getCoord('pageY', e) - offset.top;\n\n    classes.add(_copy || _item, 'gu-transit');\n    renderMirrorImage();\n    drag(e);\n  }\n\n  function canStart (item) {\n    if (drake.dragging && _mirror) {\n      return;\n    }\n    if (isContainer(item)) {\n      return; // don't drag container itself\n    }\n    var handle = item;\n    while (getParent(item) && isContainer(getParent(item)) === false) {\n      if (o.invalid(item, handle)) {\n        return;\n      }\n      item = getParent(item); // drag target should be a top element\n      if (!item) {\n        return;\n      }\n    }\n    var source = getParent(item);\n    if (!source) {\n      return;\n    }\n    if (o.invalid(item, handle)) {\n      return;\n    }\n\n    var movable = o.moves(item, source, handle, nextEl(item));\n    if (!movable) {\n      return;\n    }\n\n    return {\n      item: item,\n      source: source\n    };\n  }\n\n  function canMove (item) {\n    return !!canStart(item);\n  }\n\n  function manualStart (item) {\n    var context = canStart(item);\n    if (context) {\n      start(context);\n    }\n  }\n\n  function start (context) {\n    if (isCopy(context.item, context.source)) {\n      _copy = context.item.cloneNode(true);\n      drake.emit('cloned', _copy, context.item, 'copy');\n    }\n\n    _source = context.source;\n    _item = context.item;\n    _initialSibling = _currentSibling = nextEl(context.item);\n\n    drake.dragging = true;\n    drake.emit('drag', _item, _source);\n  }\n\n  function invalidTarget () {\n    return false;\n  }\n\n  function end () {\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    drop(item, getParent(item));\n  }\n\n  function ungrab () {\n    _grabbed = false;\n    eventualMovements(true);\n    movements(true);\n  }\n\n  function release (e) {\n    ungrab();\n\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    var clientX = getCoord('clientX', e);\n    var clientY = getCoord('clientY', e);\n    var elementBehindCursor = getElementBehindPoint(_mirror, clientX, clientY);\n    var dropTarget = findDropTarget(elementBehindCursor, clientX, clientY);\n    if (dropTarget && ((_copy && o.copySortSource) || (!_copy || dropTarget !== _source))) {\n      drop(item, dropTarget);\n    } else if (o.removeOnSpill) {\n      remove();\n    } else {\n      cancel();\n    }\n  }\n\n  function drop (item, target) {\n    var parent = getParent(item);\n    if (_copy && o.copySortSource && target === _source) {\n      parent.removeChild(_item);\n    }\n    if (isInitialPlacement(target)) {\n      drake.emit('cancel', item, _source, _source);\n    } else {\n      drake.emit('drop', item, target, _source, _currentSibling);\n    }\n    cleanup();\n  }\n\n  function remove () {\n    if (!drake.dragging) {\n      return;\n    }\n    var item = _copy || _item;\n    var parent = getParent(item);\n    if (parent) {\n      parent.removeChild(item);\n    }\n    drake.emit(_copy ? 'cancel' : 'remove', item, parent, _source);\n    cleanup();\n  }\n\n  function cancel (revert) {\n    if (!drake.dragging) {\n      return;\n    }\n    var reverts = arguments.length > 0 ? revert : o.revertOnSpill;\n    var item = _copy || _item;\n    var parent = getParent(item);\n    var initial = isInitialPlacement(parent);\n    if (initial === false && reverts) {\n      if (_copy) {\n        if (parent) {\n          parent.removeChild(_copy);\n        }\n      } else {\n        _source.insertBefore(item, _initialSibling);\n      }\n    }\n    if (initial || reverts) {\n      drake.emit('cancel', item, _source, _source);\n    } else {\n      drake.emit('drop', item, parent, _source, _currentSibling);\n    }\n    cleanup();\n  }\n\n  function cleanup () {\n    var item = _copy || _item;\n    ungrab();\n    removeMirrorImage();\n    if (item) {\n      classes.rm(item, 'gu-transit');\n    }\n    if (_renderTimer) {\n      clearTimeout(_renderTimer);\n    }\n    drake.dragging = false;\n    if (_lastDropTarget) {\n      drake.emit('out', item, _lastDropTarget, _source);\n    }\n    drake.emit('dragend', item);\n    _source = _item = _copy = _initialSibling = _currentSibling = _renderTimer = _lastDropTarget = null;\n  }\n\n  function isInitialPlacement (target, s) {\n    var sibling;\n    if (s !== void 0) {\n      sibling = s;\n    } else if (_mirror) {\n      sibling = _currentSibling;\n    } else {\n      sibling = nextEl(_copy || _item);\n    }\n    return target === _source && sibling === _initialSibling;\n  }\n\n  function findDropTarget (elementBehindCursor, clientX, clientY) {\n    var target = elementBehindCursor;\n    while (target && !accepted()) {\n      target = getParent(target);\n    }\n    return target;\n\n    function accepted () {\n      var droppable = isContainer(target);\n      if (droppable === false) {\n        return false;\n      }\n\n      var immediate = getImmediateChild(target, elementBehindCursor);\n      var reference = getReference(target, immediate, clientX, clientY);\n      var initial = isInitialPlacement(target, reference);\n      if (initial) {\n        return true; // should always be able to drop it right back where it was\n      }\n      return o.accepts(_item, target, _source, reference);\n    }\n  }\n\n  function drag (e) {\n    if (!_mirror) {\n      return;\n    }\n    e.preventDefault();\n\n    var clientX = getCoord('clientX', e);\n    var clientY = getCoord('clientY', e);\n    var x = clientX - _offsetX;\n    var y = clientY - _offsetY;\n\n    _mirror.style.left = x + 'px';\n    _mirror.style.top = y + 'px';\n\n    var item = _copy || _item;\n    var elementBehindCursor = getElementBehindPoint(_mirror, clientX, clientY);\n    var dropTarget = findDropTarget(elementBehindCursor, clientX, clientY);\n    var changed = dropTarget !== null && dropTarget !== _lastDropTarget;\n    if (changed || dropTarget === null) {\n      out();\n      _lastDropTarget = dropTarget;\n      over();\n    }\n    var parent = getParent(item);\n    if (dropTarget === _source && _copy && !o.copySortSource) {\n      if (parent) {\n        parent.removeChild(item);\n      }\n      return;\n    }\n    var reference;\n    var immediate = getImmediateChild(dropTarget, elementBehindCursor);\n    if (immediate !== null) {\n      reference = getReference(dropTarget, immediate, clientX, clientY);\n    } else if (o.revertOnSpill === true && !_copy) {\n      reference = _initialSibling;\n      dropTarget = _source;\n    } else {\n      if (_copy && parent) {\n        parent.removeChild(item);\n      }\n      return;\n    }\n    if (\n      (reference === null && changed) ||\n      reference !== item &&\n      reference !== nextEl(item)\n    ) {\n      _currentSibling = reference;\n      dropTarget.insertBefore(item, reference);\n      drake.emit('shadow', item, dropTarget, _source);\n    }\n    function moved (type) { drake.emit(type, item, _lastDropTarget, _source); }\n    function over () { if (changed) { moved('over'); } }\n    function out () { if (_lastDropTarget) { moved('out'); } }\n  }\n\n  function spillOver (el) {\n    classes.rm(el, 'gu-hide');\n  }\n\n  function spillOut (el) {\n    if (drake.dragging) { classes.add(el, 'gu-hide'); }\n  }\n\n  function renderMirrorImage () {\n    if (_mirror) {\n      return;\n    }\n    var rect = _item.getBoundingClientRect();\n    _mirror = _item.cloneNode(true);\n    _mirror.style.width = getRectWidth(rect) + 'px';\n    _mirror.style.height = getRectHeight(rect) + 'px';\n    classes.rm(_mirror, 'gu-transit');\n    classes.add(_mirror, 'gu-mirror');\n    o.mirrorContainer.appendChild(_mirror);\n    touchy(documentElement, 'add', 'mousemove', drag);\n    classes.add(o.mirrorContainer, 'gu-unselectable');\n    drake.emit('cloned', _mirror, _item, 'mirror');\n  }\n\n  function removeMirrorImage () {\n    if (_mirror) {\n      classes.rm(o.mirrorContainer, 'gu-unselectable');\n      touchy(documentElement, 'remove', 'mousemove', drag);\n      getParent(_mirror).removeChild(_mirror);\n      _mirror = null;\n    }\n  }\n\n  function getImmediateChild (dropTarget, target) {\n    var immediate = target;\n    while (immediate !== dropTarget && getParent(immediate) !== dropTarget) {\n      immediate = getParent(immediate);\n    }\n    if (immediate === documentElement) {\n      return null;\n    }\n    return immediate;\n  }\n\n  function getReference (dropTarget, target, x, y) {\n    var horizontal = o.direction === 'horizontal';\n    var reference = target !== dropTarget ? inside() : outside();\n    return reference;\n\n    function outside () { // slower, but able to figure out any position\n      var len = dropTarget.children.length;\n      var i;\n      var el;\n      var rect;\n      for (i = 0; i < len; i++) {\n        el = dropTarget.children[i];\n        rect = el.getBoundingClientRect();\n        if (horizontal && (rect.left + rect.width / 2) > x) { return el; }\n        if (!horizontal && (rect.top + rect.height / 2) > y) { return el; }\n      }\n      return null;\n    }\n\n    function inside () { // faster, but only available if dropped inside a child element\n      var rect = target.getBoundingClientRect();\n      if (horizontal) {\n        return resolve(x > rect.left + getRectWidth(rect) / 2);\n      }\n      return resolve(y > rect.top + getRectHeight(rect) / 2);\n    }\n\n    function resolve (after) {\n      return after ? nextEl(target) : target;\n    }\n  }\n\n  function isCopy (item, container) {\n    return typeof o.copy === 'boolean' ? o.copy : o.copy(item, container);\n  }\n}\n\nfunction touchy (el, op, type, fn) {\n  var touch = {\n    mouseup: 'touchend',\n    mousedown: 'touchstart',\n    mousemove: 'touchmove'\n  };\n  var pointers = {\n    mouseup: 'pointerup',\n    mousedown: 'pointerdown',\n    mousemove: 'pointermove'\n  };\n  var microsoft = {\n    mouseup: 'MSPointerUp',\n    mousedown: 'MSPointerDown',\n    mousemove: 'MSPointerMove'\n  };\n  if (commonjsGlobal.navigator.pointerEnabled) {\n    crossvent[op](el, pointers[type], fn);\n  } else if (commonjsGlobal.navigator.msPointerEnabled) {\n    crossvent[op](el, microsoft[type], fn);\n  } else {\n    crossvent[op](el, touch[type], fn);\n    crossvent[op](el, type, fn);\n  }\n}\n\nfunction whichMouseButton (e) {\n  if (e.touches !== void 0) { return e.touches.length; }\n  if (e.which !== void 0 && e.which !== 0) { return e.which; } // see https://github.com/bevacqua/dragula/issues/261\n  if (e.buttons !== void 0) { return e.buttons; }\n  var button = e.button;\n  if (button !== void 0) { // see https://github.com/jquery/jquery/blob/99e8ff1baa7ae341e94bb89c3e84570c7c3ad9ea/src/event.js#L573-L575\n    return button & 1 ? 1 : button & 2 ? 3 : (button & 4 ? 2 : 0);\n  }\n}\n\nfunction getOffset (el) {\n  var rect = el.getBoundingClientRect();\n  return {\n    left: rect.left + getScroll('scrollLeft', 'pageXOffset'),\n    top: rect.top + getScroll('scrollTop', 'pageYOffset')\n  };\n}\n\nfunction getScroll (scrollProp, offsetProp) {\n  if (typeof commonjsGlobal[offsetProp] !== 'undefined') {\n    return commonjsGlobal[offsetProp];\n  }\n  if (documentElement.clientHeight) {\n    return documentElement[scrollProp];\n  }\n  return doc$1.body[scrollProp];\n}\n\nfunction getElementBehindPoint (point, x, y) {\n  var p = point || {};\n  var state = p.className;\n  var el;\n  p.className += ' gu-hide';\n  el = doc$1.elementFromPoint(x, y);\n  p.className = state;\n  return el;\n}\n\nfunction never () { return false; }\nfunction always () { return true; }\nfunction getRectWidth (rect) { return rect.width || (rect.right - rect.left); }\nfunction getRectHeight (rect) { return rect.height || (rect.bottom - rect.top); }\nfunction getParent (el) { return el.parentNode === doc$1 ? null : el.parentNode; }\nfunction isInput (el) { return el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.tagName === 'SELECT' || isEditable(el); }\nfunction isEditable (el) {\n  if (!el) { return false; } // no parents were editable\n  if (el.contentEditable === 'false') { return false; } // stop the lookup\n  if (el.contentEditable === 'true') { return true; } // found a contentEditable element in the chain\n  return isEditable(getParent(el)); // contentEditable is set to 'inherit'\n}\n\nfunction nextEl (el) {\n  return el.nextElementSibling || manually();\n  function manually () {\n    var sibling = el;\n    do {\n      sibling = sibling.nextSibling;\n    } while (sibling && sibling.nodeType !== 1);\n    return sibling;\n  }\n}\n\nfunction getEventHost (e) {\n  // on touchend event, we have to use `e.changedTouches`\n  // see http://stackoverflow.com/questions/7192563/touchend-event-properties\n  // see https://github.com/bevacqua/dragula/issues/34\n  if (e.targetTouches && e.targetTouches.length) {\n    return e.targetTouches[0];\n  }\n  if (e.changedTouches && e.changedTouches.length) {\n    return e.changedTouches[0];\n  }\n  return e;\n}\n\nfunction getCoord (coord, e) {\n  var host = getEventHost(e);\n  var missMap = {\n    pageX: 'clientX', // IE8\n    pageY: 'clientY' // IE8\n  };\n  if (coord in missMap && !(coord in host) && missMap[coord] in host) {\n    coord = missMap[coord];\n  }\n  return host[coord];\n}\n\nvar dragula_1 = dragula;\n\nvar joinHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Join Messages</h3>\\r\\n        <ul>\\r\\n            <li>These messages will be checked when a player joins the server.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar leaveHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Leave Messages</h3>\\r\\n        <ul>\\r\\n            <li>These messages will be checked when a player leaves the server.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar triggerHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Trigger</p>\\r\\n            </div>\\r\\n            <div class=\\\"column is-2-desktop\\\">\\r\\n                <input class=\\\"input is-small\\\" data-target=\\\"trigger\\\">\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-3\\\">\\r\\n                <details>\\r\\n                    <summary>More options</summary>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"all\\\">anyone</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <p class=\\\"has-text-weight-bold\\\">Player is not </p>\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <select data-target=\\\"not_group\\\" class=\\\"select is-small\\\">\\r\\n                                <option value=\\\"nobody\\\">nobody</option>\\r\\n                                <option value=\\\"staff\\\">a staff member</option>\\r\\n                                <option value=\\\"mod\\\">a mod</option>\\r\\n                                <option value=\\\"admin\\\">an admin</option>\\r\\n                                <option value=\\\"owner\\\">the owner</option>\\r\\n                            </select>\\r\\n                        </div>\\r\\n                    </div>\\r\\n                    <div class=\\\"level-options\\\">\\r\\n                        <div class=\\\"control\\\">\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"0\\\" data-target=\\\"joins_low\\\" min=\\\"0\\\">\\r\\n                            <span class=\\\"has-text-weight-bold\\\"> &le; player joins &le; </span>\\r\\n                            <input type=\\\"number\\\" class=\\\"input is-small\\\" value=\\\"9999\\\" data-target=\\\"joins_high\\\">\\r\\n                        </div>\\r\\n                    </div>\\r\\n                </details>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\" title=\\\"Add trigger message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Triggers</h3>\\r\\n        <ul>\\r\\n            <li>The trigger will be checked against chat messages, if it matches, the message will be sent.</li>\\r\\n            <li>Triggers are case-insensitive.</li>\\r\\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user's name.</li>\\r\\n            <li><code>*</code> will be treated as a wildcard.</li>\\r\\n            <li>Triggers are matched in order, if more than the max number are matched, later triggers will not be sent.</li>\\r\\n            <li>Change the maximum number of responses under settings.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nvar annHtml = \"<template>\\r\\n    <div class=\\\"box\\\">\\r\\n        <div class=\\\"columns\\\">\\r\\n            <div class=\\\"column is-narrow is-hidden-touch\\\">\\r\\n                <span class=\\\"drag\\\"></span>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <p class=\\\"has-text-weight-bold\\\">Message</p>\\r\\n            </div>\\r\\n            <div class=\\\"column\\\">\\r\\n                <textarea class=\\\"textarea is-small is-fluid\\\" data-target=\\\"message\\\"></textarea>\\r\\n            </div>\\r\\n            <div class=\\\"column is-narrow\\\">\\r\\n                <button class=\\\"button is-small is-danger is-outlined\\\" data-do=\\\"delete\\\">Delete</button>\\r\\n            </div>\\r\\n        </div>\\r\\n        <div>\\r\\n            Wait X minutes...\\r\\n        </div>\\r\\n    </div>\\r\\n</template>\\r\\n\\r\\n<div class=\\\"container is-widescreen\\\">\\r\\n    <section class=\\\"section is-small\\\">\\r\\n        <span class=\\\"button is-primary is-adding-message\\\">+</span>\\r\\n        <h3 class=\\\"title is-4\\\">Announcements</h3>\\r\\n        <ul>\\r\\n            <li>These are sent according to a regular schedule.</li>\\r\\n            <li>If you have one announcement, it is sent every X minutes, if you have two, then the first is sent at X minutes, and the second\\r\\n            is sent X minutes after the first. Change X in the settings tab. Once the bot reaches the end of the list, it starts over\\r\\n            at the top.</li>\\r\\n            <li>If no players are online when a message is scheduled to be sent, no message will be sent and the next message will reset to the first message.</li>\\r\\n        </ul>\\r\\n    </section>\\r\\n    <div class=\\\"messages-container\\\"></div>\\r\\n</div>\\r\\n\";\n\nfunction getElementWithClass(className, element) {\r\n    if (!element)\r\n        return;\r\n    return element.classList.contains(className) ? element : getElementWithClass(className, element.parentElement);\r\n}\r\nclass MessagesTab extends RemovableMessageHelper {\r\n    constructor({ name, ex, id }) {\r\n        super(id, ex);\r\n        this.setup = () => __awaiter(this, void 0, void 0, function* () {\r\n            this.insertHTML();\r\n            this.template = this.tab.querySelector('template');\r\n            this.root = this.tab.querySelector('.messages-container');\r\n            // Auto save messages\r\n            this.tab.addEventListener('input', () => this.save());\r\n            // Create a new message\r\n            let button = this.tab.querySelector('.button.is-primary');\r\n            button.addEventListener('click', () => this.addMessage());\r\n            // Deleting messages\r\n            this.tab.addEventListener('click', event => {\r\n                const target = event.target;\r\n                if (target.matches('[data-do=delete]')) {\r\n                    event.preventDefault();\r\n                    // Todo: Undo\r\n                    const row = getElementWithClass('box', target);\r\n                    if (!row)\r\n                        return;\r\n                    row.remove();\r\n                }\r\n                this.save();\r\n            });\r\n            // Moving up / down\r\n            const dragger = dragula_1([this.root], {\r\n                moves(_el, _container, handle) {\r\n                    return handle.classList.contains('drag');\r\n                }\r\n            });\r\n            dragger.on('drop', () => this.save());\r\n            dragger.on('drag', (el) => {\r\n                const details = el.querySelector('details');\r\n                if (details)\r\n                    details.open = false;\r\n            });\r\n            this.ex.storage.get(this.id, []).forEach(message => {\r\n                this.addMessage(message);\r\n            });\r\n        });\r\n        this.getMessages = () => {\r\n            let messages = [];\r\n            this.root.querySelectorAll('.box').forEach(element => {\r\n                let data = {};\r\n                element.querySelectorAll('[data-target]').forEach((input) => {\r\n                    let name = input.dataset['target'];\r\n                    if (!name)\r\n                        return;\r\n                    switch (input.getAttribute('type')) {\r\n                        case 'number':\r\n                            data[name] = +input.value;\r\n                            break;\r\n                        default:\r\n                            data[name] = input.value;\r\n                    }\r\n                });\r\n                messages.push(data);\r\n            });\r\n            return messages;\r\n        };\r\n        this.ui = ex.bot.getExports('ui');\r\n        this.ex = ex;\r\n        this.tab = this.ui.addTab(name, 'messages');\r\n    }\r\n    remove() {\r\n        this.ui.removeTab(this.tab);\r\n    }\r\n    save() {\r\n        this.ex.storage.set(this.id, this.getMessages());\r\n    }\r\n}\r\nclass JoinTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Join', id: 'joinArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = joinHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-for=message-trim]', text: msg.message || '' },\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' },\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass LeaveTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Leave', id: 'leaveArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = leaveHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-for=message-trim]', text: msg.message || '' },\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' }\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass TriggerTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Trigger', id: 'triggerArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = triggerHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n                { selector: '[data-target=trigger]', value: msg.trigger || '' },\r\n                { selector: '[data-target=joins_low]', value: msg.joins_low || 0 },\r\n                { selector: '[data-target=joins_high]', value: msg.joins_high || 9999 },\r\n                { selector: '[data-target=group]', value: msg.group || 'all' },\r\n                { selector: '[data-target=not_group]', value: msg.not_group || 'nobody' }\r\n            ]);\r\n        };\r\n    }\r\n}\r\nclass AnnouncementTab extends MessagesTab {\r\n    constructor(ex) {\r\n        super({ name: 'Announcements', id: 'announcementArr', ex });\r\n        this.insertHTML = () => {\r\n            this.tab.innerHTML = annHtml;\r\n        };\r\n        this.addMessage = (msg = {}) => {\r\n            this.ui.buildTemplate(this.template, this.root, [\r\n                { selector: '[data-target=message]', text: msg.message || '' },\r\n            ]);\r\n        };\r\n    }\r\n}\n\nvar css = \".messages-container input[type=number] {\\r\\n    width: 5em;\\r\\n    font-size: 0.6rem;\\r\\n}\\r\\n\\r\\n.messages-container {\\r\\n    border-top: 1px solid #cccccc;\\r\\n    padding-top: 1em;\\r\\n}\\r\\n\\r\\n.messages-container .box {\\r\\n    padding: 0.7em;\\r\\n    padding-bottom: 0;\\r\\n    margin-bottom: 1em;\\r\\n}\\r\\n\\r\\n.messages-container .columns {\\r\\n    margin-bottom: 0;\\r\\n}\\r\\n\\r\\n.messages-container .drag::after {\\r\\n    content: \\\" \\\\2261\\\";\\r\\n}\\r\\n\\r\\n.messages-container .level-options {\\r\\n    display: flex;\\r\\n    flex-direction: row;\\r\\n    align-items: center;\\r\\n}\\r\\n@media screen and (max-width: 768px) {\\r\\n    .messages-container .level-options {\\r\\n        flex-wrap: wrap;\\r\\n    }\\r\\n}\\r\\n\\r\\n.messages-container summary {\\r\\n    outline: none;\\r\\n}\\r\\n\\r\\n.is-adding-message {\\r\\n    position: fixed;\\r\\n    left: 1em;\\r\\n    z-index: 10;\\r\\n}\\r\\n\\r\\n.messages-container p {\\r\\n    margin-right: 0.5em;\\r\\n}\\r\\n\\r\\n/** Copied from https://github.com/bevacqua/dragula/blob/b0e5c4/dist/dragula.css **/\\r\\n.gu-mirror {\\r\\n    position: fixed !important;\\r\\n    margin: 0 !important;\\r\\n    z-index: 9999 !important;\\r\\n    opacity: 0.8;\\r\\n    -ms-filter: \\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=80)\\\";\\r\\n    filter: alpha(opacity=80);\\r\\n}\\r\\n.gu-hide {\\r\\n    display: none !important;\\r\\n}\\r\\n.gu-unselectable {\\r\\n    -webkit-user-select: none !important;\\r\\n    -moz-user-select: none !important;\\r\\n    -ms-user-select: none !important;\\r\\n    user-select: none !important;\\r\\n}\\r\\n.gu-transit {\\r\\n    opacity: 0.2;\\r\\n    -ms-filter: \\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=20)\\\";\\r\\n    filter: alpha(opacity=20);\\r\\n}\\r\\n\";\n\nMessageBot.registerExtension('messages', function (ex, world) {\r\n    let listeners = [];\r\n    ex.remove = () => listeners.forEach(l => l.remove());\r\n    let hasLoaded = false;\r\n    let delayLoad = () => {\r\n        if (hasLoaded)\r\n            return;\r\n        hasLoaded = true;\r\n        let timeout = setTimeout(() => {\r\n            listeners = [\r\n                new JoinListener(ex),\r\n                new LeaveListener(ex),\r\n                new TriggerListener(ex),\r\n                new AnnouncementListener(ex),\r\n            ];\r\n        }, 500);\r\n        listeners = [{\r\n                remove: () => clearTimeout(timeout)\r\n            }];\r\n    };\r\n    world.onJoin.one(delayLoad);\r\n    world.onLeave.one(delayLoad);\r\n    world.onMessage.one(delayLoad);\r\n    // Loaded in a browser?\r\n    if (ex.bot.getExports('ui')) {\r\n        let style = document.head.appendChild(document.createElement('style'));\r\n        style.innerHTML = css;\r\n        let ui = ex.bot.getExports('ui');\r\n        ui.addTabGroup('Messages', 'messages');\r\n        let tabs = [\r\n            new JoinTab(ex),\r\n            new LeaveTab(ex),\r\n            new TriggerTab(ex),\r\n            new AnnouncementTab(ex),\r\n        ];\r\n        tabs.forEach(tab => tab.setup());\r\n        listeners = listeners.concat(...tabs, { remove: () => style.remove() }, { remove: () => ui.removeTabGroup('messages') });\r\n    }\r\n});\n","import { MessageBot } from '@bhmb/bot';\n\nvar page = \"<header class=\\\"header is-fixed-top\\\">\\n    <nav class=\\\"navbar is-primary\\\" role=\\\"navigation\\\" aria-label=\\\"main navigation\\\">\\n        <div class=\\\"navbar-brand\\\">\\n            <div class=\\\"navbar-item nav-slider-toggle\\\">\\n                <img src=\\\"https://blockheads-messagebot.github.io/UI/logo.png\\\">\\n            </div>\\n            <a class=\\\"navbar-item nav-slider-toggle\\\">Menu</a>\\n        </div>\\n    </nav>\\n</header>\\n\\n<div class=\\\"nav-slider-container\\\">\\n    <nav class=\\\"nav-slider\\\"></nav>\\n    <div class=\\\"is-overlay nav-slider-toggle\\\"></div>\\n</div>\\n\\n<div id=\\\"container\\\" class=\\\"has-fixed-nav\\\"></div>\\n\\n\\n<div id=\\\"modal\\\" class=\\\"modal\\\">\\n    <div class=\\\"modal-background\\\"></div>\\n    <div class=\\\"modal-card\\\">\\n        <header class=\\\"modal-card-head\\\"></header>\\n        <section class=\\\"modal-card-body\\\"></section>\\n        <footer class=\\\"modal-card-foot\\\"></footer>\\n    </div>\\n</div>\\n\";\n\nfunction api () {\r\n    const menuSlider = document.querySelector('.nav-slider-container .nav-slider');\r\n    const toggleMenu = () => menuSlider.classList.toggle('is-active');\r\n    for (let el of document.querySelectorAll('.nav-slider-toggle')) {\r\n        el.addEventListener('click', toggleMenu);\r\n    }\r\n    const tabs = new Map();\r\n    const groups = new Map();\r\n    const container = document.getElementById('container');\r\n    const menuContainer = document.querySelector('.nav-slider');\r\n    menuContainer.addEventListener('click', event => {\r\n        let nav = event.target;\r\n        let tab = tabs.get(nav);\r\n        if (tab) {\r\n            // Containers\r\n            Array.from(container.children).forEach(child => child.classList.remove('visible'));\r\n            tab.classList.add('visible');\r\n            // Nav items\r\n            Array.from(menuContainer.querySelectorAll('span.nav-item')).forEach(span => span.classList.remove('is-active'));\r\n            nav.classList.add('is-active');\r\n        }\r\n    });\r\n    const addTab = (text, groupName) => {\r\n        let div = container.appendChild(document.createElement('div'));\r\n        let parent = menuContainer;\r\n        if (groupName)\r\n            parent = groups.get(groupName);\r\n        let nav = parent.appendChild(document.createElement('span'));\r\n        nav.textContent = text;\r\n        nav.classList.add('nav-item');\r\n        tabs.set(nav, div);\r\n        return div;\r\n    };\r\n    const removeTab = (content) => {\r\n        for (let [nav, div] of tabs.entries()) {\r\n            if (div == content) {\r\n                div.remove();\r\n                nav.remove();\r\n                tabs.delete(nav);\r\n                return;\r\n            }\r\n        }\r\n    };\r\n    const addTabGroup = (text, groupName, parent) => {\r\n        let details = groups.get(groupName);\r\n        if (details) {\r\n            details.children[0].textContent = text;\r\n            return;\r\n        }\r\n        let parentElement = menuContainer;\r\n        if (parent)\r\n            parentElement = groups.get(parent);\r\n        details = parentElement.appendChild(document.createElement('details'));\r\n        details.classList.add('nav-item');\r\n        let summary = details.appendChild(document.createElement('summary'));\r\n        summary.textContent = text;\r\n        groups.set(groupName, details);\r\n    };\r\n    const removeTabGroup = (groupName) => {\r\n        let group = groups.get(groupName);\r\n        if (!group)\r\n            return;\r\n        for (let child of group.querySelectorAll('span')) {\r\n            // Unless someone has been purposely messing with the page, this is a safe assertion\r\n            removeTab(tabs.get(child));\r\n        }\r\n        groups.delete(groupName);\r\n        group.remove();\r\n    };\r\n    const handleRule = (rule, element) => {\r\n        if (typeof rule.text == 'string') {\r\n            element.textContent = rule.text;\r\n        }\r\n        else if (typeof rule.html == 'string') {\r\n            element.innerHTML = rule.html;\r\n        }\r\n        let blacklist = ['text', 'html', 'selector'];\r\n        if (element instanceof HTMLTextAreaElement && 'value' in rule) {\r\n            element.textContent = rule.value;\r\n            blacklist.push('value');\r\n        }\r\n        //See https://github.com/Blockheads-Messagebot/MessageBot/issues/52\r\n        if (element instanceof HTMLSelectElement && 'value' in rule) {\r\n            let child = element.querySelector(`[value=\"${rule.value}\"]`);\r\n            if (child)\r\n                child.selected = true;\r\n        }\r\n        Object.keys(rule)\r\n            .filter(key => !blacklist.includes(key))\r\n            .forEach(key => {\r\n            if (key in element) {\r\n                element[key] = rule[key];\r\n            }\r\n            else {\r\n                element.setAttribute(key, rule[key]);\r\n            }\r\n        });\r\n    };\r\n    const buildTemplate = (template, target, rules) => {\r\n        if (typeof template == 'string')\r\n            template = document.querySelector(template);\r\n        if (typeof target == 'string')\r\n            target = document.querySelector(target);\r\n        let parent = document.importNode(template.content, true);\r\n        for (let rule of rules) {\r\n            let element = parent.querySelector(rule.selector);\r\n            if (!element) {\r\n                console.warn(`Could not find ${rule.selector}`, rule);\r\n                continue;\r\n            }\r\n            handleRule(rule, element);\r\n        }\r\n        target.appendChild(parent);\r\n    };\r\n    const notify = (text, displayTime = 3) => {\r\n        let el = document.body.appendChild(document.createElement('div'));\r\n        el.classList.add('bot-notification', 'is-active');\r\n        el.textContent = text;\r\n        let timeouts = [\r\n            setTimeout(() => el.classList.remove('is-active'), displayTime * 1000),\r\n            setTimeout(() => el.remove(), (displayTime + 1) * 1000)\r\n        ];\r\n        el.addEventListener('click', () => {\r\n            timeouts.forEach(clearTimeout);\r\n            el.remove();\r\n        });\r\n    };\r\n    let alertInstance = {\r\n        active: false,\r\n        queue: []\r\n    };\r\n    const modal = document.getElementById('modal');\r\n    const modalBody = modal.querySelector('.modal-card-body');\r\n    const modalFooter = modal.querySelector('.modal-card-foot');\r\n    const addButton = (button) => {\r\n        let el = modalFooter.appendChild(document.createElement('a'));\r\n        let styles = ['button'];\r\n        if (typeof button == 'object') {\r\n            if (button.style)\r\n                styles.push(button.style);\r\n            el.textContent = button.text;\r\n        }\r\n        else {\r\n            el.textContent = button;\r\n        }\r\n        el.classList.add(...styles);\r\n    };\r\n    const showAlert = () => {\r\n        alertInstance.active = true;\r\n        const { html, buttons, callback } = alertInstance.queue.shift();\r\n        modalBody.innerHTML = html;\r\n        Array.isArray(buttons) ? buttons.forEach(addButton) : addButton('OK');\r\n        modal.classList.add('is-active');\r\n        modalFooter.addEventListener('click', function buttonHandler(event) {\r\n            let target = event.target;\r\n            if (target.tagName != 'A')\r\n                return;\r\n            modal.classList.remove('is-active');\r\n            try {\r\n                if (callback)\r\n                    callback.call(null, target.textContent);\r\n            }\r\n            catch (err) {\r\n                console.error('Error calling alert callback', err);\r\n            }\r\n            modalFooter.innerHTML = '';\r\n            modalFooter.removeEventListener('click', buttonHandler);\r\n            alertInstance.active = false;\r\n            if (alertInstance.queue.length)\r\n                showAlert();\r\n        });\r\n    };\r\n    const alert = (html, buttons, callback) => {\r\n        alertInstance.queue.push({ html, buttons, callback });\r\n        if (!alertInstance.active)\r\n            showAlert();\r\n    };\r\n    const prompt = (text, callback) => {\r\n        let p = document.createElement('p');\r\n        p.textContent = text;\r\n        alert(p.outerHTML + `<textarea class=\"textarea\"></textarea>`, ['OK', 'Cancel'], () => {\r\n            let el = modalBody.querySelector('textarea');\r\n            if (callback)\r\n                callback(el.value || '');\r\n        });\r\n    };\r\n    return {\r\n        toggleMenu,\r\n        addTab,\r\n        removeTab,\r\n        addTabGroup,\r\n        removeTabGroup,\r\n        buildTemplate,\r\n        notify,\r\n        alert,\r\n        prompt\r\n    };\r\n}\n\nfunction polyfill() {\r\n    if (!('open' in document.createElement('details'))) {\r\n        let style = document.createElement('style');\r\n        style.textContent += `details:not([open]) > :not(summary) { display: none !important } details > summary:before { content: \"▶\" display: inline-block font-size: .8em width: 1.5em font-family:\"Courier New\" } details[open] > summary:before { transform: rotate(90deg) }`;\r\n        document.head.appendChild(style);\r\n        window.addEventListener('click', function (event) {\r\n            let target = event.target;\r\n            if (target.tagName == 'SUMMARY') {\r\n                let details = target.parentNode;\r\n                if (!details) {\r\n                    return;\r\n                }\r\n                if (details.getAttribute('open')) {\r\n                    details.open = false;\r\n                    details.removeAttribute('open');\r\n                }\r\n                else {\r\n                    details.open = true;\r\n                    details.setAttribute('open', 'open');\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\n\nMessageBot.registerExtension('ui', function (ex) {\r\n    if (typeof document == 'undefined') {\r\n        throw new Error('This extension cannot be loaded outside of a browser environment.');\r\n    }\r\n    ex.uninstall = function () {\r\n        throw new Error('The UI extension cannot be removed once loaded');\r\n    };\r\n    // Page creation\r\n    document.body.innerHTML = page;\r\n    document.head.querySelectorAll('link').forEach(el => el.remove());\r\n    let style = document.head.appendChild(document.createElement('link'));\r\n    style.rel = 'stylesheet';\r\n    style.href = 'https://blockheads-messagebot.github.io/UI/index.css';\r\n    polyfill();\r\n    // Expose api\r\n    ex.exports = api();\r\n});\n","import { MessageBot } from '@bhmb/bot';\n\nfunction history(input) {\r\n    let history = [];\r\n    let current = 0;\r\n    function addToHistory(message) {\r\n        history.push(message);\r\n        while (history.length > 100) {\r\n            history.shift();\r\n        }\r\n        current = history.length;\r\n    }\r\n    function addIfNew(message) {\r\n        if (message != history.slice(-1).pop()) {\r\n            addToHistory(message);\r\n        }\r\n        else {\r\n            current = history.length;\r\n        }\r\n    }\r\n    input.addEventListener('keydown', event => {\r\n        if (event.key == 'ArrowUp') {\r\n            if (input.value.length && current == history.length) {\r\n                addToHistory(input.value);\r\n                current--;\r\n            }\r\n            if (history.length && current) {\r\n                input.value = history[--current];\r\n            }\r\n        }\r\n        else if (event.key == 'ArrowDown') {\r\n            if (history.length > current + 1) {\r\n                input.value = history[++current];\r\n            }\r\n            else if (history.length == current + 1) {\r\n                input.value = '';\r\n                current = history.length;\r\n            }\r\n        }\r\n        else if (event.key == 'Enter') {\r\n            addIfNew(input.value);\r\n        }\r\n    });\r\n}\n\nvar html = \"<template>\\r\\n    <li>\\r\\n        <span>NAME</span>\\r\\n        <span>: Message</span>\\r\\n    </li>\\r\\n</template>\\r\\n<div id=\\\"console\\\">\\r\\n    <div class=\\\"chat\\\">\\r\\n        <ul></ul>\\r\\n    </div>\\r\\n    <div class=\\\"chat-control\\\">\\r\\n        <div class=\\\"field has-addons\\\">\\r\\n            <p class=\\\"control is-expanded\\\">\\r\\n                <input type=\\\"text\\\" class=\\\"input\\\" />\\r\\n            </p>\\r\\n            <p class=\\\"control\\\">\\r\\n                <button class=\\\"input button is-primary\\\">SEND</button>\\r\\n            </p>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\";\n\nvar css = \"#console .mod > span:first-child {\\r\\n    color: #05f529;\\r\\n}\\r\\n\\r\\n#console .admin > span:first-child {\\r\\n    color: #2b26bd;\\r\\n}\\r\\n\\r\\n#console .chat {\\r\\n    margin: 0 1em;\\r\\n    height: calc(100vh - 52px - 4.25em);\\r\\n    overflow-y: auto;\\r\\n}\\r\\n\\r\\n#console .chat-control {\\r\\n    position: fixed;\\r\\n    bottom: 0;\\r\\n    width: 100vw;\\r\\n    background: #fff;\\r\\n}\\r\\n\\r\\n#console .field {\\r\\n    margin: 1em;\\r\\n}\\r\\n\";\n\nMessageBot.registerExtension('console', function (ex, world) {\r\n    if (!ex.bot.getExports('ui')) {\r\n        throw new Error('This extension should only be loaded in a browser, and must be loaded after the UI is loaded.');\r\n    }\r\n    const ui = ex.bot.getExports('ui');\r\n    // Create the tab.\r\n    let style = document.head.appendChild(document.createElement('style'));\r\n    style.textContent = css;\r\n    let tab = ui.addTab('Console');\r\n    tab.innerHTML = html;\r\n    let chatUl = tab.querySelector('ul');\r\n    let chatContainer = chatUl.parentElement;\r\n    let template = tab.querySelector('template');\r\n    // Handle sending\r\n    let input = tab.querySelector('input');\r\n    function userSend() {\r\n        ex.bot.send(input.value);\r\n        input.value = '';\r\n    }\r\n    input.addEventListener('keyup', event => {\r\n        if (event.key == 'Enter') {\r\n            userSend();\r\n        }\r\n    });\r\n    // History module, used to be a separate extension\r\n    history(input);\r\n    tab.querySelector('button').addEventListener('click', userSend);\r\n    // Auto scroll when new chat is added to the page, unless we are scrolled up.\r\n    new MutationObserver(function (events) {\r\n        let total = chatUl.children.length;\r\n        // Determine how many messages have been added\r\n        let addedHeight = 0;\r\n        for (let i = total - events.length; i < total; i++) {\r\n            addedHeight += chatUl.children[i].clientHeight;\r\n        }\r\n        // If we were scrolled down already, stay scrolled down\r\n        if (chatContainer.scrollHeight - chatContainer.clientHeight - chatContainer.scrollTop == addedHeight) {\r\n            chatContainer.scrollTop = chatContainer.scrollHeight;\r\n        }\r\n        // Remove old messages if necessary\r\n        while (chatUl.children.length > 500) {\r\n            chatUl.children[0].remove();\r\n        }\r\n    }).observe(chatUl, { childList: true, subtree: true });\r\n    // Add a message to the page\r\n    function addPlayerMessage(player, message) {\r\n        if (!message.length)\r\n            return;\r\n        let messageClass = 'player';\r\n        if (player.isAdmin)\r\n            messageClass = 'admin';\r\n        if (player.isMod)\r\n            messageClass = 'mod';\r\n        ui.buildTemplate(template, chatUl, [\r\n            { selector: 'li', 'class': messageClass },\r\n            { selector: 'span:first-child', text: player.name },\r\n            { selector: 'span:last-child', text: ': ' + message }\r\n        ]);\r\n    }\r\n    function addGenericMessage(message) {\r\n        if (!message.length)\r\n            return;\r\n        let li = document.createElement('li');\r\n        li.textContent = message;\r\n        chatUl.appendChild(li);\r\n    }\r\n    // Export required functions\r\n    let consoleExports = {\r\n        log: (message) => addPlayerMessage(world.getPlayer('SERVER'), message)\r\n    };\r\n    ex.exports = consoleExports;\r\n    function logJoins(player) {\r\n        if (ex.storage.get('logJoinIps', true)) {\r\n            consoleExports.log(`${player.name} (${player.ip}) joined.`);\r\n        }\r\n        else {\r\n            consoleExports.log(`${player.name} joined.`);\r\n        }\r\n    }\r\n    world.onJoin.sub(logJoins);\r\n    function logLeaves(player) {\r\n        consoleExports.log(player.name + ' left');\r\n    }\r\n    world.onLeave.sub(logLeaves);\r\n    function logMessages({ player, message }) {\r\n        addPlayerMessage(player, message);\r\n    }\r\n    world.onMessage.sub(logMessages);\r\n    function logOther(message) {\r\n        if (ex.storage.get('logUnparsedMessages', true)) {\r\n            addGenericMessage(message);\r\n        }\r\n    }\r\n    world.onOther.sub(logOther);\r\n    ex.remove = function () {\r\n        ui.removeTab(tab);\r\n        style.remove();\r\n        world.onJoin.unsub(logJoins);\r\n        world.onLeave.unsub(logLeaves);\r\n        world.onMessage.unsub(logMessages);\r\n        world.onOther.unsub(logOther);\r\n    };\r\n});\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* FileSaver.js\r\n * A saveAs() FileSaver implementation.\r\n *\r\n * By Eli Grey, http://eligrey.com\r\n * ES6ified by Cole Chamberlain, https://github.com/cchamberlain\r\n *\r\n * License: MIT\r\n *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md\r\n */\n\n/*global self */\n/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */\n\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */\n\nvar saveAs = exports.saveAs = window.saveAs || function (view) {\n  // IE <10 is explicitly unsupported\n  if (typeof navigator !== 'undefined' && /MSIE [1-9]\\./.test(navigator.userAgent)) return;\n  var doc = view.document;\n  // only get URL when necessary in case Blob.js hasn't overridden it yet\n  var get_URL = function get_URL() {\n    return view.URL || view.webkitURL || view;\n  };\n  var save_link = doc.createElementNS('http://www.w3.org/1999/xhtml', 'a');\n  var can_use_save_link = 'download' in save_link;\n  var click = function click(node) {\n    var event = new MouseEvent('click');\n    node.dispatchEvent(event);\n  };\n  var is_safari = /Version\\/[\\d\\.]+.*Safari/.test(navigator.userAgent);\n  var webkit_req_fs = view.webkitRequestFileSystem;\n  var req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem;\n  var throw_outside = function throw_outside(ex) {\n    (view.setImmediate || view.setTimeout)(function () {\n      throw ex;\n    }, 0);\n  };\n  var force_saveable_type = 'application/octet-stream';\n  var fs_min_size = 0;\n  // the Blob API is fundamentally broken as there is no \"downloadfinished\" event to subscribe to\n  var arbitrary_revoke_timeout = 1000 * 40; // in ms\n  var revoke = function revoke(file) {\n    var revoker = function revoker() {\n      if (typeof file === 'string') // file is an object URL\n        get_URL().revokeObjectURL(file);else // file is a File\n        file.remove();\n    };\n    /* // Take note W3C:\r\n    var\r\n      uri = typeof file === \"string\" ? file : file.toURL()\r\n    , revoker = function(evt) {\r\n      // idealy DownloadFinishedEvent.data would be the URL requested\r\n      if (evt.data === uri) {\r\n        if (typeof file === \"string\") { // file is an object URL\r\n          get_URL().revokeObjectURL(file);\r\n        } else { // file is a File\r\n          file.remove();\r\n        }\r\n      }\r\n    }\r\n    ;\r\n    view.addEventListener(\"downloadfinished\", revoker);\r\n    */\n    setTimeout(revoker, arbitrary_revoke_timeout);\n  };\n  var dispatch = function dispatch(filesaver, event_types, event) {\n    event_types = [].concat(event_types);\n    var i = event_types.length;\n    while (i--) {\n      var listener = filesaver['on' + event_types[i]];\n      if (typeof listener === 'function') {\n        try {\n          listener.call(filesaver, event || filesaver);\n        } catch (ex) {\n          throw_outside(ex);\n        }\n      }\n    }\n  };\n  var auto_bom = function auto_bom(blob) {\n    // prepend BOM for UTF-8 XML and text/* types (including HTML)\n    if (/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) return new Blob(['﻿', blob], { type: blob.type });\n    return blob;\n  };\n\n  var FileSaver = function FileSaver(blob, name, no_auto_bom) {\n    _classCallCheck(this, FileSaver);\n\n    if (!no_auto_bom) blob = auto_bom(blob);\n    // First try a.download, then web filesystem, then object URLs\n    var filesaver = this,\n        type = blob.type,\n        blob_changed = false,\n        object_url,\n        target_view,\n        dispatch_all = function dispatch_all() {\n      dispatch(filesaver, 'writestart progress write writeend'.split(' '));\n    }\n    // on any filesys errors revert to saving with object URLs\n    ,\n        fs_error = function fs_error() {\n      if (target_view && is_safari && typeof FileReader !== 'undefined') {\n        // Safari doesn't allow downloading of blob urls\n        var reader = new FileReader();\n        reader.onloadend = function () {\n          var base64Data = reader.result;\n          target_view.location.href = 'data:attachment/file' + base64Data.slice(base64Data.search(/[,;]/));\n          filesaver.readyState = filesaver.DONE;\n          dispatch_all();\n        };\n        reader.readAsDataURL(blob);\n        filesaver.readyState = filesaver.INIT;\n        return;\n      }\n      // don't create more object URLs than needed\n      if (blob_changed || !object_url) {\n        object_url = get_URL().createObjectURL(blob);\n      }\n      if (target_view) {\n        target_view.location.href = object_url;\n      } else {\n        var new_tab = view.open(object_url, '_blank');\n        if (new_tab === undefined && is_safari) {\n          //Apple do not allow window.open, see http://bit.ly/1kZffRI\n          view.location.href = object_url;\n        }\n      }\n      filesaver.readyState = filesaver.DONE;\n      dispatch_all();\n      revoke(object_url);\n    },\n        abortable = function abortable(func) {\n      return function () {\n        if (filesaver.readyState !== filesaver.DONE) {\n          return func.apply(this, arguments);\n        }\n      };\n    },\n        create_if_not_found = { create: true, exclusive: false },\n        slice;\n\n    filesaver.readyState = filesaver.INIT;\n    if (!name) {\n      name = 'download';\n    }\n    if (can_use_save_link) {\n      object_url = get_URL().createObjectURL(blob);\n      setTimeout(function () {\n        save_link.href = object_url;\n        save_link.download = name;\n        click(save_link);\n        dispatch_all();\n        revoke(object_url);\n        filesaver.readyState = filesaver.DONE;\n      });\n      return;\n    }\n    // Object and web filesystem URLs have a problem saving in Google Chrome when\n    // viewed in a tab, so I force save with application/octet-stream\n    // http://code.google.com/p/chromium/issues/detail?id=91158\n    // Update: Google errantly closed 91158, I submitted it again:\n    // https://code.google.com/p/chromium/issues/detail?id=389642\n    if (view.chrome && type && type !== force_saveable_type) {\n      slice = blob.slice || blob.webkitSlice;\n      blob = slice.call(blob, 0, blob.size, force_saveable_type);\n      blob_changed = true;\n    }\n    // Since I can't be sure that the guessed media type will trigger a download\n    // in WebKit, I append .download to the filename.\n    // https://bugs.webkit.org/show_bug.cgi?id=65440\n    if (webkit_req_fs && name !== 'download') {\n      name += '.download';\n    }\n    if (type === force_saveable_type || webkit_req_fs) {\n      target_view = view;\n    }\n    if (!req_fs) {\n      fs_error();\n      return;\n    }\n    fs_min_size += blob.size;\n    req_fs(view.TEMPORARY, fs_min_size, abortable(function (fs) {\n      fs.root.getDirectory('saved', create_if_not_found, abortable(function (dir) {\n        var save = function save() {\n          dir.getFile(name, create_if_not_found, abortable(function (file) {\n            file.createWriter(abortable(function (writer) {\n              writer.onwriteend = function (event) {\n                target_view.location.href = file.toURL();\n                filesaver.readyState = filesaver.DONE;\n                dispatch(filesaver, 'writeend', event);\n                revoke(file);\n              };\n              writer.onerror = function () {\n                var error = writer.error;\n                if (error.code !== error.ABORT_ERR) {\n                  fs_error();\n                }\n              };\n              'writestart progress write abort'.split(' ').forEach(function (event) {\n                writer['on' + event] = filesaver['on' + event];\n              });\n              writer.write(blob);\n              filesaver.abort = function () {\n                writer.abort();\n                filesaver.readyState = filesaver.DONE;\n              };\n              filesaver.readyState = filesaver.WRITING;\n            }), fs_error);\n          }), fs_error);\n        };\n        dir.getFile(name, { create: false }, abortable(function (file) {\n          // delete file if it already exists\n          file.remove();\n          save();\n        }), abortable(function (ex) {\n          if (ex.code === ex.NOT_FOUND_ERR) {\n            save();\n          } else {\n            fs_error();\n          }\n        }));\n      }), fs_error);\n    }), fs_error);\n  };\n\n  var FS_proto = FileSaver.prototype;\n  var saveAs = function saveAs(blob, name, no_auto_bom) {\n    return new FileSaver(blob, name, no_auto_bom);\n  };\n\n  // IE 10+ (native saveAs)\n  if (typeof navigator !== 'undefined' && navigator.msSaveOrOpenBlob) {\n    return function (blob, name, no_auto_bom) {\n      if (!no_auto_bom) blob = auto_bom(blob);\n      return navigator.msSaveOrOpenBlob(blob, name || 'download');\n    };\n  }\n\n  FS_proto.abort = function () {\n    var filesaver = this;\n    filesaver.readyState = filesaver.DONE;\n    dispatch(filesaver, 'abort');\n  };\n  FS_proto.readyState = FS_proto.INIT = 0;\n  FS_proto.WRITING = 1;\n  FS_proto.DONE = 2;\n\n  FS_proto.error = FS_proto.onwritestart = FS_proto.onprogress = FS_proto.onwrite = FS_proto.onabort = FS_proto.onerror = FS_proto.onwriteend = null;\n\n  return saveAs;\n}(typeof self !== 'undefined' && self || typeof window !== 'undefined' && window || undefined.content);\n// `self` is undefined in Firefox for Android content script context\n// while `this` is nsIContentFrameMessageManager\n// with an attribute `content` that corresponds to the window\n\nexports.default = saveAs;","import { MessageBot } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\n\nimport html from './extensions.html'\n\ninterface ExtensionInfo {\n    user: string\n    id: string\n    package: string\n    title: string\n    description: string\n    env: string\n}\n\nconst flatten = <T>(arr: T[][]): T[] => arr.reduce((carry, item) => carry.concat(item), [])\n// const pluck = <T, K extends keyof T>(arr: T[], key: K) => arr.map(item => item[key])\n\nexport const oldRepo = `https://gitcdn.xyz/cdn/Blockheads-Messagebot/Extensions/master/extensions.json`\nexport const defaultRepo = `https://blockheads-messagebot.github.io/Extensions/extensions.json`\n\nfunction supported(info: ExtensionInfo): boolean {\n    const env = info.env.toLocaleLowerCase()\n    return [\n        env.includes('all'),\n        env.includes('browser'),\n        (env.includes('mac') && env.includes('cloud')),\n    ].some(Boolean) && /\\.(m?js|es)/.test(info.package)\n}\n\nMessageBot.registerExtension('extensions', ex => {\n    const ui = ex.bot.getExports('ui') as UIExtensionExports\n    const tab = ui.addTab('Extensions')\n    tab.innerHTML = html\n\n    ex.storage.with('repos', defaultRepo, v => v.replace(oldRepo, defaultRepo))\n\n    tab.addEventListener('click', event => {\n        const target = event.target as HTMLElement\n        if (target.tagName != 'A') return\n        const id = target.getAttribute('ext_id')\n        if (!id) return\n\n        if (target.textContent == 'Install') {\n            load(id)\n        } else {\n            removeExtension(id)\n        }\n    })\n\n    ex.remove = () => {\n        throw new Error('This extension cannot be removed.')\n    }\n\n    function addExtension(id: string) {\n        try {\n            ex.bot.addExtension(id)\n            ex.storage.with<string[]>('autoload', [], ids => {\n                if (!ids.includes(id)) ids.push(id)\n            })\n            const button = tab.querySelector(`a[ext_id=\"${id}\"]`) as HTMLElement | null\n            if (button) button.textContent = 'Remove'\n        } catch (error) {\n            ui.notify('Error adding extension: ' + error)\n            try {\n                ex.bot.removeExtension(id, false)\n            } catch {}\n        }\n    }\n\n    function removeExtension(id: string) {\n        try {\n            ex.bot.removeExtension(id, true)\n            ex.storage.with<string[]>('autoload', [], ids => {\n                if (ids.includes(id)) ids.splice(ids.indexOf(id), 1)\n            })\n            const button = tab.querySelector(`a[ext_id=\"${id}\"]`) as HTMLElement | null\n            if (button) button.textContent = 'Install'\n        } catch (error) {\n            ui.notify('Error removing extension: ' + error)\n        }\n    }\n\n    function reloadExtension(id : string) {\n        //Does it exist as an extension we can reload?\n        const info = extensionMap.get(id)\n        if (!info) {\n            console.warn('Could not reload unknown ID:', id)\n            return\n        }\n        ex.bot.removeExtension(id, false)\n        MessageBot.deregisterExtension(id)\n        shouldLoad.add(id)\n        const script = document.head!.appendChild(document.createElement('script'))\n        script.src = info.package\n    }\n    ex.exports.reloadExtension = reloadExtension\n\n    // Load listener\n    const shouldLoad = new Set<string>()\n    MessageBot.extensionRegistered.sub(id => {\n        // If in developer mode, autoload unconditionally\n        if (ex.storage.get('devMode', false)) {\n            if (ex.bot.getExports(id)) ex.bot.removeExtension(id, false)\n            addExtension(id)\n        } else if (shouldLoad.has(id)) {\n            shouldLoad.delete(id)\n            addExtension(id)\n        }\n    })\n\n    const extensionMap = new Map<string, ExtensionInfo>()\n    function load(id: string) {\n        const info = extensionMap.get(id)\n        if (!info) {\n            console.warn('Could not load unknown ID:', id)\n            return\n        }\n        if (MessageBot.extensions.includes(id)) {\n            addExtension(id)\n        } else {\n            shouldLoad.add(id)\n            const script = document.head!.appendChild(document.createElement('script'))\n            script.src = info.package\n        }\n    }\n\n    // Load any extension repos\n    // Repos listed first should have priority for duplicate ids\n    const repos = ex.storage.get('repos', defaultRepo).split(/\\r?\\n/).reverse()\n    const repoRequests = repos.map(repo => fetch(repo).then(r => r.json()))\n    Promise.all(repoRequests)\n        .then((responses: ExtensionInfo[][]) => {\n            flatten(responses).filter(supported).forEach(extension => {\n                extensionMap.set(extension.id, extension)\n            })\n        })\n        .then(() => {\n            // Load those extensions which should be autoloaded\n            ex.storage.get<string[]>('autoload', []).forEach(load)\n            createPage()\n        }).catch(error => {\n            //In the scenario an extension repo fails to load.\n            console.error(error)\n            ui.notify('An extension repo has failed to load.')\n        })\n\n    function createPage() {\n        for (const extension of extensionMap.values()) {\n            ui.buildTemplate(\n                tab.querySelector('template') as HTMLTemplateElement,\n                tab.querySelector('tbody') as HTMLElement,\n                [\n                    { selector: '[data-for=title]', text: extension.title },\n                    { selector: '[data-for=description]', text: extension.description },\n                    { selector: '[data-for=author]', text: extension.user },\n                    { selector: 'a', ext_id: extension.id },\n                ]\n            )\n        }\n    }\n})\n","import { MessageBot } from '@bhmb/bot'\nimport { UIExtensionExports } from '@bhmb/ui'\nimport { saveAs } from 'save-as'\n\nimport html from './settings.html'\n\nimport { defaultRepo } from './extensions'\n\nconst settingDefaults: [string, string | number | boolean][] = [\n    // General\n    ['messages/announcementDelay', 10],\n    ['messages/maxResponses', 3],\n    ['messages/rejoinCooldown', 30],\n    ['messages/triggerCooldown', 10],\n    ['console/logJoinIps', true],\n    ['console/logUnparsedMessages', true],\n    // Advanced\n    ['messages/regexTriggers', false],\n    ['messages/disableWhitespaceTrimming', false],\n    ['splitMessages', false],\n    ['splitToken', '<split>'],\n    ['extensions/devMode', false],\n    ['extensions/repos', defaultRepo],\n]\n\nMessageBot.registerExtension('settings', function (ex) {\n    const settingsRoot = ex.bot.storage\n    const ui = ex.bot.getExports('ui') as UIExtensionExports\n\n    const tab = ui.addTab('Settings')\n    tab.innerHTML = html\n\n    for (const [key, def] of settingDefaults) {\n        const el = tab.querySelector(`[data-target=\"${key}\"]`) as HTMLInputElement\n\n        if (typeof def == 'boolean') {\n            el.checked = settingsRoot.get(key, def)\n        } else {\n            el.value = String(settingsRoot.get(key, def))\n        }\n    }\n\n    tab.addEventListener('change', () => {\n        for (const [key, def] of settingDefaults) {\n            const el = tab.querySelector(`[data-target=\"${key}\"]`) as HTMLInputElement\n\n            if (typeof def == 'boolean') {\n                settingsRoot.set(key, el.checked)\n            } else if (typeof def == 'number') {\n                settingsRoot.set(key, +el.value)\n            } else {\n                settingsRoot.set(key, el.value)\n            }\n        }\n    })\n\n    function importBackup(backup: string) {\n        let parsed: { [k: string]: string }\n        try {\n            parsed = JSON.parse(backup)\n            if (parsed === null) {\n                throw new Error('Invalid backup')\n            }\n        } catch (e) {\n            ui.notify('Invalid backup code. No action taken.')\n            return\n        }\n\n        localStorage.clear()\n\n        Object.keys(parsed).forEach((key) => {\n            localStorage.setItem(key, parsed[key])\n        })\n\n        location.reload()\n    }\n\n    (tab.querySelector('[data-do=show_backup]') as HTMLElement).addEventListener('click', () => {\n        // Must be loaded in a browser, so safe to use localStorage\n        const backup = JSON.stringify(localStorage).replace(/</g, '&lt;')\n        ui.alert(`<p>Copy this to a safe place.</p><textarea class=\"textarea\">${backup}</textarea>`)\n    })\n\n    ;(tab.querySelector('[data-do=import_backup]') as HTMLElement).addEventListener('click', () => {\n        ui.prompt('Enter your backup code, this will reload the page:', result => {\n            if (result) {\n                importBackup(result)\n            }\n        })\n    })\n\n    ;(tab.querySelector('[data-do=download_backup]') as HTMLElement).addEventListener('click', () => {\n        const backup = JSON.stringify(localStorage, undefined, 4)\n        if (!Blob) {\n            ui.notify(`Your browser doesn't support this.`)\n            return\n        }\n        const blob = new Blob([backup], {\n            type: 'text/plain;charset=utf-8'\n        })\n        saveAs(blob, 'bot_backup.txt')\n    })\n\n    ;(tab.querySelector('[data-do=upload_backup]') as HTMLElement).addEventListener('click', () => {\n        if (!File || !FileReader || !FileList || !Blob) {\n            ui.notify(`It looks like your browser doesn't support this.`)\n            return\n        }\n\n        const input = document.createElement('input')\n        input.type = 'file'\n        input.addEventListener('change', () => {\n            if (!input.files || input.files[0].type != 'text/plain') {\n                ui.notify('Upload a text file.')\n                return\n            }\n\n            const reader = new FileReader()\n            reader.addEventListener('load', () => {\n                importBackup(reader.result as string)\n            })\n\n            reader.readAsText(input.files[0])\n        })\n\n        input.click()\n    })\n\n    ex.remove = function () {\n        ui.removeTab(tab)\n    }\n})\n","import { MessageBot as CustomBot } from './bot'\nimport { MessageBot, SimpleEvent } from '@bhmb/bot'\nimport { Api, getWorlds } from 'blockheads-cloud-api'\nimport { WorldInfo } from 'blockheads-api-interface'\nimport { Storage } from './storage'\nimport '@bhmb/ui'\nimport '@bhmb/messages'\nimport '@bhmb/console'\nimport './settings'\nimport './extensions'\n\nif ((window as any)['@bhmb/bot']) {\n    throw new Error('Bot already loaded.')\n}\n\n(window as any)['@bhmb/bot'] = { MessageBot, SimpleEvent }\nconst worldId: string = (window as any).worldId.toString()\n\nif (location.hostname != 'portal.theblockheads.net') {\n    if (confirm('You are not on the portal, go there now?')) {\n        location.assign('http://portal.theblockheads.net')\n    }\n}\n\nif (!worldId) {\n    alert('You must be on a world page to start the bot')\n    throw new Error('Bad page')\n}\n// Kill the original listener\n(window as any).pollChat = () => {}\n\nMessageBot.dependencies = { Api, getWorlds, fetch }\n\nconst info: WorldInfo = {\n    name: (document.querySelector('#title') as HTMLElement).textContent as string,\n    id: worldId\n}\n\nasync function main() {\n    const bot = new CustomBot(new Storage(`/${worldId}`), info)\n    bot.addExtension('ui')\n    bot.addExtension('console')\n    ;(document.querySelector('.nav-item') as HTMLElement).click()\n    bot.addExtension('messages')\n    bot.addExtension('settings')\n    bot.addExtension('extensions')\n\n    // Check to see if the bot is loaded already\n    const loadChecker = (event: StorageEvent) => {\n        if (event.key === 'load_indicator' + worldId && event.newValue === '1') {\n            localStorage.setItem('already_loaded' + worldId, '1')\n            localStorage.setItem('load_indicator' + worldId, '0')\n        }\n    }\n    const loadWarner = (event: StorageEvent) => {\n        if (event.key === 'already_loaded' + worldId && event.newValue === '1') {\n            localStorage.setItem('already_loaded' + worldId, '0')\n            bot.getExports('ui')!\n                .alert('Warning: The bot is already loaded in another tab. If you leave this tab open, your storage may be overwritten and messages may be sent twice.')\n        }\n    }\n    addEventListener('storage', loadChecker)\n    addEventListener('storage', loadWarner)\n    // Fire the event so that we will be warned if another tab is already opened\n    localStorage.setItem('load_indicator' + worldId, '1')\n    // Reset the load indicator so that if another tab isn't opened, we will get an event when it is opened.\n    localStorage.setItem('load_indicator' + worldId, '0')\n\n    bot.start()\n    await bot.world.start()\n    await bot.world.getLists(true)\n}\nmain()\n\n"],"names":["MessageBotExtension","[object Object]","id","bot","this","exports","storage","prefix","world","remove","clear","equalCaseInsensitive","a","b","localeCompare","undefined","sensitivity","arrayContainsAny","haystack","needles","some","item","needle","Player","name","info","lists","_name","_info","_lists","ip","ips","joins","hasJoined","isOwner","owner","isAdmin","adminlist","isMod","modlist","isStaff","isWhitelisted","whitelist","isBanned","blacklist","entry","includes","substr","indexOf","SimpleEvent","subscribers","listener","push","once","index","findIndex","sub","splice","arg","forEach","unsub","error","console","that","one","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","ChatWatcher","api","online","_onMessage","_onJoin","_onLeave","_onOther","timeoutId","parse","message","parseError","dispatch","test","match","_","slice","getUser","length","startsWith","checkChat","lastId","log","nextId","getMessages","setTimeout","onJoin","asEvent","onLeave","onMessage","onOther","running","stop","clearTimeout","i","possibleName","substring","lastIndexOf","addToList","list","element","removeFromList","removeFromLists","cloneDate","d","Date","getTime","delay","time","r","PLAYERS_KEY","LAST_UPDATE_KEY","World","_cache","_events","_online","_commands","Map","_firstChatUpdate","now","getOverview","refresh","overview","_api","_storage","with","players","Object","assign","created","last_activity","credit_until","getStatus","getLists","setLists","currentLists","getLogs","logs","updatePlayers","_updatePlayers","map","line","timestamp","send","player","getPlayer","_messageQueue","callback","_executeMessageQueue","toLocaleUpperCase","get","addCommand","command","has","Error","set","removeCommand","delete","start","restart","startWatchingChat","_chatWatcher","stopWatchingChat","_lastLogUpdate","_createWatcher","keys","watcher","_userJoin","target","replace","updateLists","args","handler","lines","user","_recordJoin","shift","Storage","key","fallback","__rest","s","t","p","prototype","hasOwnProperty","call","getOwnPropertySymbols","registeredExtensions","extensionRegistered","extensionDeregistered","MessageBot","_extensions","dependencies","Api","initializer","toLocaleLowerCase","extensions","fetch","ex","creator","uninstall","_a","params","Name","NAME","safeKeyRegex","join","RegExp","catch","Bot","propertyIsEnumerable","messages","split","msg","super","LogParser","isValidLine","addLine","entries","reverse","ts","raw","root","request","unescapeHTML","html","lt","gt","amp","#39","quot","first","makeRequest","url","options","headers","X-Requested-With","method","mode","credentials","redirect","requestJSON","json","requestPage","text","toString","val","type","ctorName","Array","isArray","constructor","isBuffer","callee","err","isArguments","toDateString","getDate","setDate","isDate","stackTraceLimit","isError","flags","ignoreCase","multiline","global","isRegexp","throw","return","isGeneratorObj","toLowerCase","valueOf","Symbol","deep","typeOf","Number","Set","len","buf","Buffer","allocUnsafe","from","copy","cloneBuffer","cloneSymbol","res","byteLength","Uint8Array","cloneArrayBuffer","buffer","byteOffset","cloneTypedArray","exec","re","source","lastIndex","cloneRegExp","create","isObjectObject","o","isObject","ctor","prot","cloneDeep","instanceClone","isPlainObject","cloneObjectDeep","cloneArrayDeep","clone","storageCache","writeback","writeStorage","size","localStorage","setItem","JSON","stringify","setInterval","window","addEventListener","AStorage","head","fullKey","getItem","parsed","add","removeItem","filter","checkJoins","joins_low","joins_high","checkGroups","isInGroup","group","not_group","registerExtension","document","body","innerHTML","querySelectorAll","el","style","appendChild","createElement","rel","href","textContent","event","tagName","details","parentNode","getAttribute","open","removeAttribute","setAttribute","polyfill","menuSlider","querySelector","toggleMenu","classList","toggle","tabs","groups","container","getElementById","menuContainer","nav","tab","children","child","span","removeTab","content","div","handleRule","rule","HTMLTextAreaElement","HTMLSelectElement","selected","alertInstance","active","queue","modal","modalBody","modalFooter","addButton","button","styles","showAlert","buttons","buttonHandler","removeEventListener","alert","addTab","groupName","parent","addTabGroup","parentElement","removeTabGroup","buildTemplate","template","rules","importNode","selector","warn","notify","displayTime","timeouts","prompt","outerHTML","cooldowns","WeakMap","RemovableMessageHelper","rejoin","trigger","cd","find","unshift","Math","min","JoinListener","onCooldown","addCooldown","LeaveListener","TriggerListener","responses","triggerMatches","every","Boolean","trim","AnnouncementListener","run","data","commonjsGlobal","self","atoa","n","ticky","setImmediate","fn","process","nextTick","debounce","ctx","emitter","thing","opts","evt","on","_once","off","c","arguments","et","emit","emitterSnapshot","throws","listen","async","NativeCustomEvent","CustomEvent","customEvent","detail","foo","useNative","createEvent","initCustomEvent","bubbles","cancelable","createEventObject","eventmap","eventname","ron","eventmap_1","doc","addEvent","capturing","removeEvent","hardCache","attachEvent","wrapper","unwrap","originalEvent","srcElement","preventDefault","returnValue","stopPropagation","cancelBubble","which","keyCode","wrapperFactory","wrap","detachEvent","crossvent","fabricate","model","initEvent","makeClassicEvent","dispatchEvent","fireEvent","cache","end","lookupClass","className","cached","classes","current","rm","doc$1","documentElement","touchy","op","navigator","pointerEnabled","mouseup","mousedown","mousemove","msPointerEnabled","whichMouseButton","touches","getScroll","scrollProp","offsetProp","clientHeight","getElementBehindPoint","point","x","y","state","elementFromPoint","never","always","getRectWidth","rect","width","right","left","getRectHeight","height","bottom","top","getParent","isInput","isEditable","contentEditable","nextEl","nextElementSibling","sibling","nextSibling","nodeType","manually","getCoord","coord","host","targetTouches","changedTouches","getEventHost","missMap","pageX","pageY","dragula_1","initialContainers","_mirror","_source","_item","_offsetX","_offsetY","_moveX","_moveY","_initialSibling","_currentSibling","_copy","_renderTimer","_grabbed","_lastDropTarget","moves","accepts","invalid","containers","isContainer","copySortSource","revertOnSpill","removeOnSpill","direction","ignoreInputTextSelection","mirrorContainer","drake","context","canStart","cancel","destroy","events","release","canMove","dragging","grab","eventualMovements","startBecauseMouseMoved","movements","preventGrabbed","clientX","clientY","metaKey","ctrlKey","focus","grabbed","offset","getBoundingClientRect","cloneNode","drag","renderMirrorImage","handle","drop","ungrab","dropTarget","findDropTarget","removeChild","isInitialPlacement","cleanup","revert","reverts","initial","insertBefore","elementBehindCursor","accepted","immediate","getImmediateChild","reference","getReference","changed","moved","horizontal","inside","outside","after","joinHtml","leaveHtml","triggerHtml","annHtml","MessagesTab","setup","insertHTML","save","addMessage","matches","row","getElementWithClass","contains","dragger","_el","_container","input","dataset","ui","getExports","JoinTab","LeaveTab","TriggerTab","AnnouncementTab","history","addToHistory","pop","addIfNew","listeners","l","hasLoaded","delayLoad","timeout","concat","chatUl","chatContainer","userSend","addPlayerMessage","messageClass","class","MutationObserver","total","addedHeight","scrollHeight","scrollTop","observe","childList","subtree","consoleExports","logJoins","logLeaves","logMessages","logOther","li","addGenericMessage","defineProperty","saveAs","view","userAgent","get_URL","URL","webkitURL","save_link","createElementNS","can_use_save_link","is_safari","webkit_req_fs","webkitRequestFileSystem","req_fs","requestFileSystem","mozRequestFileSystem","throw_outside","fs_min_size","revoke","file","revokeObjectURL","filesaver","event_types","auto_bom","blob","Blob","FileSaver","no_auto_bom","instance","Constructor","TypeError","_classCallCheck","object_url","target_view","blob_changed","dispatch_all","fs_error","FileReader","reader","onloadend","base64Data","location","search","readyState","DONE","readAsDataURL","INIT","createObjectURL","abortable","func","create_if_not_found","exclusive","node","download","MouseEvent","chrome","webkitSlice","TEMPORARY","fs","getDirectory","dir","getFile","createWriter","writer","onwriteend","toURL","onerror","code","ABORT_ERR","write","abort","WRITING","NOT_FOUND_ERR","FS_proto","msSaveOrOpenBlob","onwritestart","onprogress","onwrite","onabort","defaultRepo","supported","env","package","addExtension","ids","removeExtension","v","load","reloadExtension","extensionMap","deregisterExtension","shouldLoad","src","repoRequests","repo","all","arr","reduce","carry","flatten","extension","values","title","description","ext_id","createPage","settingDefaults","settingsRoot","def","checked","String","importBackup","backup","reload","File","FileList","files","readAsText","click","worldId","hostname","confirm","pollChat","parser","page","getList","names","makeSafe","encodeURIComponent","firstMatch","m","privacy","link","pvp","password","status","response","worldStatus","getWorlds","worlds","CustomBot","newValue","main"],"mappings":"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"}