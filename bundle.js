!function(e){"use strict";class t{constructor(e,t){this.bot=t,this.exports={},this.storage=t.storage.prefix(e),this.world=t.world}remove(){}uninstall(){this.remove(),this.storage.clear()}}function n(e,t){return 0===e.localeCompare(t,void 0,{sensitivity:"base"})}function r(e,...t){return e.some(e=>t.some(t=>n(e,t)))}class s{constructor(e,t,n){this._name=e,this._info=t,this._lists=n}get name(){return this._name}get ip(){return this._info.ip}get ips(){return[...this._info.ips]}get joins(){return this._info.joins}get hasJoined(){return this.joins>0}get isOwner(){return!!this._info.owner||"SERVER"==this._name}get isAdmin(){return this.isOwner||r(this._lists.adminlist,this._name,this._info.ip)}get isMod(){return!this.isAdmin&&r(this._lists.modlist,this._name,this._info.ip)}get isStaff(){return this.isAdmin||this.isMod}get isWhitelisted(){return this.isStaff||r(this._lists.whitelist,this._name,this._info.ip)}get isBanned(){return!this.isStaff&&this._lists.blacklist.some(e=>(e.includes(" \\")&&(e=e.substr(0,e.indexOf(" \\"))),!!n(this._name,e)||!!this._info.ips.includes(e)))}}class i{constructor(){this.subscribers=[]}sub(e){this.subscribers.push({listener:e,once:!1})}unsub(e){let t=this.subscribers.findIndex(t=>e==t.listener);-1!=t&&this.subscribers.splice(t,1)}one(e){this.subscribers.push({listener:e,once:!0})}dispatch(e){this.subscribers.forEach(({listener:t,once:n})=>{n&&this.unsub(t);try{t(e)}catch(e){console.error(e)}})}asEvent(){let e=this;return{sub:t=>e.sub(t),one:t=>e.one(t),unsub:t=>e.unsub(t)}}}var o=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})};class a{constructor(e,t){this.api=e,this.online=t,this._onMessage=new i,this._onJoin=new i,this._onLeave=new i,this._onOther=new i,this.timeoutId=null,this.parse=(e=>{let t=()=>{this._onOther.dispatch(e)};if(/^[^a-z]+ - Player Connected /.test(e)){try{let[,t,n]=e.match(/Connected ([^a-z]{3,}) \| ([\d.]+) \| .{32}$/);if(!this.online.includes(t))return this.online.includes(t)||this.online.push(t),void this._onJoin.dispatch({name:t,ip:n})}catch(e){}return t()}if(/^[^a-z]+ - Player Disconnected /.test(e)){try{let[,t]=e.match(/Disconnected ([^a-z]{3,})$/);if(this.online.includes(t))return this.online.splice(this.online.indexOf(t),1),void this._onLeave.dispatch(t)}catch(e){}return t()}if(e.slice(0,18).includes(": ")){let n=this.getUser(e);if(n)return e=e.substr(n.length+2),"SERVER"==n&&e.startsWith("/")?t():void this._onMessage.dispatch({name:n,message:e})}return t()}),this.checkChat=(e=>o(this,void 0,void 0,function*(){try{let{log:t,nextId:n}=yield this.api.getMessages(e);if(null==this.timeoutId)return;t.forEach(this.parse),this.timeoutId=setTimeout(this.checkChat,5e3,n)}catch(e){return void(this.timeoutId=setTimeout(this.checkChat,3e4,0))}}))}get onJoin(){return this._onJoin.asEvent()}get onLeave(){return this._onLeave.asEvent()}get onMessage(){return this._onMessage.asEvent()}get onOther(){return this._onOther.asEvent()}get running(){return null!=this.timeoutId}start(){this.timeoutId&&this.stop(),this.timeoutId=setTimeout(this.checkChat,0,0)}stop(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null}getUser(e){for(let t=18;t>4;t--){let n=e.substring(0,e.lastIndexOf(": ",t));if(this.online.includes(n)||"SERVER"==n)return n}return/[^a-z]{3,16}: /.test(e)?e.substring(0,e.lastIndexOf(": ",18)):""}}const l=(e,t)=>!e.includes(t)&&e.push(t),c=(e,t)=>{const n=e.indexOf(t);-1!=n&&e.splice(n,1)},d=(e,t)=>e.forEach(e=>c(e,t));var u=function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})};const h=e=>new Date(e.getTime()),p="players",m="lastPlayersUpdate";class g{constructor(e,t){this._cache={},this._events={onJoin:new i,onLeave:new i,onMessage:new i},this._online=[],this._lists={adminlist:[],modlist:[],whitelist:[],blacklist:[]},this._commands=new Map,this._firstChatUpdate=Date.now(),this.getOverview=((e=!1)=>u(this,void 0,void 0,function*(){if(!this._cache.overview||e){let e=yield this._cache.overview=this._api.getOverview();e.online.forEach(e=>this._online.includes(e)||this._online.push(e)),this._storage.with(p,{},t=>{t[e.owner]=t[e.owner]||{ip:"",ips:[],joins:0},t[e.owner].owner=!0})}let t=yield this._cache.overview;return Object.assign({},t,{created:h(t.created),last_activity:h(t.last_activity),credit_until:h(t.credit_until),online:this.online})})),this.getStatus=(()=>this._api.getStatus()),this.getLists=((e=!1)=>(this._cache.lists&&!e||(this._cache.lists=this._api.getLists().then(e=>this._lists=e)),this._cache.lists.then(e=>({adminlist:[...e.adminlist],modlist:[...e.modlist],whitelist:[...e.whitelist],blacklist:[...e.blacklist]})))),this.setLists=(e=>u(this,void 0,void 0,function*(){let t=yield this.getLists();yield this._api.setLists(Object.assign({},t,e)),yield this.getLists(!0)})),this.getLogs=((e=!1)=>u(this,void 0,void 0,function*(){if(!this._cache.logs||e){const e=!this._cache.logs;this._cache.logs=this._api.getLogs(),e&&(yield this._updatePlayers())}return(yield this._cache.logs).slice().map(e=>Object.assign({},e,{timestamp:h(e.timestamp)}))})),this.send=(e=>(e.startsWith("/")&&this._events.onMessage.dispatch({player:this.getPlayer("SERVER"),message:e}),new Promise(t=>{this._messageQueue.push({message:e,callback:t}),1===this._messageQueue.length&&this._executeMessageQueue()}))),this.getPlayer=(e=>{e=e.toLocaleUpperCase();let t=this._storage.get(p,{});return new s(e,t[e]||{ip:"",ips:[],joins:0},this._lists)}),this.addCommand=((e,t)=>{if(e=e.toLocaleUpperCase(),this._commands.has(e))throw new Error(`The command "${e}" has already been added.`);this._commands.set(e,t)}),this.removeCommand=(e=>{this._commands.delete(e.toLocaleUpperCase())}),this.start=(()=>this._api.start()),this.stop=(()=>this._api.stop()),this.restart=(()=>this._api.restart()),this.startWatchingChat=(()=>this._chatWatcher.start()),this.stopWatchingChat=(()=>this._chatWatcher.stop()),this._api=e,this._storage=t,this._lastLogUpdate=t.get(m,0),this._messageQueue=[],this._createWatcher(),this.getOverview(),this.getLists()}get onJoin(){return this._events.onJoin.asEvent()}get onLeave(){return this._events.onLeave.asEvent()}get onMessage(){return this._events.onMessage.asEvent()}get onOther(){return this._chatWatcher.onOther}get online(){return[...this._online]}get players(){let e=this._storage.get(p,{});return Object.keys(e).map(this.getPlayer)}_createWatcher(){let e=this._chatWatcher=new a(this._api,this._online);e.onJoin.sub(e=>this._userJoin(e)),e.onLeave.sub(e=>this._events.onLeave.dispatch(this.getPlayer(e))),e.onMessage.sub(({name:e,message:t})=>{const n=this.getPlayer(e);this._events.onMessage.dispatch({player:n,message:t}),function(e,t,n){if(!t.isAdmin)return;const r=(n=n.toLocaleUpperCase()).replace(/^\/\w+? /,"");n.startsWith("/ADMIN ")?(l(e.adminlist,r),c(e.blacklist,r)):n.startsWith("/UNADMIN ")?c(e.adminlist,r):n.startsWith("/MOD ")?(l(e.modlist,r),c(e.blacklist,r)):n.startsWith("/UNMOD ")?c(e.modlist,r):n.startsWith("/BAN ")?(d([e.adminlist,e.whitelist,e.modlist],r),l(e.blacklist,r)):n.startsWith("/UNBAN ")?c(e.blacklist,r):n.startsWith("/WHITELIST ")?(c(e.blacklist,r),l(e.whitelist,r)):n.startsWith("/UNWHITELIST ")&&c(e.whitelist,r)}(this._lists,n,t)}),this.onMessage.sub(({player:e,message:t})=>{if(/^\/[^ ]/.test(t)){const[,n,r]=t.match(/^\/([^ ]+) ?(.*)$/),s=this._commands.get(n.toLocaleUpperCase());s&&s(e,r)}})}_updatePlayers(){return u(this,void 0,void 0,function*(){const e=yield this.getLogs(),{name:t}=yield this.getOverview();for(const n of e){if(n.timestamp.getTime()<this._lastLogUpdate)continue;if(n.timestamp.getTime()>this._firstChatUpdate)continue;if(!n.message.startsWith(`${t} - Player Connected`))continue;const[,e,r]=n.message.match(/Connected ([^a-z]{3,}) \| ([\d.]+) \| .{32}$/);this._recordJoin({name:e,ip:r})}})}_recordJoin({name:e,ip:t}){e=e.toLocaleUpperCase(),this._storage.with(p,{},n=>{const r=n[e]=n[e]||{ip:t,ips:[t],joins:0};r.joins++,r.ip=t,r.ips.includes(t)||r.ips.push(t)}),this._storage.set(m,Date.now())}_userJoin({name:e,ip:t}){this._recordJoin({name:e,ip:t}),this._events.onJoin.dispatch(this.getPlayer(e))}_executeMessageQueue(){return u(this,void 0,void 0,function*(){for(;this._messageQueue.length>0;){const{message:e,callback:t}=this._messageQueue[0];try{yield this._api.send(e)}catch(e){}t(),this._messageQueue.shift()}})}}class f{with(e,t,n){let r=this.get(e,t),s=n(r);this.set(e,null==s?r:s)}}var v=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&(n[r[s]]=e[r[s]])}return n};let b=new Map,y=new i,w=new i;class x{constructor(e,t){if(this.storage=e,this._extensions=new Map,!x.dependencies)throw new Error("Dependencies must be set before creating this class.");this.world=new g(new x.dependencies.Api(t),e)}static registerExtension(e,t){e=e.toLocaleLowerCase(),b.set(e,t),y.dispatch(e)}static deregisterExtension(e){e=e.toLocaleLowerCase(),b.delete(e)&&w.dispatch(e)}static get extensions(){return[...b.keys()]}get extensions(){return[...this._extensions.keys()]}get fetch(){return x.dependencies.fetch}start(){this.world.startWatchingChat()}getExports(e){let t=this._extensions.get(e.toLocaleLowerCase());if(t)return t.exports}addExtension(e){if(e=e.toLocaleLowerCase(),this._extensions.has(e))throw new Error(`The ${e} extension has already been added.`);let n=b.get(e);if(!n)throw new Error(`The ${e} extension has not been registered.`);let r=new t(e,this);this._extensions.set(e,r),n.call(r,r,this.world)}removeExtension(e,t){e=e.toLocaleLowerCase();let n=this._extensions.get(e);if(!n)throw new Error(`The ${e} extension is not registered.`);try{t?n.uninstall():n.remove()}finally{this._extensions.delete(e)}}send(e,t={}){var n=v(t,[]);if(n.name&&n.name.length){let e=n.name.toLocaleLowerCase();n=Object.assign({},n,{name:e,Name:e[0].toLocaleUpperCase()+e.substr(1),NAME:e.toLocaleUpperCase()})}let r=Object.keys(n).map(e=>e.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1")).join("}}|{{");r.length&&(e=e.replace(new RegExp(`{{${r}}}`,"g"),e=>n[e.substring(2,e.length-2)])),this.world.send(e).catch(()=>{})}}x.extensionRegistered=y.asEvent(),x.extensionDeregistered=w.asEvent();class E extends x{send(e,t={}){var n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&(n[r[s]]=e[r[s]])}return n}(t,[]);let r;r=this.storage.get("splitMessages",!1)?e.split(this.storage.get("splitToken","<split>")):[e];for(const e of r)super.send(e,n)}}function _(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})}class S{constructor(){this.parse=(e=>{for(let t=(e=e.slice(0)).length-1;t>0;t--){const n=e[t];this.isValidLine(n)?this.addLine(n):e[t-1]+="\n"+e.splice(t,1)}this.isValidLine(e[0])&&this.addLine(e[0]);const t=this.entries.reverse();return this.entries=[],t}),this.isValidLine=(e=>/^\d{4}-\d\d-\d\d \d\d:\d\d:\d\d\.\d{3} blockheads_server/.test(e)),this.addLine=(e=>{const t=e.substr(0,24).replace(" ","T").replace(" ","Z");this.entries.push({raw:e,timestamp:new Date(t),message:e.substr(e.indexOf("]")+2)})}),this.entries=[]}}const k="http://portal.theblockheads.net";let L;try{L=fetch}catch(e){}function T(e){const t={lt:"<",gt:">",amp:"&","#39":"'",quot:'"'};return e.replace(/&(lt|gt|amp|#39|quot);/g,(e,n)=>t[n])}function M(e,t={}){const n={"X-Requested-With":"XMLHttpRequest"};return"POST"==t.method&&(n["Content-Type"]="application/x-www-form-urlencoded"),L(`${k}${e}`,Object.assign({mode:"same-origin",credentials:"same-origin",redirect:"follow",headers:n},t))}function C(e,t){return M(e,t).then(e=>e.json())}function O(e,t){return M(e,t).then(e=>e.text())}var A=Object.prototype.toString,I=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=typeof e;if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return"GeneratorFunction"===j(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){if(e.constructor&&"function"==typeof e.constructor.isBuffer)return e.constructor.isBuffer(e);return!1}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(j(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(t=A.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function j(e){return e.constructor?e.constructor.name:null}const N=Symbol.prototype.valueOf;var R=function(e,t){switch(I(e)){case"array":return e.slice();case"object":return Object.assign({},e);case"date":return new e.constructor(+e);case"map":return new Map(e);case"set":return new Set(e);case"buffer":return function(e){const t=e.length,n=Buffer.allocUnsafe?Buffer.allocUnsafe(t):new Buffer(t);return e.copy(n),n}(e);case"symbol":return function(e){return N?Object(N.call(e)):{}}(e);case"arraybuffer":return function(e){const t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}(e);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return function(e,t){return new e.constructor(e.buffer,e.byteOffset,e.length)}(e);case"regexp":return function(e){const t=new e.constructor(e.source,/\w+$/.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"error":return Object.create(e);default:return e}},D=Object.prototype.toString,P=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=typeof e;if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return"GeneratorFunction"===U(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){if(e.constructor&&"function"==typeof e.constructor.isBuffer)return e.constructor.isBuffer(e);return!1}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(U(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(t=D.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function U(e){return e.constructor?e.constructor.name:null}var $=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)};function q(e){return!0===$(e)&&"[object Object]"===Object.prototype.toString.call(e)}var B=function(e){var t,n;return!1!==q(e)&&("function"==typeof(t=e.constructor)&&(!1!==q(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf")))};function W(e,t){switch(P(e)){case"object":return function(e,t){if("function"==typeof t)return t(e);if(t||B(e)){const n=new e.constructor;for(let r in e)n[r]=W(e[r],t);return n}return e}(e,t);case"array":return function(e,t){const n=new e.constructor(e.length);for(let r=0;r<e.length;r++)n[r]=W(e[r],t);return n}(e,t);default:return R(e)}}var J=W;const H=new Map,z=new Set;function F(){if(0!==z.size){for(const e of z)localStorage.setItem(e,JSON.stringify(H.get(e)));z.clear()}}setInterval(F,1e4),window.addEventListener("unload",F);class X extends f{constructor(e){super(),this.head=e,this.head+="/"}get(e,t){const n=this.head+e;if(H.has(n))return J(H.get(n));try{const e=localStorage.getItem(n),r=JSON.parse(e);return null!=r?(H.set(n,r),J(r)):t}catch(e){return t}}set(e,t){const n=this.head+e;H.set(n,J(t)),z.add(n)}clear(e=""){this.keys(e).forEach(e=>{z.delete(this.head+e),H.delete(this.head+e),localStorage.removeItem(this.head+e)})}keys(e=""){return Object.keys(localStorage).filter(t=>t.startsWith(this.head+e)).map(e=>e.substr(this.head.length))}prefix(e){return new X(this.head+e)}}function Y(e,t){return e.joins>=t.joins_low&&e.joins<=t.joins_high}function V(e,t){return G(e,t.group)&&!G(e,t.not_group)}function G(e,t){switch(t){case"all":return!0;case"staff":return e.isStaff;case"mod":return e.isMod;case"admin":return e.isAdmin;case"owner":return e.isOwner;default:return!1}}x.registerExtension("ui",function(e){if("undefined"==typeof document)throw new Error("This extension cannot be loaded outside of a browser environment.");e.uninstall=function(){throw new Error("The UI extension cannot be removed once loaded")},document.body.innerHTML='<header class="header is-fixed-top">\r\n    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">\r\n        <div class="navbar-brand">\r\n            <div class="navbar-item nav-slider-toggle">\r\n                <img src="https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/logo.png">\r\n            </div>\r\n            <a class="navbar-item nav-slider-toggle">Menu</a>\r\n        </div>\r\n    </nav>\r\n</header>\r\n\r\n<div class="nav-slider-container">\r\n    <nav class="nav-slider"></nav>\r\n    <div class="is-overlay nav-slider-toggle"></div>\r\n</div>\r\n\r\n<div id="container" class="has-fixed-nav"></div>\r\n\r\n\r\n<div id="modal" class="modal">\r\n    <div class="modal-background"></div>\r\n    <div class="modal-card">\r\n        <header class="modal-card-head"></header>\r\n        <section class="modal-card-body"></section>\r\n        <footer class="modal-card-foot"></footer>\r\n    </div>\r\n</div>\r\n',document.head.querySelectorAll("link").forEach(e=>e.remove());let t=document.head.appendChild(document.createElement("link"));t.rel="stylesheet",t.href="https://gitcdn.xyz/cdn/Blockheads-Messagebot/UI/master/index.css",function(){if(!("open"in document.createElement("details"))){let e=document.createElement("style");e.textContent+='details:not([open]) > :not(summary) { display: none !important } details > summary:before { content: "â–¶" display: inline-block font-size: .8em width: 1.5em font-family:"Courier New" } details[open] > summary:before { transform: rotate(90deg) }',document.head.appendChild(e),window.addEventListener("click",function(e){let t=e.target;if("SUMMARY"==t.tagName){let e=t.parentNode;if(!e)return;e.getAttribute("open")?(e.open=!1,e.removeAttribute("open")):(e.open=!0,e.setAttribute("open","open"))}})}}(),e.exports=function(){const e=document.querySelector(".nav-slider-container .nav-slider"),t=()=>e.classList.toggle("is-active");for(let e of document.querySelectorAll(".nav-slider-toggle"))e.addEventListener("click",t);const n=new Map,r=new Map,s=document.getElementById("container"),i=document.querySelector(".nav-slider");i.addEventListener("click",e=>{let t=e.target,r=n.get(t);r&&(Array.from(s.children).forEach(e=>e.classList.remove("visible")),r.classList.add("visible"),Array.from(i.querySelectorAll("span.nav-item")).forEach(e=>e.classList.remove("is-active")),t.classList.add("is-active"))});const o=e=>{for(let[t,r]of n.entries())if(r==e)return r.remove(),t.remove(),void n.delete(t)},a=(e,t)=>{"string"==typeof e.text?t.textContent=e.text:"string"==typeof e.html&&(t.innerHTML=e.html);let n=["text","html","selector"];if(t instanceof HTMLTextAreaElement&&"value"in e&&(t.textContent=e.value,n.push("value")),t instanceof HTMLSelectElement&&"value"in e){let n=t.querySelector(`[value="${e.value}"]`);n&&(n.selected=!0)}Object.keys(e).filter(e=>!n.includes(e)).forEach(n=>{n in t?t[n]=e[n]:t.setAttribute(n,e[n])})};let l={active:!1,queue:[]};const c=document.getElementById("modal"),d=c.querySelector(".modal-card-body"),u=c.querySelector(".modal-card-foot"),h=e=>{let t=u.appendChild(document.createElement("a")),n=["button"];"object"==typeof e?(e.style&&n.push(e.style),t.textContent=e.text):t.textContent=e,t.classList.add(...n)},p=()=>{l.active=!0;const{html:e,buttons:t,callback:n}=l.queue.shift();d.innerHTML=e,Array.isArray(t)?t.forEach(h):h("OK"),c.classList.add("is-active"),u.addEventListener("click",function e(t){let r=t.target;if("A"==r.tagName){c.classList.remove("is-active");try{n&&n.call(null,r.textContent)}catch(e){console.error("Error calling alert callback",e)}u.innerHTML="",u.removeEventListener("click",e),l.active=!1,l.queue.length&&p()}})},m=(e,t,n)=>{l.queue.push({html:e,buttons:t,callback:n}),l.active||p()};return{toggleMenu:t,addTab:(e,t)=>{let o=s.appendChild(document.createElement("div")),a=i;t&&(a=r.get(t));let l=a.appendChild(document.createElement("span"));return l.textContent=e,l.classList.add("nav-item"),n.set(l,o),o},removeTab:o,addTabGroup:(e,t,n)=>{let s=r.get(t);if(s)return void(s.children[0].textContent=e);let o=i;n&&(o=r.get(n)),(s=o.appendChild(document.createElement("details"))).classList.add("nav-item"),s.appendChild(document.createElement("summary")).textContent=e,r.set(t,s)},removeTabGroup:e=>{let t=r.get(e);if(t){for(let e of t.querySelectorAll("span"))o(n.get(e));r.delete(e),t.remove()}},buildTemplate:(e,t,n)=>{"string"==typeof e&&(e=document.querySelector(e)),"string"==typeof t&&(t=document.querySelector(t));let r=document.importNode(e.content,!0);for(let e of n){let t=r.querySelector(e.selector);t?a(e,t):console.warn(`Could not find ${e.selector}`,e)}t.appendChild(r)},notify:(e,t=3)=>{let n=document.body.appendChild(document.createElement("div"));n.classList.add("bot-notification","is-active"),n.textContent=e;let r=[setTimeout(()=>n.classList.remove("is-active"),1e3*t),setTimeout(()=>n.remove(),1e3*(t+1))];n.addEventListener("click",()=>{r.forEach(clearTimeout),n.remove()})},alert:m,prompt:(e,t)=>{let n=document.createElement("p");n.textContent=e,m(n.outerHTML+'<textarea class="textarea"></textarea>',["OK","Cancel"],()=>{let e=d.querySelector("textarea");t&&t(e.value||"")})}}}()});const Q=new WeakMap;class K{constructor(e,t){this.id=e,this.ex=t,Q.has(t)||Q.set(t,{rejoin:[],trigger:[]})}get messages(){return this.ex.storage.get(this.id,[])}onCooldown(e,t,n,r){const s=Q.get(this.ex)[t].find(t=>t.name===e.name);return!!s&&s.time+1e3*this.ex.storage.get(n,r)>Date.now()}addCooldown(e,t){const n=Q.get(this.ex)[t];n.unshift({name:e.name,time:Date.now()}),n.length=Math.min(32,n.length)}}class Z extends K{constructor(e){super("joinArr",e),this.listener=(e=>{if(!this.onCooldown(e,"rejoin","rejoinCooldown",30)){this.addCooldown(e,"rejoin");for(let t of this.messages)Y(e,t)&&V(e,t)&&this.ex.bot.send(t.message,{name:e.name})}}),this.ex.world.onJoin.sub(this.listener)}remove(){this.ex.world.onJoin.unsub(this.listener)}}class ee extends K{constructor(e){super("leaveArr",e),this.listener=(e=>{if(!this.onCooldown(e,"rejoin","rejoinCooldown",30)){this.addCooldown(e,"rejoin");for(let t of this.messages)Y(e,t)&&V(e,t)&&this.ex.bot.send(t.message,{name:e.name})}}),this.ex.world.onLeave.sub(this.listener)}remove(){this.ex.world.onLeave.unsub(this.listener)}}class te extends K{constructor(e){super("triggerArr",e),this.listener=(({player:e,message:t})=>{if("SERVER"==e.name)return;if(this.onCooldown(e,"trigger","triggerCooldown",10))return;let n=0;for(let r of this.messages){[Y(e,r),V(e,r),this.triggerMatches(t,r.trigger)].every(Boolean)&&++n<=this.ex.storage.get("maxResponses",3)&&(this.addCooldown(e,"trigger"),this.ex.bot.send(r.message,{name:e.name}))}}),this.ex.world.onMessage.sub(this.listener)}remove(){this.ex.world.onMessage.unsub(this.listener)}triggerMatches(e,t){if(this.ex.storage.get("disableWhitespaceTrimming",!1)||(t=t.trim()),this.ex.storage.get("regexTriggers",!1))try{return new RegExp(t,"i").test(e)}catch(e){return!1}return t=t.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1").replace(/\*/g,".*"),new RegExp(t,"i").test(e)}}class ne extends K{constructor(e){super("announcementArr",e),this.index=0,this.run=(()=>{if(this.index>=this.messages.length&&(this.index=0),this.ex.world.online.length){const e=this.messages[this.index++];e&&e.message&&this.ex.bot.send(e.message)}else this.index=0;this.timeoutId=setTimeout(this.run,this.delay)}),this.timeoutId=setTimeout(this.run,this.delay)}get delay(){return 6e4*this.ex.storage.get("announcementDelay",10)}remove(){clearTimeout(this.timeoutId)}}var re="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},se=function(e,t){return Array.prototype.slice.call(e,t)},ie="function"==typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},oe=function(e,t){var n=t||{},r={};return void 0===e&&(e={}),e.on=function(t,n){return r[t]?r[t].push(n):r[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var s=arguments.length;if(1===s)delete r[t];else if(0===s)r={};else{var i=r[t];if(!i)return e;i.splice(i.indexOf(n),1)}return e},e.emit=function(){var t=se(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var s=(r[t]||[]).slice(0);return function(){var r=se(arguments),i=this||e;if("error"===t&&!1!==n.throws&&!s.length)throw 1===r.length?r[0]:r;return s.forEach(function(s){n.async?function(e,t,n){e&&ie(function(){e.apply(n||null,t||[])})}(s,r,i):s.apply(i,r),s._once&&e.off(t,s)}),e}},e},ae=re.CustomEvent;var le=function(){try{var e=new ae("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?ae:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n},ce=[],de="",ue=/^on/;for(de in re)ue.test(de)&&ce.push(de.slice(2));var he=ce,pe=re.document,me=function(e,t,n,r){return e.addEventListener(t,n,r)},ge=function(e,t,n,r){return e.removeEventListener(t,n,r)},fe=[];re.addEventListener||(me=function(e,t,n){return e.attachEvent("on"+t,function(e,t,n){var r=be(e,t,n)||function(e,t,n){return function(t){var r=t||re.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,n.call(e,r)}}(e,0,n);return fe.push({wrapper:r,element:e,type:t,fn:n}),r}(e,t,n))},ge=function(e,t,n){var r=be(e,t,n);if(r)return e.detachEvent("on"+t,r)});var ve={add:me,remove:ge,fabricate:function(e,t,n){var r=-1===he.indexOf(t)?new le(t,{detail:n}):function(){var e;pe.createEvent?(e=pe.createEvent("Event")).initEvent(t,!0,!0):pe.createEventObject&&(e=pe.createEventObject());return e}();e.dispatchEvent?e.dispatchEvent(r):e.fireEvent("on"+t,r)}};function be(e,t,n){var r=function(e,t,n){var r,s;for(r=0;r<fe.length;r++)if((s=fe[r]).element===e&&s.type===t&&s.fn===n)return r}(e,t,n);if(r){var s=fe[r].wrapper;return fe.splice(r,1),s}}var ye={},we="(?:^|\\s)",xe="(?:\\s|$)";function Ee(e){var t=ye[e];return t?t.lastIndex=0:ye[e]=t=new RegExp(we+e+xe,"g"),t}var _e={add:function(e,t){var n=e.className;n.length?Ee(t).test(n)||(e.className+=" "+t):e.className=t},rm:function(e,t){e.className=e.className.replace(Ee(t)," ").trim()}},Se=document,ke=Se.documentElement;function Le(e,t,n,r){re.navigator.pointerEnabled?ve[t](e,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[n],r):re.navigator.msPointerEnabled?ve[t](e,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[n],r):(ve[t](e,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[n],r),ve[t](e,n,r))}function Te(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function Me(e,t){return void 0!==re[t]?re[t]:ke.clientHeight?ke[e]:Se.body[e]}function Ce(e,t,n){var r,s=e||{},i=s.className;return s.className+=" gu-hide",r=Se.elementFromPoint(t,n),s.className=i,r}function Oe(){return!1}function Ae(){return!0}function Ie(e){return e.width||e.right-e.left}function je(e){return e.height||e.bottom-e.top}function Ne(e){return e.parentNode===Se?null:e.parentNode}function Re(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||function e(t){if(!t)return!1;if("false"===t.contentEditable)return!1;if("true"===t.contentEditable)return!0;return e(Ne(t))}(e)}function De(e){return e.nextElementSibling||function(){var t=e;do{t=t.nextSibling}while(t&&1!==t.nodeType);return t}()}function Pe(e,t){var n=function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}(t),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in n)&&r[e]in n&&(e=r[e]),n[e]}var Ue=function(e,t){var n,r,s,i,o,a,l,c,d,u,h;1===arguments.length&&!1===Array.isArray(e)&&(t=e,e=[]);var p,m=null,g=t||{};void 0===g.moves&&(g.moves=Ae),void 0===g.accepts&&(g.accepts=Ae),void 0===g.invalid&&(g.invalid=function(){return!1}),void 0===g.containers&&(g.containers=e||[]),void 0===g.isContainer&&(g.isContainer=Oe),void 0===g.copy&&(g.copy=!1),void 0===g.copySortSource&&(g.copySortSource=!1),void 0===g.revertOnSpill&&(g.revertOnSpill=!1),void 0===g.removeOnSpill&&(g.removeOnSpill=!1),void 0===g.direction&&(g.direction="vertical"),void 0===g.ignoreInputTextSelection&&(g.ignoreInputTextSelection=!0),void 0===g.mirrorContainer&&(g.mirrorContainer=Se.body);var f=oe({containers:g.containers,start:function(e){var t=S(e);t&&k(t)},end:L,cancel:A,remove:O,destroy:function(){b(!0),M({})},canMove:function(e){return!!S(e)},dragging:!1});return!0===g.removeOnSpill&&f.on("over",function(e){_e.rm(e,"gu-hide")}).on("out",function(e){f.dragging&&_e.add(e,"gu-hide")}),b(),f;function v(e){return-1!==f.containers.indexOf(e)||g.isContainer(e)}function b(e){var t=e?"remove":"add";Le(ke,t,"mousedown",E),Le(ke,t,"mouseup",M)}function y(e){Le(ke,e?"remove":"add","mousemove",_)}function w(e){var t=e?"remove":"add";ve[t](ke,"selectstart",x),ve[t](ke,"click",x)}function x(e){p&&e.preventDefault()}function E(e){if(a=e.clientX,l=e.clientY,1===Te(e)&&!e.metaKey&&!e.ctrlKey){var t=e.target,n=S(t);n&&(p=n,y(),"mousedown"===e.type&&(Re(t)?t.focus():e.preventDefault()))}}function _(e){if(p)if(0!==Te(e)){if(void 0===e.clientX||e.clientX!==a||void 0===e.clientY||e.clientY!==l){if(g.ignoreInputTextSelection){var t=Pe("clientX",e),r=Pe("clientY",e);if(Re(Se.elementFromPoint(t,r)))return}var c=p;y(!0),w(),L(),k(c);var d,h={left:(d=s.getBoundingClientRect()).left+Me("scrollLeft","pageXOffset"),top:d.top+Me("scrollTop","pageYOffset")};i=Pe("pageX",e)-h.left,o=Pe("pageY",e)-h.top,_e.add(u||s,"gu-transit"),function(){if(!n){var e=s.getBoundingClientRect();(n=s.cloneNode(!0)).style.width=Ie(e)+"px",n.style.height=je(e)+"px",_e.rm(n,"gu-transit"),_e.add(n,"gu-mirror"),g.mirrorContainer.appendChild(n),Le(ke,"add","mousemove",R),_e.add(g.mirrorContainer,"gu-unselectable"),f.emit("cloned",n,s,"mirror")}}(),R(e)}}else M({})}function S(e){if(!(f.dragging&&n||v(e))){for(var t=e;Ne(e)&&!1===v(Ne(e));){if(g.invalid(e,t))return;if(!(e=Ne(e)))return}var r=Ne(e);if(r&&!g.invalid(e,t)&&g.moves(e,r,t,De(e)))return{item:e,source:r}}}function k(e){var t,n;t=e.item,n=e.source,("boolean"==typeof g.copy?g.copy:g.copy(t,n))&&(u=e.item.cloneNode(!0),f.emit("cloned",u,e.item,"copy")),r=e.source,s=e.item,c=d=De(e.item),f.dragging=!0,f.emit("drag",s,r)}function L(){if(f.dragging){var e=u||s;C(e,Ne(e))}}function T(){p=!1,y(!0),w(!0)}function M(e){if(T(),f.dragging){var t=u||s,i=Pe("clientX",e),o=Pe("clientY",e),a=N(Ce(n,i,o),i,o);a&&(u&&g.copySortSource||!u||a!==r)?C(t,a):g.removeOnSpill?O():A()}}function C(e,t){var n=Ne(e);u&&g.copySortSource&&t===r&&n.removeChild(s),j(t)?f.emit("cancel",e,r,r):f.emit("drop",e,t,r,d),I()}function O(){if(f.dragging){var e=u||s,t=Ne(e);t&&t.removeChild(e),f.emit(u?"cancel":"remove",e,t,r),I()}}function A(e){if(f.dragging){var t=arguments.length>0?e:g.revertOnSpill,n=u||s,i=Ne(n),o=j(i);!1===o&&t&&(u?i&&i.removeChild(u):r.insertBefore(n,c)),o||t?f.emit("cancel",n,r,r):f.emit("drop",n,i,r,d),I()}}function I(){var e=u||s;T(),n&&(_e.rm(g.mirrorContainer,"gu-unselectable"),Le(ke,"remove","mousemove",R),Ne(n).removeChild(n),n=null),e&&_e.rm(e,"gu-transit"),h&&clearTimeout(h),f.dragging=!1,m&&f.emit("out",e,m,r),f.emit("dragend",e),r=s=u=c=d=h=m=null}function j(e,t){var i;return i=void 0!==t?t:n?d:De(u||s),e===r&&i===c}function N(e,t,n){for(var i=e;i&&!o();)i=Ne(i);return i;function o(){if(!1===v(i))return!1;var o=D(i,e),a=P(i,o,t,n);return!!j(i,a)||g.accepts(s,i,r,a)}}function R(e){if(n){e.preventDefault();var t=Pe("clientX",e),a=Pe("clientY",e),l=t-i,h=a-o;n.style.left=l+"px",n.style.top=h+"px";var p=u||s,v=Ce(n,t,a),b=N(v,t,a),y=null!==b&&b!==m;(y||null===b)&&(m&&_("out"),m=b,y&&_("over"));var w=Ne(p);if(b!==r||!u||g.copySortSource){var x,E=D(b,v);if(null!==E)x=P(b,E,t,a);else{if(!0!==g.revertOnSpill||u)return void(u&&w&&w.removeChild(p));x=c,b=r}(null===x&&y||x!==p&&x!==De(p))&&(d=x,b.insertBefore(p,x),f.emit("shadow",p,b,r))}else w&&w.removeChild(p)}function _(e){f.emit(e,p,m,r)}}function D(e,t){for(var n=t;n!==e&&Ne(n)!==e;)n=Ne(n);return n===ke?null:n}function P(e,t,n,r){var s,i="horizontal"===g.direction;return t!==e?(s=t.getBoundingClientRect(),o(i?n>s.left+Ie(s)/2:r>s.top+je(s)/2)):function(){var t,s,o,a=e.children.length;for(t=0;t<a;t++){if(s=e.children[t],o=s.getBoundingClientRect(),i&&o.left+o.width/2>n)return s;if(!i&&o.top+o.height/2>r)return s}return null}();function o(e){return e?De(t):t}}},$e='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Join Messages</h3>\r\n        <ul>\r\n            <li>These messages will be checked when a player joins the server.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n',qe='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Leave Messages</h3>\r\n        <ul>\r\n            <li>These messages will be checked when a player leaves the server.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n',Be='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Trigger</p>\r\n            </div>\r\n            <div class="column is-2-desktop">\r\n                <input class="input is-small" data-target="trigger">\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-3">\r\n                <details>\r\n                    <summary>More options</summary>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is </p>\r\n                        <div class="control">\r\n                            <select data-target="group" class="select is-small">\r\n                                <option value="all">anyone</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <p class="has-text-weight-bold">Player is not </p>\r\n                        <div class="control">\r\n                            <select data-target="not_group" class="select is-small">\r\n                                <option value="nobody">nobody</option>\r\n                                <option value="staff">a staff member</option>\r\n                                <option value="mod">a mod</option>\r\n                                <option value="admin">an admin</option>\r\n                                <option value="owner">the owner</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div class="level-options">\r\n                        <div class="control">\r\n                            <input type="number" class="input is-small" value="0" data-target="joins_low" min="0">\r\n                            <span class="has-text-weight-bold"> &le; player joins &le; </span>\r\n                            <input type="number" class="input is-small" value="9999" data-target="joins_high">\r\n                        </div>\r\n                    </div>\r\n                </details>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message" title="Add trigger message">+</span>\r\n        <h3 class="title is-4">Triggers</h3>\r\n        <ul>\r\n            <li>The trigger will be checked against chat messages, if it matches, the message will be sent.</li>\r\n            <li>Triggers are case-insensitive.</li>\r\n            <li>{{NAME}}, {{Name}}, and {{name}} in the message will be replaced with the user\'s name.</li>\r\n            <li><code>*</code> will be treated as a wildcard.</li>\r\n            <li>Triggers are matched in order, if more than the max number are matched, later triggers will not be sent.</li>\r\n            <li>Change the maximum number of responses under settings.</li>\r\n        </ul>\r\n    </section>\r\n\r\n    <div class="messages-container"></div>\r\n</div>\r\n',We='<template>\r\n    <div class="box">\r\n        <div class="columns">\r\n            <div class="column is-narrow is-hidden-touch">\r\n                <span class="drag"></span>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <p class="has-text-weight-bold">Message</p>\r\n            </div>\r\n            <div class="column">\r\n                <textarea class="textarea is-small is-fluid" data-target="message"></textarea>\r\n            </div>\r\n            <div class="column is-narrow">\r\n                <button class="button is-small is-danger is-outlined" data-do="delete">Delete</button>\r\n            </div>\r\n        </div>\r\n        <div>\r\n            Wait X minutes...\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<div class="container is-widescreen">\r\n    <section class="section is-small">\r\n        <span class="button is-primary is-adding-message">+</span>\r\n        <h3 class="title is-4">Announcements</h3>\r\n        <ul>\r\n            <li>These are sent according to a regular schedule.</li>\r\n            <li>If you have one announcement, it is sent every X minutes, if you have two, then the first is sent at X minutes, and the second\r\n            is sent X minutes after the first. Change X in the settings tab. Once the bot reaches the end of the list, it starts over\r\n            at the top.</li>\r\n            <li>If no players are online when a message is scheduled to be sent, no message will be sent and the next message will reset to the first message.</li>\r\n        </ul>\r\n    </section>\r\n    <div class="messages-container"></div>\r\n</div>\r\n';class Je extends K{constructor({name:e,ex:t,id:n}){super(n,t),this.setup=(()=>(function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())})})(this,void 0,void 0,function*(){this.insertHTML(),this.template=this.tab.querySelector("template"),this.root=this.tab.querySelector(".messages-container"),this.tab.addEventListener("input",()=>this.save()),this.tab.querySelector(".button.is-primary").addEventListener("click",()=>this.addMessage()),this.tab.addEventListener("click",e=>{const t=e.target;if(t.matches("[data-do=delete]")){e.preventDefault();const n=function e(t,n){if(n)return n.classList.contains(t)?n:e(t,n.parentElement)}("box",t);if(!n)return;n.remove()}this.save()});const e=Ue([this.root],{moves:(e,t,n)=>n.classList.contains("drag")});e.on("drop",()=>this.save()),e.on("drag",e=>{const t=e.querySelector("details");t&&(t.open=!1)}),this.ex.storage.get(this.id,[]).forEach(e=>{this.addMessage(e)})})),this.getMessages=(()=>{let e=[];return this.root.querySelectorAll(".box").forEach(t=>{let n={};t.querySelectorAll("[data-target]").forEach(e=>{let t=e.dataset.target;if(t)switch(e.getAttribute("type")){case"number":n[t]=+e.value;break;default:n[t]=e.value}}),e.push(n)}),e}),this.ui=t.bot.getExports("ui"),this.ex=t,this.tab=this.ui.addTab(e,"messages")}remove(){this.ui.removeTab(this.tab)}save(){this.ex.storage.set(this.id,this.getMessages())}}class He extends Je{constructor(e){super({name:"Join",id:"joinArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML=$e}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-for=message-trim]",text:e.message||""},{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class ze extends Je{constructor(e){super({name:"Leave",id:"leaveArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML=qe}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-for=message-trim]",text:e.message||""},{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class Fe extends Je{constructor(e){super({name:"Trigger",id:"triggerArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML=Be}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-target=message]",text:e.message||""},{selector:"[data-target=trigger]",value:e.trigger||""},{selector:"[data-target=joins_low]",value:e.joins_low||0},{selector:"[data-target=joins_high]",value:e.joins_high||9999},{selector:"[data-target=group]",value:e.group||"all"},{selector:"[data-target=not_group]",value:e.not_group||"nobody"}])})}}class Xe extends Je{constructor(e){super({name:"Announcements",id:"announcementArr",ex:e}),this.insertHTML=(()=>{this.tab.innerHTML=We}),this.addMessage=((e={})=>{this.ui.buildTemplate(this.template,this.root,[{selector:"[data-target=message]",text:e.message||""}])})}}function Ye(e){let t=[],n=0;function r(e){for(t.push(e);t.length>100;)t.shift();n=t.length}e.addEventListener("keydown",s=>{"ArrowUp"==s.key?(e.value.length&&n==t.length&&(r(e.value),n--),t.length&&n&&(e.value=t[--n])):"ArrowDown"==s.key?t.length>n+1?e.value=t[++n]:t.length==n+1&&(e.value="",n=t.length):"Enter"==s.key&&function(e){e!=t.slice(-1).pop()?r(e):n=t.length}(e.value)})}x.registerExtension("messages",function(e,t){let n=[];e.remove=(()=>n.forEach(e=>e.remove()));let r=!1,s=()=>{if(r)return;r=!0;let t=setTimeout(()=>{n=[new Z(e),new ee(e),new te(e),new ne(e)]},500);n=[{remove:()=>clearTimeout(t)}]};if(t.onJoin.one(s),t.onLeave.one(s),t.onMessage.one(s),e.bot.getExports("ui")){let t=document.head.appendChild(document.createElement("style"));t.innerHTML='.messages-container input[type=number] {\r\n    width: 5em;\r\n    font-size: 0.6rem;\r\n}\r\n\r\n.messages-container {\r\n    border-top: 1px solid #cccccc;\r\n    padding-top: 1em;\r\n}\r\n\r\n.messages-container .box {\r\n    padding: 0.7em;\r\n    padding-bottom: 0;\r\n    margin-bottom: 1em;\r\n}\r\n\r\n.messages-container .columns {\r\n    margin-bottom: 0;\r\n}\r\n\r\n.messages-container .drag::after {\r\n    content: " \\2261";\r\n}\r\n\r\n.messages-container .level-options {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n}\r\n@media screen and (max-width: 768px) {\r\n    .messages-container .level-options {\r\n        flex-wrap: wrap;\r\n    }\r\n}\r\n\r\n.messages-container summary {\r\n    outline: none;\r\n}\r\n\r\n.is-adding-message {\r\n    position: fixed;\r\n    left: 1em;\r\n    z-index: 10;\r\n}\r\n\r\n.messages-container p {\r\n    margin-right: 0.5em;\r\n}\r\n\r\n/** Copied from https://github.com/bevacqua/dragula/blob/b0e5c4/dist/dragula.css **/\r\n.gu-mirror {\r\n    position: fixed !important;\r\n    margin: 0 !important;\r\n    z-index: 9999 !important;\r\n    opacity: 0.8;\r\n    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=80)";\r\n    filter: alpha(opacity=80);\r\n}\r\n.gu-hide {\r\n    display: none !important;\r\n}\r\n.gu-unselectable {\r\n    -webkit-user-select: none !important;\r\n    -moz-user-select: none !important;\r\n    -ms-user-select: none !important;\r\n    user-select: none !important;\r\n}\r\n.gu-transit {\r\n    opacity: 0.2;\r\n    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";\r\n    filter: alpha(opacity=20);\r\n}\r\n';let r=e.bot.getExports("ui");r.addTabGroup("Messages","messages");let s=[new He(e),new ze(e),new Fe(e),new Xe(e)];s.forEach(e=>e.setup()),n=n.concat(...s,{remove:()=>t.remove()},{remove:()=>r.removeTabGroup("messages")})}});x.registerExtension("console",function(e,t){if(!e.bot.getExports("ui"))throw new Error("This extension should only be loaded in a browser, and must be loaded after the UI is loaded.");const n=e.bot.getExports("ui");let r=document.head.appendChild(document.createElement("style"));r.textContent="#console .mod > span:first-child {\r\n    color: #05f529;\r\n}\r\n\r\n#console .admin > span:first-child {\r\n    color: #2b26bd;\r\n}\r\n\r\n#console .chat {\r\n    margin: 0 1em;\r\n    height: calc(100vh - 52px - 4.25em);\r\n    overflow-y: auto;\r\n}\r\n\r\n#console .chat-control {\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100vw;\r\n    background: #fff;\r\n}\r\n\r\n#console .field {\r\n    margin: 1em;\r\n}\r\n";let s=n.addTab("Console");s.innerHTML='<template>\r\n    <li>\r\n        <span>NAME</span>\r\n        <span>: Message</span>\r\n    </li>\r\n</template>\r\n<div id="console">\r\n    <div class="chat">\r\n        <ul></ul>\r\n    </div>\r\n    <div class="chat-control">\r\n        <div class="field has-addons">\r\n            <p class="control is-expanded">\r\n                <input type="text" class="input" />\r\n            </p>\r\n            <p class="control">\r\n                <button class="input button is-primary">SEND</button>\r\n            </p>\r\n        </div>\r\n    </div>\r\n</div>';let i=s.querySelector("ul"),o=i.parentElement,a=s.querySelector("template"),l=s.querySelector("input");function c(){e.bot.send(l.value),l.value=""}function d(e,t){if(!t.length)return;let r="player";e.isAdmin&&(r="admin"),e.isMod&&(r="mod"),n.buildTemplate(a,i,[{selector:"li",class:r},{selector:"span:first-child",text:e.name},{selector:"span:last-child",text:": "+t}])}l.addEventListener("keyup",e=>{"Enter"==e.key&&c()}),Ye(l),s.querySelector("button").addEventListener("click",c),new MutationObserver(function(e){let t=i.children.length,n=0;for(let r=t-e.length;r<t;r++)n+=i.children[r].clientHeight;for(o.scrollHeight-o.clientHeight-o.scrollTop==n&&(o.scrollTop=o.scrollHeight);i.children.length>500;)i.children[0].remove()}).observe(i,{childList:!0,subtree:!0});let u={log:e=>d(t.getPlayer("SERVER"),e)};function h(t){e.storage.get("logJoinIps",!0)?u.log(`${t.name} (${t.ip}) joined.`):u.log(`${t.name} joined.`)}function p(e){u.log(e.name+" left")}function m({player:e,message:t}){d(e,t)}function g(t){e.storage.get("logUnparsedMessages",!0)&&function(e){if(!e.length)return;let t=document.createElement("li");t.textContent=e,i.appendChild(t)}(t)}e.exports=u,t.onJoin.sub(h),t.onLeave.sub(p),t.onMessage.sub(m),t.onOther.sub(g),e.remove=function(){n.removeTab(s),r.remove(),t.onJoin.unsub(h),t.onLeave.unsub(p),t.onMessage.unsub(m),t.onOther.unsub(g)}});var Ve,Ge,Qe=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=t.saveAs=window.saveAs||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in r,i=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),o=e.webkitRequestFileSystem,a=e.requestFileSystem||o||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c=0,d=function(e){setTimeout(function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()},4e4)},u=function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var s=e["on"+t[r]];if("function"==typeof s)try{s.call(e,n||e)}catch(e){l(e)}}},h=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},p=function t(l,p,m){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m||(l=h(l));var g,f,v,b=this,y=l.type,w=!1,x=function(){u(b,"writestart progress write writeend".split(" "))},E=function(){if(f&&i&&"undefined"!=typeof FileReader){var t=new FileReader;return t.onloadend=function(){var e=t.result;f.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),b.readyState=b.DONE,x()},t.readAsDataURL(l),void(b.readyState=b.INIT)}(!w&&g||(g=n().createObjectURL(l)),f)?f.location.href=g:void 0===e.open(g,"_blank")&&i&&(e.location.href=g);b.readyState=b.DONE,x(),d(g)},_=function(e){return function(){if(b.readyState!==b.DONE)return e.apply(this,arguments)}},S={create:!0,exclusive:!1};if(b.readyState=b.INIT,p||(p="download"),s)return g=n().createObjectURL(l),void setTimeout(function(){var e,t;r.href=g,r.download=p,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),x(),d(g),b.readyState=b.DONE});e.chrome&&y&&"application/octet-stream"!==y&&(v=l.slice||l.webkitSlice,l=v.call(l,0,l.size,"application/octet-stream"),w=!0),o&&"download"!==p&&(p+=".download"),("application/octet-stream"===y||o)&&(f=e),a?(c+=l.size,a(e.TEMPORARY,c,_(function(e){e.root.getDirectory("saved",S,_(function(e){var t=function(){e.getFile(p,S,_(function(e){e.createWriter(_(function(t){t.onwriteend=function(t){f.location.href=e.toURL(),b.readyState=b.DONE,u(b,"writeend",t),d(e)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&E()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=b["on"+e]}),t.write(l),b.abort=function(){t.abort(),b.readyState=b.DONE},b.readyState=b.WRITING}),E)}),E)};e.getFile(p,{create:!1},_(function(e){e.remove(),t()}),_(function(e){e.code===e.NOT_FOUND_ERR?t():E()}))}),E)}),E)):E()},m=p.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=h(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(m.abort=function(){this.readyState=this.DONE,u(this,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,function(e,t,n){return new p(e,t,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);t.default=n}(Ve={exports:{}},Ve.exports),Ve.exports);(Ge=Qe)&&Ge.__esModule&&Object.prototype.hasOwnProperty.call(Ge,"default")&&Ge.default;var Ke=Qe.saveAs;const Ze="https://gitcdn.xyz/cdn/Blockheads-Messagebot/Extensions/master/extensions.json";function et(e){const t=e.env.toLocaleLowerCase();return[t.includes("all"),t.includes("browser"),t.includes("mac")&&t.includes("cloud")].some(Boolean)&&/\.(m?js|es)/.test(e.package)}x.registerExtension("extensions",e=>{const t=e.bot.getExports("ui"),n=t.addTab("Extensions");function r(r){try{e.bot.addExtension(r),e.storage.with("autoload",[],e=>{e.includes(r)||e.push(r)});const s=n.querySelector(`a[ext_id="${r}"]`);s&&(s.textContent="Remove")}catch(n){t.notify("Error adding extension: "+n);try{e.bot.removeExtension(r,!1)}catch(e){}}}n.innerHTML='<template>\r\n    <tr>\r\n        <td data-for="title"></td>\r\n        <td data-for="actions"><a class="button is-small">Install</a></td>\r\n        <td data-for="description"></td>\r\n        <td data-for="author" class="is-hidden-mobile"></td>\r\n    </tr>\r\n</template>\r\n<div class="container is-fluid">\r\n    <section class="section is-small">\r\n        <h3 class="title is-4">Extensions can increase the functionality of the bot.</h3>\r\n        <span>Interested in creating one?\r\n            <a href="https://github.com/Blockheads-MessageBot/MessageBot/wiki/2.-Development:-Start-Here" target="_blank">Start here.</a>\r\n        </span>\r\n    </section>\r\n    <table class="table is-striped is-fullwidth is-hoverable">\r\n        <thead>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Actions</th>\r\n                <th>Description</th>\r\n                <th class="is-hidden-mobile">Author</th>\r\n            </tr>\r\n        </thead>\r\n        <tfoot>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Actions</th>\r\n                <th>Description</th>\r\n                <th class="is-hidden-mobile">Author</th>\r\n            </tr>\r\n        </tfoot>\r\n        <tbody></tbody>\r\n    </table>\r\n</div>',n.addEventListener("click",r=>{const s=r.target;if("A"!=s.tagName)return;const i=s.getAttribute("ext_id");i&&("Install"==s.textContent?o(i):function(r){try{e.bot.removeExtension(r,!0),e.storage.with("autoload",[],e=>{e.includes(r)&&e.splice(e.indexOf(r),1)});const s=n.querySelector(`a[ext_id="${r}"]`);s&&(s.textContent="Install")}catch(e){t.notify("Error removing extension: "+e)}}(i))}),e.remove=(()=>{throw new Error("This extension cannot be removed.")}),e.exports.reloadExtension=function(t){const n=i.get(t);n?(e.bot.removeExtension(t,!1),x.deregisterExtension(t),s.add(t),document.head.appendChild(document.createElement("script")).src=n.package):console.warn("Could not reload unknown ID:",t)};const s=new Set;x.extensionRegistered.sub(t=>{e.storage.get("devMode",!1)?(e.bot.getExports(t)&&e.bot.removeExtension(t,!1),r(t)):s.has(t)&&(s.delete(t),r(t))});const i=new Map;function o(e){const t=i.get(e);if(t)if(x.extensions.includes(e))r(e);else{s.add(e),document.head.appendChild(document.createElement("script")).src=t.package}else console.warn("Could not load unknown ID:",e)}const a=e.storage.get("repos",Ze).split(/\r?\n/).reverse().map(e=>fetch(e).then(e=>e.json()));Promise.all(a).then(e=>{(e=>e.reduce((e,t)=>e.concat(t),[]))(e).filter(et).forEach(e=>{i.set(e.id,e)})}).then(()=>{e.storage.get("autoload",[]).forEach(o),function(){for(const e of i.values())t.buildTemplate(n.querySelector("template"),n.querySelector("tbody"),[{selector:"[data-for=title]",text:e.title},{selector:"[data-for=description]",text:e.description},{selector:"[data-for=author]",text:e.user},{selector:"a",ext_id:e.id}])}()}).catch(e=>{console.error(e),t.notify("An extension repo has failed to load.")})});const tt=[["messages/announcementDelay",10],["messages/maxResponses",3],["messages/rejoinCooldown",30],["messages/triggerCooldown",10],["console/logJoinIps",!0],["console/logUnparsedMessages",!0],["messages/regexTriggers",!1],["messages/disableWhitespaceTrimming",!1],["splitMessages",!1],["splitToken","<split>"],["extensions/devMode",!1],["extensions/repos",Ze]];if(x.registerExtension("settings",function(e){const t=e.bot.storage,n=e.bot.getExports("ui"),r=n.addTab("Settings");r.innerHTML='<div class="container">\n    <h3 class="title">General Settings</h3>\n    <p class="control">\n        <label>Rejoin cooldown (seconds) - if the player leaves then rejoins, don\'t send join messages</label>\n        <input class="input" type="number" data-target="messages/rejoinCooldown">\n    </p>\n    <p class="control">\n        <label>Trigger cooldown (seconds) - limit trigger messages by the same player</label>\n        <input class="input" type="number" data-target="messages/triggerCooldown">\n    </p>\n    <p class="control">\n        <label>Maximum trigger responses to a message</label>\n        <input class="input" type="number" data-target="messages/maxResponses">\n    </p>\n    <p class="control">\n        <label>Minutes between announcements</label>\n        <input class="input" type="number" data-target="messages/announcementDelay">\n        <br>\n    </p>\n    <p class="control">\n        <label class="checkbox">\n            <input type="checkbox" data-target="console/logJoinIps"> Show joining IPs in console\n        </label>\n    </p>\n    <p class="control">\n        <label class="checkbox">\n            <input data-target="console/logUnparsedMessages" type="checkbox"> Log unparsed messages\n        </label>\n    </p>\n\n    <hr>\n\n    <h3 class="title">Advanced Settings</h3>\n    <div class="message is-warning">\n        <div class="message-header">\n            <p>Warning</p>\n        </div>\n        <div class="message-body">\n            <p>Changing these options can result in unexpected behavior.\n                <a href="https://github.com/Bibliofile/Blockheads-MessageBot/wiki/1.-Advanced-Options/"\n                    target="_blank">Read this first</a>\n            </p>\n        </div>\n    </div>\n    <p class="control">\n        <label class="checkbox">\n            <input type="checkbox" data-target="messages/regexTriggers"> Parse triggers as RegEx\n        </label>\n    </p>\n    <p class="control">\n        <label class="checkbox">\n            <input type="checkbox" data-target="messages/disableWhitespaceTrimming"> Disable whitespace trimming\n        </label>\n    </p>\n    <p class="control">\n        <label class="checkbox">\n            <input type="checkbox" data-target="splitMessages"> Split messages\n        </label>\n    </p>\n    <label class="label">Split token:</label>\n    <p class="control">\n        <input class="input" type="text" data-target="splitToken">\n    </p>\n    <p class="control">\n        <label class="checkbox">\n            <input type="checkbox" data-target="extensions/devMode"> Developer mode\n        </label>\n    </p>\n    <label class="label">Extension Repository URLs (one per line, reload required to apply):</label>\n    <p class="control">\n        <textarea class="textarea is-fluid" type="text" data-target="extensions/repos"></textarea>\n    </p>\n\n    <hr>\n\n    <nav class="panel">\n        <p class="panel-heading">Backup / Restore</p>\n\n        <a class="panel-block" data-do="show_backup">Show Backup</a>\n        <a class="panel-block" data-do="download_backup">Download Backup</a>\n        <a class="panel-block" data-do="import_backup">Import Backup</a>\n        <a class="panel-block" data-do="upload_backup">Upload Backup</a>\n    </nav>\n\n    <br>\n</div>\n';for(const[e,n]of tt){const s=r.querySelector(`[data-target="${e}"]`);"boolean"==typeof n?s.checked=t.get(e,n):s.value=String(t.get(e,n))}function s(e){let t;try{if(null===(t=JSON.parse(e)))throw new Error("Invalid backup")}catch(e){return void n.notify("Invalid backup code. No action taken.")}localStorage.clear(),Object.keys(t).forEach(e=>{localStorage.setItem(e,t[e])}),location.reload()}r.addEventListener("change",()=>{for(const[e,n]of tt){const s=r.querySelector(`[data-target="${e}"]`);"boolean"==typeof n?t.set(e,s.checked):"number"==typeof n?t.set(e,+s.value):t.set(e,s.value)}}),r.querySelector("[data-do=show_backup]").addEventListener("click",()=>{const e=JSON.stringify(localStorage).replace(/</g,"&lt;");n.alert(`<p>Copy this to a safe place.</p><textarea class="textarea">${e}</textarea>`)}),r.querySelector("[data-do=import_backup]").addEventListener("click",()=>{n.prompt("Enter your backup code, this will reload the page:",e=>{e&&s(e)})}),r.querySelector("[data-do=download_backup]").addEventListener("click",()=>{const e=JSON.stringify(localStorage,void 0,4);if(!Blob)return void n.notify("Your browser doesn't support this.");const t=new Blob([e],{type:"text/plain;charset=utf-8"});Ke(t,"bot_backup.txt")}),r.querySelector("[data-do=upload_backup]").addEventListener("click",()=>{if(!(File&&FileReader&&FileList&&Blob))return void n.notify("It looks like your browser doesn't support this.");const e=document.createElement("input");e.type="file",e.addEventListener("change",()=>{if(!e.files||"text/plain"!=e.files[0].type)return void n.notify("Upload a text file.");const t=new FileReader;t.addEventListener("load",()=>{s(t.result)}),t.readAsText(e.files[0])}),e.click()}),e.remove=function(){n.removeTab(r)}}),window["@bhmb/bot"])throw new Error("Bot already loaded.");window["@bhmb/bot"]={MessageBot:x,SimpleEvent:i};const nt=window.worldId.toString();if("portal.theblockheads.net"!=location.hostname&&confirm("You are not on the portal, go there now?")&&location.assign("http://portal.theblockheads.net"),!nt)throw alert("You must be on a world page to start the bot"),new Error("Bad page");window.pollChat=(()=>{}),x.dependencies={Api:class{constructor(e){this.info=e,this.parser=new S,this.getLists=(()=>_(this,void 0,void 0,function*(){const e=yield O(`/worlds/lists/${this.info.id}`),t=t=>{let n=[];const r=e.match(new RegExp(`<textarea name="${t}">([\\s\\S]*?)</textarea>`));return r&&(n=T(r[1]).split(/\r?\n/)),Array.from(new Set(n)).filter(Boolean)};return{adminlist:t("admins"),modlist:t("modlist"),whitelist:t("whitelist"),blacklist:t("blacklist")}})),this.setLists=(e=>_(this,void 0,void 0,function*(){const t=e=>encodeURIComponent(e.join("\n"));let n=`admins=${t(e.adminlist)}`;n+=`&modlist=${t(e.modlist)}`,n+=`&whitelist=${t(e.whitelist)}`,n+=`&blacklist=${t(e.blacklist)}`,yield C(`/worlds/lists/${this.info.id}`,{method:"POST",body:n})})),this.getOverview=(()=>_(this,void 0,void 0,function*(){const e=yield O(`/worlds/${this.info.id}`),t=(t,n="")=>{const r=e.match(t);return r?r[1]:n},n=t(/^\$\('#privacy'\).val\('(.*?)'\)/m,"public");let r=[];const s=e.match(/^\t<tr><td class="left">(.*?)(?=<\/td>)/gm);return s&&(r=r.concat(s.map(e=>e.substr(22)))),{name:t(/^\t<title>(.*?) Manager \| Portal<\/title>$/m),owner:t(/^\t\t<td class="right">Owner:<\/td>\r?\n\t\t<td>(.*?)<\/td>$/m),created:new Date(t(/^\t\t<td>Created:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),last_activity:new Date(t(/^\t\t<td>Last Activity:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),credit_until:new Date(t(/^\t\t<td>Credit Until:<\/td><td>(.*?)<\/td>$/m)+" GMT-0000"),link:t(/^\t<tr><td>Link:<\/td><td><a href="(.*?)">\1<\/a>/m),pvp:!!t(/^\$\('#pvp'\)\./m),privacy:n,password:"Yes"==t(/^\t\t<td>Password:<\/td><td>(Yes|No)<\/td><\/tr>$/m),size:t(/^\t\t<td>Size:<\/td><td>(.*?)<\/td>$/m),whitelist:"Yes"==t(/<td>Whitelist:<\/td><td>(Yes|No)<\/td>/m),online:r,status:t(/^updateWorld\({id: \d+, worldStatus: '(.*?)'/m)}})),this.getLogs=(()=>O(`/worlds/logs/${this.info.id}`).then(e=>e.split("\n")).then(e=>this.parser.parse(e))),this.getMessages=((e=0)=>C("/api",{method:"POST",body:`command=getchat&worldId=${this.info.id}&firstId=${e}`}).then(({status:e,log:t,nextId:n})=>"ok"!=e?{log:[],nextId:0}:{nextId:n,log:t},()=>({log:[],nextId:e}))),this.getStatus=(()=>C("/api",{method:"POST",body:`command=status&worldId=${this.info.id}`}).then(e=>e.worldStatus)),this.send=(e=>C("/api",{method:"POST",body:`command=send&worldId=${this.info.id}&message=${encodeURIComponent(e)}`}).then(t=>{if("ok"!=t.status)throw new Error(`Unable to send ${e}`)})),this.start=(()=>C("/api",{method:"POST",body:`command=start&worldId=${this.info.id}`}).then(()=>void 0,console.error)),this.stop=(()=>C("/api",{method:"POST",body:`command=stop&worldId=${this.info.id}`}).then(()=>void 0,console.error)),this.restart=(()=>C("/api",{method:"POST",body:`command=reboot&worldId=${this.info.id}`}).then(()=>void 0,console.error))}get name(){return this.info.name}get id(){return this.info.id}},getWorlds:function(){return _(this,void 0,void 0,function*(){const e=(yield O("/worlds")).split("\n"),t=[];return e.forEach(e=>{if(/\t\tupdateWorld/.test(e)){const n=e.match(/name: '([^']+?)'/),r=e.match(/id: (\d+)/);t.push({name:T(n[1]),id:r[1]})}}),t})},fetch:fetch};const rt={name:document.querySelector("#title").textContent,id:nt};!function(){return e=this,t=void 0,r=function*(){const e=new E(new X(`/${nt}`),rt);e.addExtension("ui"),e.addExtension("console"),document.querySelector(".nav-item").click(),e.addExtension("messages"),e.addExtension("settings"),e.addExtension("extensions"),addEventListener("storage",e=>{e.key==="load_indicator"+nt&&"1"===e.newValue&&(localStorage.setItem("already_loaded"+nt,"1"),localStorage.setItem("load_indicator"+nt,"0"))}),addEventListener("storage",t=>{t.key==="already_loaded"+nt&&"1"===t.newValue&&(localStorage.setItem("already_loaded"+nt,"0"),e.getExports("ui").alert("Warning: The bot is already loaded in another tab. If you leave this tab open, your storage may be overwritten and messages may be sent twice."))}),localStorage.setItem("load_indicator"+nt,"1"),localStorage.setItem("load_indicator"+nt,"0"),e.start(),yield e.world.start(),yield e.world.getLists(!0)},new((n=void 0)||(n=Promise))(function(s,i){function o(e){try{l(r.next(e))}catch(e){i(e)}}function a(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}l((r=r.apply(e,t||[])).next())});var e,t,n,r}()}(crypto);
//# sourceMappingURL=bundle.js.map
